{
    "Shader": {
        "info": {
            "date": "1679171025",
            "description": "I added godrays",
            "flags": 0,
            "hasliked": 0,
            "id": "csy3Dc",
            "likes": 9,
            "name": "Lakes land 5",
            "published": 3,
            "tags": [
                "clouds",
                "mountains"
            ],
            "usePreview": 0,
            "username": "guil",
            "viewed": 292
        },
        "renderpass": [
            {
                "code": "\nmat2 rot(float a) {\n\treturn mat2(cos(a),sin(a),-sin(a),cos(a));\t\n}\n\nconst vec3 l = vec3(1.);\nconst vec3 sundir = normalize( vec3(.3,.1,1.) );\nconst vec3 suncol = vec3(1.,.8,.5);\n\nfloat cloud(in vec3 p) {\n\tfloat s=.5,e=(2.7-p.y)*(5.-p.y)+5.;\n    p.xz *=.7;\n    for(int i=0;i<7;i++)\n            p.xz*=rot(1.),\n            e-=abs(dot(sin(p*s+2.*cos(1.7*p.zxy*s)),l*.5))/s,\n            s*=1.7;\n    return .5*e;\n}\n\n\nfloat ground(in vec3 p) {\t\n\tfloat s=2.,f;\t\n\tfor(f=p.y;s<1e3;s*=1.7)\n            p.xz*=rot(1.),            \n            f+=dot(sin(p.xz*s*.4+2.*cos(.7*p.zx*s*.4))/s,l.xz);    \n    return f*.52;\n}\n\nvec3 sky( in vec3 ro, in vec3 rd ,in vec2 res)\n{ \n    // background sky : modified from IQ clouds        \n    float sun = max( dot(sundir,rd), 0.0);    \n    vec3 col = vec3(0.6,0.6,0.78) - abs(rd.y)*0.5*vec3(1.0,0.4,.05);    \n    col += suncol*pow( sun+.001, 500.0 ); \n    // clouds        \n    float k = res.x, c = res.y;\n    if(c>.0)\n       col *= 1.-.7*c,\n       col += 3.*(.5+k)*c*suncol,\n       col += 2.*vec3(0.2,0.08,0.04)*pow( sun, 3.0 )*k;    \n    // godrays\n    float sh = 1., t = 5., d;\n    vec3 q = ro+40.*rd;\n    for(int i=0; i<40; ++i)    \n        d = cloud(q+sundir*t),\n        sh = min(sh,1./(1.+exp(-d))),\n        t += d,\n        q += rd*.6;\n    \n    col += 2.*pow((1.-sh)*sun,3.)*suncol;\n    return col;\n}\n\n\nvec3 raycast( in vec3 ro, vec3 rd )\n{\n    float t = 4.,e,e1,f,de=0.,df,d,c=1.,dt=.3,r=1.;\n    vec3 col= vec3(0.),p,skycol;\n    for( int i=0; i<100; i++ )\n\t{                \n        p = ro+t*rd;\n        if(p.y<0.)rd.y = -rd.y, ro = p, t = .1, r=.5;\n        e = cloud(p), f=ground(p),             \n        d = min(min(f,p.y+.1),max(e,.07));\n        t += .7*d;\n        if(e<.001)\n            e1 = cloud(p + dt*sundir),\n            de += max(e1-e,0.)/dt/(1.+ exp(-16.*e1));\n        c *= 1./(1.+ exp(-16.*e));        \t\n    }\n    skycol = r*sky(ro,rd,vec2(.1*de,(1.-c)*.2));        \n    if(f>.5)return skycol;\n    df = max(ground(p-.01)-f,-5.0)*30.;\n    df += max(ground(p+.005*sundir)-f,.0)*200.+.3;\n    vec2 s = vec2(ground(p+vec3(.01,0,0))-f,ground(p+vec3(0,0,.01))-f);\n    f = (-.4+exp(-f))*sign(length(s)-.012);\n    col = vec3(f, f*f,f*f*f)*df;\n    float maxd = 50.;    \n    col = mix(col, skycol, smoothstep(.2, .99, min(t, maxd)/maxd));\n    return r*col;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 u )\n{\n\tfloat t = iTime;\n    vec2  R = iResolution.xy,\n          q = ( u+u - R ) / R.y;   \n    \n    // camera\n    \n    vec3 ro = vec3(0.), rd = normalize(vec3(q,3.) );\n    rd.yz *= rot(-.15); \n    rd.xz *= rot(0.1*t);\n    ro.x -=t*.4;\n    ro.y += 2.;\n\n\t// raymarch \n    \n    vec3 col = raycast(ro,rd);\n    \t\n\t// shade\n    \n    col = log(1.+col);\n    col = clamp(col,0.,1.);\n    fragColor = vec4( col, 1.0 );\n\n}\n",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}