{
    "Shader": {
        "info": {
            "date": "1653938425",
            "description": "mouse.x shows the full res texture.\nPurpose is to display an image \"as if\" vectorized at low resolution.",
            "flags": 0,
            "hasliked": 0,
            "id": "NddyRl",
            "likes": 16,
            "name": "marching squares on texture",
            "published": 3,
            "tags": [
                "short",
                "marchingcubes",
                "marchingsquares",
                "vectorization"
            ],
            "usePreview": 1,
            "username": "FabriceNeyret2",
            "viewed": 544
        },
        "renderpass": [
            {
                "code": "int      lod = 5;\nfloat thresh = .4;\n\n#define s    textureSize(iChannel0,0)\n#define T(U) texelFetch(iChannel0, ivec2(U) %(s>>lod), lod).r // texture access\n#define S(v) smoothstep( -.8,.8,(v)/fwidth(v) )      // antialiasing draw\n\nvoid mainImage( out vec4 O, vec2 u )\n{   //u*=2.;\n    float Z = exp2(float(lod)),                      // scaling\n          t = floor(30.*iTime);                      // animation\n    u += t;\n    vec2  R = iResolution.xy, v,\n          U = u/Z,\n          V = mod(u-.5,Z);\n    if (V.x*V.y==0.) { O = vec4(.5); return; }       // grid\n\n    if ( iMouse.x > u.x-t ) {                        // mouse.x show ref\n        O = vec4( texelFetch(iChannel0,ivec2(u+Z/2.) %s,0).r > thresh ,\n                  T(U+.5) > thresh , 0,1);\n        return;\n    }\n    O-=O;                                            // --- marching cube -------\n    vec4 c = vec4( T(U)          , T(U+vec2(1,0)),   // value at corners\n                   T(U+vec2(0,1)), T(U+vec2(1,1)) ), \n         b = step(thresh,c);                         // is > threshold ?\n    int  n = int(b.x+b.y+b.z+b.w);                   // number of yes\n    U = fract(U);                                    // tile local coordinates\n    if      (n==0) O += .3;                          // empty ( for test )\n    else if (n==4) O += 1.;                          // full\n    else if (n==1 || n==3 || n==2 && b.x==b.w ) {    // corner + checker case \n        if (n==3) b = 1.-b;  \n        if(b.x>0.) O += S( (1.-U.x-U.y)*c.x +   U.x   *c.y +   U.y   *c.z - thresh );\n        if(b.y>0.) O += S( (  U.x -U.y)*c.y + (1.-U.x)*c.x +   U.y   *c.w - thresh );\n        if(b.z>0.) O += S( (-U.x+ U.y )*c.z +   U.x   *c.w + (1.-U.y)*c.x - thresh );\n        if(b.w>0.) O += S( (U.x+U.y-1.)*c.w + (1.-U.x)*c.z + (1.-U.y)*c.y - thresh );\n    } else { // n==2                                      // (checker treated above)\n        if      (b.x==b.y) v = (thresh-c.xy)/(c.zw-c.xy), // horizontal\n                           O += S( U.y - mix(v.x,v.y,U.x) );\n        else if (b.x==b.z) v = (thresh-c.xz)/(c.yw-c.xz), // vertical\n                           O += S( U.x - mix(v.x,v.y,U.y) );\n        if (b.x>0.) O = 1.-O;\n    }\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "texture",
                        "id": 7,
                        "published": 1,
                        "sampler": {
                            "filter": "mipmap",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "repeat"
                        },
                        "src": "/media/a/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}