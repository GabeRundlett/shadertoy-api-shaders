{
    "Shader": {
        "info": {
            "date": "1702546910",
            "description": "Special dedication to Fabrice Champollion III: may the AI be with you.",
            "flags": 0,
            "hasliked": 0,
            "id": "mlGBW3",
            "likes": 14,
            "name": "Train Ride with Tunnels",
            "published": 3,
            "tags": [
                "landscape",
                "train",
                "golf"
            ],
            "usePreview": 1,
            "username": "dr2",
            "viewed": 366
        },
        "renderpass": [
            {
                "code": "#define YS min(FX,0)\n#define La(Yc)if(TU<Jp){LM=Yc;Jp=TU;}\n#define ML(Yc)if(TU<Jp){LM=Yc;BT=Ai;Jp=TU;}\nconst int Iq=1,XL=2,Wa=3,SE=4,EU=5,Up=6,Kb=7,QT=8,By=9,Dj=10,Zw=11,GF=12,ZN=13;const float KN=3.1415927,Bl=1.7320508;const int Oj=17,Em=4,Le=3;vec4 EQ[Em],HV[Oj],QX;vec3 BT,JO,VN;vec2 Ul,Zs,Pe,XH,MC;float TD,OV,QG[Oj+1],Uc,SV,Rk,Gb,GB,ON,CF,AU,Zj,Fh,KR,Lr;int FX,LM,ED;float WM(vec3 Ck,vec3 Yg,float Ha){return length(max(abs(Ck)-Yg,0.))-Ha;}float Vb(vec2 Ck,vec2 Yg,float Ha){return length(max(abs(Ck)-Yg,0.))-Ha;}float Yx(vec3 Ck,float Fp){return length(Ck)-Fp;}float Tq(vec3 Ck,float Fp,float GW){return max(length(Ck.xy)-Fp,abs(Ck.z)-GW);}float RF(vec3 Ck,vec2 JG,float Fp,float GW){float TU;TU=max(dot(vec2(length(Ck.xy)-Fp,Ck.z),JG),abs(Ck.z)-GW);GW/=JG.x*JG.x;Fp/=JG.x;TU=min(TU,min(length(vec3(Ck.xy,Ck.z+Fp*JG.y-GW))-Fp+GW*JG.y,length(vec3(Ck.xy,Ck.z+Fp*JG.y+GW))-Fp-GW*JG.y));return TU;}vec2 My(vec2 Ck){vec3 Wn,NS,Qh;Wn.xz=vec2((1./Bl)*Ck.x-(1./3.)*Ck.y,(2./3.)*Ck.y);Wn.y=-Wn.x-Wn.z;NS=floor(Wn+0.5);Qh=abs(NS-Wn);NS-=step(Qh.yzx,Qh)*step(Qh.zxy,Qh)*dot(NS,vec3(1.));return NS.xz;}vec2 Pz(vec2 GW){return vec2(Bl*(GW.x+0.5*GW.y),(3./2.)*GW.y);}float NO(vec2 Ck){Ck=abs(Ck);return(Bl/2.)-Ck.x+0.5*min(Ck.x-Bl*Ck.y,0.);}float Gs(float Nk){return(Nk!=0.)?sign(Nk):1.;}float OR(vec2 Ck){return min(Ck.x,Ck.y);}float Lv(vec2 Ck){return max(Ck.x,Ck.y);}float Ng(vec3 Ck){return max(Ck.x,max(Ck.y,Ck.z));}float QC(vec3 Ck){return min(Ck.x,min(Ck.y,Ck.z));}float Pm(float TL,float Vw,float Fp){float GW;GW=clamp(0.5+0.5*(Vw-TL)/Fp,0.,1.);return mix(Vw-GW*Fp,TL,GW);}float NB(float TL,float Vw,float Fp){return-Pm(-TL,-Vw,Fp);}float LQ(float JK,float UG,float Yg,float Nk){return(1.-smoothstep(UG-Yg,UG+Yg,Nk))*smoothstep(JK-Yg,JK+Yg,Nk);}mat3 Id(float Hn,float LZ){vec2 Az,XY,ZR;Az=vec2(Hn,LZ);XY=cos(Az);ZR=sin(Az);return mat3(XY.y,0.,-ZR.y,0.,1.,0.,ZR.y,0.,XY.y)*mat3(1.,0.,0.,0.,XY.x,-ZR.x,0.,ZR.x,XY.x);}vec2 SZ(vec2 Ai,float BL){vec2 JG;JG=sin(BL+vec2(0.5*KN,0.));return vec2(dot(Ai,vec2(JG.x,-JG.y)),dot(Ai.yx,JG));}vec2 Ro(vec2 Ai,vec2 JG){return vec2(dot(Ai,vec2(JG.x,-JG.y)),dot(Ai.yx,JG));}const float JX=43758.54;float IH(vec2 Ck){return fract(sin(mod(dot(Ck,vec2(37.,39.)),2.*KN))*JX);}vec2 Ks(vec2 Ck){vec2 LI=vec2(37.,39.);return fract(sin(mod(dot(Ck,LI)+vec2(0.,LI.x),2.*KN))*JX);}vec4 Md(vec3 Ck){vec3 Nt=vec3(37.,39.,41.);return fract(sin(mod(dot(Ck,Nt)+vec4(0.,Nt.xy,Nt.x+Nt.y),2.*KN))*JX);}float HI(vec2 Ck){vec2 Nk,Bh,UX;Bh=floor(Ck);UX=fract(Ck);UX=UX*UX*(3.-2.*UX);Nk=mix(Ks(Bh),Ks(Bh+vec2(0.,1.)),UX.y);return mix(Nk.x,Nk.y,UX.x);}float Jt(vec3 Ck){vec4 Nk;vec3 Bh,UX;Bh=floor(Ck);UX=fract(Ck);UX*=UX*(3.-2.*UX);Nk=mix(Md(Bh),Md(Bh+vec3(0.,0.,1.)),UX.z);return mix(mix(Nk.x,Nk.y,UX.x),mix(Nk.z,Nk.w,UX.x),UX.y);}float PQ(vec2 Ck){float Of,BL;Of=0.;BL=1.;for(int Go=0;Go<5;Go++){Of+=BL*HI(Ck);BL*=0.5;Ck*=2.;}return Of*(1./1.9375);}float RB(vec3 Ck){float Of,BL;Of=0.;BL=1.;for(int Go=0;Go<5;Go++){Of+=BL*Jt(Ck);BL*=0.5;Ck*=2.;}return Of*(1./1.9375);}float Tm(vec3 Ck,vec3 Zf){vec3 Yg;float BL;Yg=vec3(0.);BL=1.;for(int Go=0;Go<5;Go++){Yg+=BL*vec3(HI(Ck.yz),HI(Ck.zx),HI(Ck.xy));BL*=0.5;Ck*=2.;}return dot(Yg,abs(Zf));}vec3 Xh(vec3 Ck,vec3 Zf,float Of){vec4 Sa;vec3 GW;vec2 DR=vec2(0.1,0.);for(int Go=YS;Go<=3;Go++)Sa[Go]=Tm(Ck+((Go<2)?((Go==0)?DR.xyy:DR.yxy):((Go==2)?DR.yyx:DR.yyy)),Zf);GW=Sa.xyz-Sa.w;return normalize(Zf+Of*(GW-Zf*dot(Zf,GW)));}float DA(vec2 Ck){float Of,GS,ID;Ck*=0.25;Of=0.;GS=1.;ID=0.;for(int Go=0;Go<3;Go++){Of+=GS*HI(Ck);ID+=GS;GS*=0.4;Ck*=2.5;}return 3.5*Of/ID;}float Cx(vec2 Ck){return dot(Ck,Ck);}vec3 Eq(vec2 Ck){vec2 Hr,Jc,FG,Ow;float VF,Xq,TU,Qy,Fp,Dw,Yg,EH;int Nc;Nc=(ON==2.||ON==4.)?1:0;if(Nc>0){Hr=-vec2(0.,GB);Jc=vec2(Bl/2.*Gs(Ck.x),0.5*GB);VF=Cx(Ck-Hr);Xq=Cx(Ck-Jc);TU=min(VF,Xq);FG=(TU==VF)?Hr:Jc;Fp=0.5;TU=abs(sqrt(TU)-Fp);}else{if(GB!=0.)Ck=0.5*vec2(Ck.x-GB*Bl*Ck.y,GB*Bl*Ck.x+Ck.y);Hr=vec2(Bl/2.*Gs(Ck.x),0.);Jc=vec2(Bl*Gs(Ck.x),0.);VF=sqrt(Cx(Ck-Hr));Xq=abs(sqrt(Cx(Ck-Jc))-1.5);TU=min(VF,Xq);FG=(TU==VF)?Hr:Jc;Fp=(TU==VF)?0.:1.5;}Ow=Ck-FG;Qy=Pe.x-Pe.y;Yg=(Nc>0&&Qy<0.||Nc==0&&abs(Qy-2.)==1.)?-1.:1.;Dw=(0.5-atan(Ow.y,-Ow.x)/(2.*KN))*Yg;if(Nc==0&&abs(Qy-2.)<=1.)Dw+=1./6.;EH=Gs(length(Ow)-Fp);return vec3(TU*EH,Fp*EH*Yg,Dw);}int YO(vec2 w){vec2 PY,On;float Qy;bool Sj,Vs;Qy=Pe.x-Pe.y;Sj=(mod(Pe.y,2.)==1.);On=Ro(w,sin(-KN/3.+vec2(0.5*KN,0.)))-vec2(0.,0.3);PY=Ro(w,sin(KN/3.+vec2(0.5*KN,0.)));Vs=(Qy==-2.&&On.y>0.||!Sj&&(Qy==-3.&&w.y>-0.3||Qy==-2.||Qy==-1.&&On.y>0.||Qy==1.&&On.y<0.||(Qy==2.||Qy==3.)&&w.x<0.||Qy==4.||Qy==5.)||Sj&&(Qy==-3.||Qy==0.&&PY.x>0.||(Qy==1.||Qy==2.)&&w.x>0.||Qy==3.||Qy==4.&&On.x<0.||Qy==5.&&On.y<0.));return Vs?0:1;}float Pv(vec3 Ck){vec3 Ai,VW;float Jp,TU,Cg,Fp,Dw,BP,Ei,Yg;int Xd;Jp=TD;if(ON>0.){Ai=Ck;Ai.xz=(Ai.xz-XH)/Rk;Ei=Rk*NO(Ai.xz);VW=Eq(Ai.xz);Cg=Rk*abs(VW.x);Fp=abs(VW.y);Dw=18.*VW.z;Xd=(ON<=2.&&Fp!=0.&&YO(Ai.xz)>0)?1:0;TU=Ai.y-KR;La(XL);BP=DA(Ck.xz);TU=0.9*(Ai.y-BP);if(Xd>0){TU=0.8*NB(TU,-max(length(vec2(Cg,min(0.,Zj+0.05-Ai.y+0.1)))-AU,Zj-0.05-Ai.y),0.1);}La(Iq);if(Xd>0){TU=max(max(abs(Cg)-AU,Ai.y-Zj),-(length(vec2(abs(fract(9.*Fp*Dw+0.5)-0.5)/3.,Ai.y)-vec2(0.,min(Ai.y,Zj-0.3)))-0.12));La(Wa);TU=Vb(vec2(Cg-MC.x*CF,Ai.y-Zj-0.01),vec2(0.005,0.01),0.003);La(SE);TU=WM(vec3(Cg-MC.x*CF,Ai.y-Zj,(fract(36.*Fp*Dw+0.5)-0.5)/3.),vec3(0.015,0.005,0.002),0.001);La(SE);TU=min(length(vec2(Cg-AU+0.05,Ai.y-Zj-0.12))-0.008,max(Vb(vec2(Cg-AU+0.05,(fract(9.*Fp*Dw+0.5)-0.5)/3.),vec2(0.007,0.001),0.001),abs(Ai.y-Zj-0.06)-0.06));La(EU);if(VW.y<0.&&BP<Zj){Ai=vec3(Cg-0.22,Ai.y-Zj-0.4,Ei);Yg=length(Ai.xz);TU=min(max(Yg-0.012,abs(Ai.y+0.2)-0.2),max(Yg-0.022,abs(Ai.y+0.015)-0.016));La(QT);}}}return Jp;}void NK(){float GW,Qy;XH=Pz(Pe*Rk);GW=IH(Pe);if(IH(17.11*Pe)>0.4){GB=floor(3.*GW)-1.;ON=3.;}else{GB=2.*floor(2.*GW)-1.;ON=4.;}Qy=Pe.x-Pe.y;if(Qy==0.)ON=1.;else if(abs(Qy)==1.)ON=mod(Pe.x,2.)+1.;else if(Qy==-2.||Qy==-3.||Qy==5.)ON=2.;else if(Qy==2.||Qy==3.||Qy==4.)ON=1.;if(ON<=2.){if(ON==1.&&(Qy==1.||Qy==2.||Qy==3.))GB=0.;else if(ON==1.&&Qy==4.)GB=-1.;else if(ON==2.&&Qy==5.)GB=1.;else GB=2.*mod(Pe.x,2.)-1.;}}\nfloat SR(vec3 PD,vec3 Ha){vec3 Co,Wr,FK;vec2 FC[3],PU;float FT,TU,Yg,IY,KJ;int Bd;if(Ha.x==0.)Ha.x=1e-4;if(Ha.z==0.)Ha.z=1e-4;IY=5e-4;FC[0]=vec2(1.,0.);FC[1]=0.5*vec2(1.,Bl);FC[2]=0.5*vec2(1.,-Bl);for(int HZ=0;HZ<3;HZ++)FC[HZ]*=Gs(dot(FC[HZ],Ha.xz));FK=Rk/vec3(dot(Ha.xz,FC[0]),dot(Ha.xz,FC[1]),dot(Ha.xz,FC[2]));Co=0.5*Bl-vec3(dot(PD.xz,FC[0]),dot(PD.xz,FC[1]),dot(PD.xz,FC[2]))/Rk;FT=0.;Pe=My(PD.xz/Rk);PU=Pz(Pe);Bd=1;for(int Go=YS;Go<320;Go++){KJ=IY*(1.+Fh*FT);if(Bd>0){Wr=(Co+vec3(dot(PU,FC[0]),dot(PU,FC[1]),dot(PU,FC[2])))*FK;Yg=QC(Wr);NK();Bd=0;}TU=Pv(PD+FT*Ha);if(FT+TU<Yg){FT+=TU;}else{FT=Yg+KJ;Pe=My((PD.xz+FT*Ha.xz)/Rk);PU+=Bl*((Yg==Wr.x)?FC[0]:((Yg==Wr.y)?FC[1]:FC[2]));Bd=1;}if(TU<KJ||FT>TD)break;}if(TU>=KJ)FT=TD;return FT;}vec3 Rg(vec3 Ck){vec4 Sa;vec2 DR;DR=5e-4*vec2(1.,-1.);for(int Go=YS;Go<=3;Go++){Sa[Go]=Pv(Ck+((Go<2)?((Go==0)?DR.xxx:DR.xyy):((Go==2)?DR.yxy:DR.yyx)));}Sa.x=-Sa.x;return normalize(2.*Sa.yzw-dot(Sa,vec4(1.)));}float UC(vec3 PD,vec3 Ha){vec3 Ck;vec2 SA;float GJ,TU,GW;GJ=1.;TU=0.02;SA=vec2(-999.);for(int Go=YS;Go<30;Go++){Ck=PD+TU*Ha;Pe=My(Ck.xz/Rk);if(Pe!=SA){SA=Pe;NK();}GW=Pv(Ck);GJ=min(GJ,smoothstep(0.,0.05*TU,GW));TU+=max(GW,0.01);if(GJ<0.05||TU>Rk)break;}return 0.5+0.5*GJ;}void Dn(){vec2 GW;Zs=Pz(Ul*SV);GW=Ks(73.*Ul+1.1);VN=vec3(0.2*Bl*SV*(0.5+0.5*GW.x)*sin(2.*KN*GW.y+vec2(0.5*KN,0.)),GW.x+GW.y).xzy;}void BC(vec2 QP,vec2 Li){Pe=QP;NK();Lr=(Rk*abs(Eq((Li-XH)/Rk).x)<0.9||DA(Zs)<KR+0.1)?0.:0.01+0.99*IH(17.11*Ul);}float Ut(vec3 Ck){vec3 Ai;float Jp,TU,GW;Jp=TD;if(Lr>0.){Ai=Ck;Ai.xz=(Ai.xz-Zs)/SV;Ai.xz-=VN.xz;GW=0.15+0.15*VN.y;Ai.y-=GW+DA(Zs);TU=max(length(Ai.xz)-0.05,Ai.y-GW);La(Up);if(Lv(VN.xz)>0.){Ai.y-=GW+0.55;TU=RF(Ai.xzy,sin(0.085*KN+vec2(0.5*KN,0.)),0.18,0.4);}else{Ai.y-=GW+0.25;TU=Pm(Yx(Ai,0.25),Yx(vec3(Ai.x,abs(Ai.y)-0.25,Ai.z),0.17),0.2);}La(Kb);}return Jp;}float XP(vec3 PD,vec3 Ha){vec3 FK,Co,Wr;vec2 FC[3],PU,Li,QP;float FT,TU,Yg,IY;int Bd;if(Ha.x==0.)Ha.x=1e-4;if(Ha.z==0.)Ha.z=1e-4;IY=5e-4;FC[0]=vec2(1.,0.);FC[1]=0.5*vec2(1.,Bl);FC[2]=0.5*vec2(1.,-Bl);for(int HZ=0;HZ<3;HZ++)FC[HZ]*=Gs(dot(FC[HZ],Ha.xz));FK=SV/vec3(dot(Ha.xz,FC[0]),dot(Ha.xz,FC[1]),dot(Ha.xz,FC[2]));Co=0.5*Bl-vec3(dot(PD.xz,FC[0]),dot(PD.xz,FC[1]),dot(PD.xz,FC[2]))/SV;FT=0.;Ul=My(PD.xz/SV);PU=Pz(Ul);Bd=1;for(int Go=YS;Go<220;Go++){if(Bd>0){Wr=(Co+vec3(dot(PU,FC[0]),dot(PU,FC[1]),dot(PU,FC[2])))*FK;Yg=QC(Wr);Dn();}Li=Zs+VN.xz;QP=My(Li/Rk);if(Bd>0||Pe!=QP)BC(QP,Li);Bd=0;TU=Ut(PD+FT*Ha);if(FT+TU<Yg){FT+=TU;}else{FT=Yg+IY;Ul=My((PD.xz+FT*Ha.xz)/SV);PU+=Bl*((Yg==Wr.x)?FC[0]:((Yg==Wr.y)?FC[1]:FC[2]));Bd=1;}if(TU<IY||FT>TD)break;}if(TU>=IY)FT=TD;return FT;}vec3 We(vec3 Ck){vec4 Sa;vec2 DR;DR=1e-3*vec2(1.,-1.);for(int Go=YS;Go<=3;Go++){Sa[Go]=Ut(Ck+((Go<2)?((Go==0)?DR.xxx:DR.xyy):((Go==2)?DR.yxy:DR.yyx)));}Sa.x=-Sa.x;return normalize(2.*Sa.yzw-dot(Sa,vec4(1.)));}float ZA(vec3 PD,vec3 Ha){vec3 Ck;vec2 SA,Li;float GJ,TU,GW;GJ=1.;TU=0.02;SA=vec2(-999.);for(int Go=YS;Go<30;Go++){Ck=PD+TU*Ha;Ul=My(Ck.xz/SV);if(Ul!=SA){SA=Ul;Dn();}Li=Zs+VN.xz;BC(My(Li/Rk),Li);if(Lr>0.){GW=Ut(Ck);GJ=min(GJ,smoothstep(0.,0.1*TU,GW));TU+=GW;}else TU+=0.1*SV;if(GJ<0.05||TU>2.*SV)break;}return 0.5+0.5*GJ;}float Df(vec3 Ck,float Jp,float HE){vec3 Ai,DE;float TU,Yg,RS;Ai=Ck;Ai.xz=abs(Ai.xz);Ai.z=abs(Ai.z-MC.y);Ai-=vec3(MC.x,-0.6,0.2);TU=Tq(Ai.yzx,0.15,0.08);ML(Zw);Ai=Ck;DE=Ai;Yg=0.25;if(Ai.z*HE>0.5){RS=-0.25*(Ai.z*HE-0.5);Yg+=RS;DE.y-=RS;}TU=0.9*WM(DE,vec3(0.27,Yg,1.55),0.4);ML(By);Ai=Ck;Ai.z=(HE==0.)?abs(Ai.z)-1.8:Ai.z+1.8*HE;TU=Tq(Ai.xzy,0.3,0.5);ML(Dj);if(HE>0.){Ai=Ck;Ai.yz-=vec2(-0.25,1.9);TU=Tq(Ai,0.1,0.1);ML(GF);}else if(HE<0.){Ai=Ck;Ai.x=abs(Ai.x)-0.18;Ai.yz-=vec2(-0.25,-1.9);TU=Tq(Ai,0.08,0.1);ML(ZN);}return Jp;}float OA(vec3 Ck){vec3 Ai;float Jp;Jp=TD/CF;for(int HZ=YS;HZ<Em;HZ++){Ai=(Ck-EQ[HZ].xyz)/CF;Ai.xz=Ro(Ai.xz,sin(EQ[HZ].w+vec2(0.5*KN,0.)));Jp=Df(Ai,Jp,(HZ>0)?((HZ<Em-1)?0.:-1.):1.);}return Jp*CF;}float RW(vec3 PD,vec3 Ha){float FT,TU;FT=0.;for(int Go=YS;Go<160;Go++){TU=OA(PD+FT*Ha);FT+=TU;if(TU<0.0005||FT>TD)break;}return FT;}vec3 Ql(vec3 Ck){vec4 Sa;vec2 DR;DR=1e-3*vec2(1.,-1.);for(int Go=YS;Go<=3;Go++){Sa[Go]=OA(Ck+((Go<2)?((Go==0)?DR.xxx:DR.xyy):((Go==2)?DR.yxy:DR.yyx)));}Sa.x=-Sa.x;return normalize(2.*Sa.yzw-dot(Sa,vec4(1.)));}float TH(vec3 PD,vec3 Ha){float GJ,TU,GW;GJ=1.;TU=0.02;for(int Go=YS;Go<30;Go++){GW=OA(PD+TU*Ha);GJ=min(GJ,smoothstep(0.,0.05*TU,GW));TU+=max(GW,0.01);if(GJ<0.05||TU>TD)break;}return 0.5+0.5*GJ;}vec3 Kf(vec3 Ha){Ha.y=abs(Ha.y);return mix(vec3(0.3,0.35,0.7),vec3(0.8,0.8,0.8),clamp(2.*(PQ(4.*Ha.xz/Ha.y+0.1*OV)-0.1)*Ha.y,0.,1.));}\nvec4 Fl(vec3 Ck,vec3 DZ,inout vec2 Co){vec4 Ez;vec3 VW;vec2 w;float Cg,Fp,GW,Ae;int Xd,SI;SI=(ED>0&&DZ.y>0.1)?1:0;w=(Ck.xz-XH)/Rk;VW=Eq(w);Cg=Rk*abs(VW.x);Fp=abs(VW.y);Ae=DA(Ck.xz);if(LM==Wa){Ez=vec4(0.6,0.4,0.1,0.1);if(Ck.y>Zj-0.05&&Cg<AU-0.02){Ez=mix(Ez,vec4(0.5,0.5,0.4,0.)*(0.9+0.1*PQ(8.*Ck.xz)),step(0.,AU-0.02-Cg));if(Cg<0.12&&step(0.45,abs(fract(648.*Fp*abs(VW.z))-0.5))>0.)Ez=vec4(0.4,0.4,0.3,0.);}else Ez*=0.8+0.2*step(0.05,abs(fract(32.*Ck.y+0.5)-0.5));if(SI>0&&Cg<AU-0.001){if(Ck.y>Zj-0.05)Ez=mix(QX,Ez,smoothstep(0.4,0.5,Ae-Zj));else Ez=QX;}Co=(SI>0)?vec2(4.,0.5):vec2(32.,0.3);}else if(LM==Iq){Ez=(SI>0)?QX:vec4(0.,0.7,0.,0.)*(0.6+0.4*PQ(4.*Ck.xz));Xd=(ON<=2.&&Fp!=0.&&YO(w)>0)?1:0;if(Xd>0){Ez=mix((SI>0)?QX:vec4(0.5,0.55,0.5,0.)*(0.98+0.02*sin(128.*KN*(Ck.y-2.*PQ(0.25*Ck.xz)))),Ez,smoothstep(0.5,0.8,DZ.y));GW=Ae-Ck.y;if(Cg<AU+0.01){if(GW>0.3&&Ck.y<Zj+0.12)Ez.rgb=vec3(0.5,0.3,0.);if(GW>0.)Ez*=1.-0.3*smoothstep(0.,0.1,GW);}}if(Lr>0.&&length((Ck.xz-Zs)/SV-VN.xz)<0.06)Ez*=0.8;Co=vec2(2.,1.);}return Ez;}vec4 Bu(){vec4 Ez;Ez=(BT.y>0.)?vec4(0.9,0.,0.,0.3):vec4(0.,0.,0.9,0.3);if(LM==By){Ez=(abs(BT.y-0.22)<0.26)?vec4(0.3,0.3,0.5,0.3):((abs(abs(BT.y-0.22)-0.28)<0.02)?vec4(0.4,0.4,0.8,0.3):Ez);}else if(LM==Dj){Ez*=0.8;}else if(LM==Zw){Ez=(length(BT.yz)<0.07)?vec4(0.2,0.2,0.2,0.1):vec4(0.6,0.6,0.6,0.2);}else if(LM==GF){if(BT.z>0.08)Ez=vec4(1.,1.,0.,-1.);}else if(LM==ZN){if(BT.z<-0.08)Ez=vec4(1.,0.,0.,-1.);}return Ez;}vec4 MP(vec3 PD,vec3 DZ,inout vec2 Co){vec4 Ez;if(LM==Iq||LM==Wa){Ez=Fl(PD,DZ,Co);}else if(LM==XL){Ez=vec4(0.6,0.6,0.7,0.);}else if(LM==Up){Ez=vec4(0.5,0.3,0.1,0.1);Co=vec2(32.,1.);}else if(LM==Kb){Ez=vec4(0.3,0.6*min(1.,(1.2-0.4*Lr)),0.1,0.);if(ED>0)Ez=mix(Ez,QX,smoothstep(-0.8,-0.4,DZ.y));else Ez=mix(Ez,vec4(0.9,0.9,0.,0.1),step(0.7,RB(64.*PD.xzy)));Co=vec2(16.,2.);}else if(LM==EU){Ez=vec4(0.8,0.8,0.9,0.2);}else if(LM==QT){Ez=(PD.y<Zj+0.37)?vec4(0.8,0.8,0.9,0.2):vec4(1.,1.,0.4,-1.);}else if(LM==SE){Ez=vec4(0.7,0.7,0.75,0.1);}else if(LM>=By&&LM<=ZN){Ez=Bu();}return Ez;}void EY(){float HM,Sr;HM=1.;Sr=1.5;HV[0]=vec4(0.,0.,-1./6.,Sr);HV[1]=vec4(1.,0.,1./3.,-HM);HV[2]=vec4(0.,1.,5./6.,Sr);HV[3]=vec4(-1.,1.,-1./3.,HM);HV[4]=vec4(-1.,2.,1.,HM);HV[5]=vec4(0.,1.,-1./6.,Sr);HV[6]=vec4(1.,1.,1./6.,Sr);HV[7]=vec4(1.,2.,1.,HM);HV[8]=vec4(2.,1.,1./2.,-Sr);HV[9]=vec4(2.,0.,-1./2.,Sr);HV[10]=vec4(3.,-1.,-1./6.,Sr);HV[11]=vec4(4.,-1.,1./3.,-HM);HV[12]=vec4(3.,0.,-1./2.,-Sr);HV[13]=vec4(3.,1.,1./2.,Sr);HV[14]=vec4(2.,2.,5./6.,Sr);HV[15]=vec4(1.,2.,-1./3.,HM);HV[16]=vec4(1.,3.,1.,HM);QG[0]=0.;for(int HZ=0;HZ<=Oj-1;HZ++)QG[HZ+1]=QG[HZ]+abs(HV[HZ].w);Uc=QG[Oj];}vec2 Mu(float Nk){vec4 Gk;vec2 Xy,AD;float Jx,UK,BL,AM;Nk/=3.;Xy=floor(Nk/Uc)*vec2(2.);Nk=mod(Nk,Uc);for(int HZ=0;HZ<=Oj-1;HZ++){if(Nk>=QG[HZ]&&Nk<QG[HZ+1]){Gk=HV[HZ];Jx=2.*(Nk-QG[HZ])/(QG[HZ+1]-QG[HZ])-1.;break;}}Xy+=Gk.xy;if(abs(Gk.w)==1.5){UK=1.5;AM=Bl;BL=KN/6.;Jx*=Gs(Gk.w);}else{UK=0.5;AM=1.;BL=-Gs(Gk.w)*KN/3.;}AD=vec2(-1.,1.)*sin(KN*Gk.z+vec2(0.,0.5*KN));return(Pz(Xy)+AM*AD-UK*Ro(AD,sin(Jx*BL+vec2(0.5*KN,0.))))*Rk;}vec3 Iu(vec3 PD,vec3 Ha){vec4 Ez;vec3 CO,DZ,IL,Wv;vec2 Co,Li;float Av,WZ,YK,Vo,GJ,Kw;int Pi,Nx,CS;Kw=0.;YK=0.;QX=vec4(0.8,0.8,0.85,0.05);CO=Kf(Ha);Co=vec2(0.);for(int HZ=YS;HZ<=1;HZ++){Av=XP(PD,Ha);Pi=LM;WZ=SR(PD,Ha);Nx=LM;Vo=RW(PD,Ha);if(min(WZ,Av)<min(Vo,TD)){if(WZ<Av){Vo=WZ;LM=Nx;}else{Vo=Av;LM=Pi;}}if(HZ==0&&Vo<TD&&LM==XL){PD+=Vo*Ha;Ha=reflect(Ha,Xh(4.*PD,vec3(0.,1.,0.),0.1));PD+=0.01*Ha;YK=Vo;Kw=0.2;}else break;}CS=0;if(Vo<TD){PD+=Vo*Ha;if(Vo==WZ){Pe=My(PD.xz/Rk);NK();DZ=Rg(PD);}else if(Vo==Av){Ul=My(PD.xz/SV);Dn();Li=Zs+VN.xz;BC(My(Li/Rk),Li);DZ=We(PD);}else{DZ=Ql(PD);}Ez=MP(PD,DZ,Co);if(LM==By&&DA(PD.xz)<PD.y+0.1){IL=reflect(Ha,DZ);Kw=(abs(BT.y-0.22)<0.26)?0.6:0.2;}if(Ez.a>=0.){Wv=PD+0.01*DZ;if(Co.y>0.)DZ=Xh(Co.x*PD,DZ,Co.y);GJ=min(TH(Wv,JO),UC(Wv,JO));GJ=min(GJ,ZA(Wv,JO));CS=1;}else{CO=Ez.rgb*(0.4+0.6*max(-dot(Ha,DZ),0.));}}if(CS>0){CO=Ez.rgb*(0.3+0.2*max(dot(JO*vec3(-1.,1.,-1.),DZ),0.)+0.7*GJ*max(dot(DZ,JO),0.))+Ez.a*step(0.95,GJ)*pow(max(dot(reflect(JO,DZ),Ha),0.),32.);CO=mix(CO,Kf(Ha),1.-exp(min(0.,1.-5.*(YK+Vo)/TD)));}if(Kw>0.)CO=mix(0.9*CO,Kf(IL),Kw);return clamp(CO,0.,1.);}void mainImage(out vec4 WI,in vec2 Yt){mat3 Jg;vec4 TY,Zb;vec3 PD,Ha,CO,AD,DV;vec2 ZJ,OE,Qp,Sn[Le],MT[Le],VJ,Xu,FG[3];float Hn,LZ,RJ,Ko,CW,Im,Nk,CB;int Hv,Mh;bool Lz;\nFX=iFrame;ZJ=iResolution.xy;OE=2.*Yt.xy/ZJ-1.;OE.x*=ZJ.x/ZJ.y;OV=iTime;Zb=iDate;TY=iMouse;TY.xy=TY.xy/ZJ-0.5;\nOV=mod(OV,3600.)+30.*floor(Zb.w/3600.)+20.;Ko=ZJ.x/ZJ.y;Lz=true;if(Lz){VJ=(1./5.)*vec2(Ko,1.);Sn[0]=(1.-VJ.y)*vec2(Ko,-1.);Sn[1]=(1.-VJ.y)*vec2(Ko,1.);Sn[2]=(1.-VJ.y)*vec2(-Ko,1.);for(int HZ=0;HZ<Le;HZ++)MT[HZ]=abs(OE-Sn[HZ])-VJ;}Mh=-1;if(TY.z>0.){Mh=0;if(Lz){for(int HZ=0;HZ<Le;HZ++){Xu=2.*TY.xy-Sn[HZ]/vec2(Ko,1.);if(Lv(abs(Xu))<VJ.y){Mh=HZ+1;Xu/=2.*VJ.y;break;}}}if(Mh==0)Xu=TY.xy;}Hv=0;if(Lz){for(int HZ=0;HZ<Le;HZ++){if(Lv(MT[HZ])<0.){OE=(OE-Sn[HZ])/VJ.y;Hv=HZ+1;break;}}}if(Mh>0&&(Hv==0||Hv==Mh))Hv=Mh-Hv;Rk=24.;SV=1.;KR=1.;AU=0.25;Zj=2.;CF=0.2;EY();ED=(OE.x/Ko>-1.+2.*LQ(0.25,0.75,0.01,fract(0.02*(OV-10.))))?1:0;Im=(16./Rk)*0.74*CF;MC=vec2(0.45,0.8);Gb=0.2;LZ=0.;Hn=0.;if(TY.z>0.&&Hv==Mh){LZ+=2.*KN*Xu.x;Hn+=0.5*KN*Xu.y;}DV=vec3(0.);for(int HZ=YS;HZ<Em;HZ++){Nk=(OV+30.)*Gb-float(HZ)*Im;for(int Go=YS;Go<3;Go++)FG[Go]=Mu(Nk+((Go>0)?sign(float(Go)-1.5)*MC.y*CF:0.));EQ[HZ].xz=FG[0];EQ[HZ].y=Zj+0.9*CF;DV+=EQ[HZ].xyz;AD.xy=FG[2]-FG[1];EQ[HZ].w=0.5*KN-atan(AD.y,AD.x);}CB=float(Em);DV/=CB;Nk=(OV+30.)*Gb;Fh=0.;if(Hv==0||Hv==1){PD.xz=Mu(Nk-((Hv==0)?CB+2.:-3.)*Im);PD.y=Zj+0.3;AD=normalize(((Hv==0)?EQ[Em-2].xyz:EQ[1].xyz)-PD);LZ+=atan(AD.z,-AD.x)-0.5*KN;Hn+=asin(AD.y);Hn=clamp(Hn,-0.2*KN,0.15*KN);RJ=3.;TD=12.*Rk;Fh=1.;}else if(Hv==2){PD=vec3(0.,20.,(-1.5*Bl+(2./Uc)*Nk)*Rk);PD.xz=SZ(PD.xz,-KN/3.);PD.x-=1.5*Rk;AD=normalize(DV-PD);LZ=0.03*LZ+atan(AD.z,-AD.x)-0.5*KN;Hn=0.03*Hn+asin(AD.y);RJ=40.;TD=30.*Rk;}else if(Hv==3){PD=vec3(0.,40.,(-3.*Bl+(2./Uc)*Nk)*Rk);PD.xz=SZ(PD.xz,-KN/3.);PD.x+=1.6*Rk;LZ+=KN/3.;Hn-=0.15*KN;Hn=clamp(Hn,-0.4*KN,-0.1*KN);RJ=5.;TD=30.*Rk;}Jg=Id(Hn,LZ);JO=normalize(vec3(0.,1.5,-1.));JO.xz=SZ(JO.xz,-KN/3.);const float AQ=1.;CO=vec3(0.);CW=2.*mod(dot(mod(floor(0.5*(OE+1.)*ZJ),2.),vec2(1.)),2.)-1.;for(float BL=float(YS);BL<AQ;BL++){Qp=(OE+step(1.5,AQ)*SZ(vec2(0.5/ZJ.y,0.),CW*(0.667*BL+0.5)*KN))/RJ;Ha=Jg*normalize(vec3(2.*tan(0.5*atan(Qp.x/Ko))*Ko,Qp.y,1.));CO+=(1./AQ)*Iu(PD,Ha);}if(Lz){for(int HZ=0;HZ<Le;HZ++){if(Lv(MT[HZ])<0.&&OR(abs(MT[HZ]))*ZJ.y<3.)CO=vec3(0.7,0.3,0.3);}}WI=vec4(CO,1.);}\n",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}