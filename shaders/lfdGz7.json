{
    "Shader": {
        "info": {
            "date": "1711529196",
            "description": "Temples in flooded valley (mouseable)",
            "flags": 0,
            "hasliked": 0,
            "id": "lfdGz7",
            "likes": 14,
            "name": "Flooded Valley",
            "published": 3,
            "tags": [
                "landscape",
                "temple",
                "architecture",
                "flight"
            ],
            "usePreview": 1,
            "username": "dr2",
            "viewed": 366
        },
        "renderpass": [
            {
                "code": "#define Ez(x)(sin((x)+vec2(0.5*Ck,0.)))\n#define Jp(Kb)if(TU<HE){HE=TU; SE=Kb;}\n#define La(Kb)if(TU<HE){HE=TU; SE=Kb; Vb=Tq;}\n#define Li min(FX,0)\nvec4 GW;vec3 Vb,EH,LZ,XY;vec2 LI,QP,VW,XH,NK,Lr;float Qh,Id,By,Dj,Nk,Sr,GB,ON,EQ,YS,JG,IH;int FX,SE;const int Pi=1,Nx=2,LM=3,QT=4,Zw=5,Bh=6,CS=7;const float Ck=3.1415927,We=1.7320508;float Jc(vec2 TH,vec2 Ro){vec2 TU;TU=abs(TH)-Ro;return min(max(TU.x,TU.y),0.)+length(max(TU,0.));}float Oj(vec3 TH,vec3 Ro,float Yx){return length(max(abs(TH)-Ro,0.))-Yx;}float RF(vec3 TH,float WM){return length(TH)-WM;}float My(vec3 TH,float WM,float SV){return max(length(TH.xy)-WM,abs(TH.z)-SV);}float KN(vec3 TH,float WM,float SV){return length(vec3(TH.xy,sign(TH.z)*(max(0.,abs(TH.z)-SV))))-WM;}float PU(vec3 TH,float WM,float Yx,float SV){return length(max(vec2(length(TH.xy)-WM,abs(TH.z)-SV),0.))-Yx;}vec2 DV(vec2 TH){vec3 ZJ,Fp,Ow;ZJ.xz=vec2((1./We)*TH.x-(1./3.)*TH.y,(2./3.)*TH.y);ZJ.y=-ZJ.x-ZJ.z;Fp=floor(ZJ+0.5);Ow=abs(Fp-ZJ);Fp-=step(Ow.yzx,Ow)*step(Ow.zxy,Ow)*dot(Fp,vec3(1.));return Fp.xz;}vec2 ZN(vec2 SV){return vec2(We*(SV.x+0.5*SV.y),(3./2.)*SV.y);}float Yc(vec2 TH){TH=abs(TH);return(We/2.)-TH.x+0.5*min(TH.x-We*TH.y,0.);}float Bl(float Gs){return(Gs!=0.)?sign(Gs):1.;}float Sn(vec2 TH){return min(TH.x,TH.y);}float OR(vec2 TH){return max(TH.x,TH.y);}float QC(vec3 TH){return max(TH.x,max(TH.y,TH.z));}float TY(vec3 TH){return min(TH.x,min(TH.y,TH.z));}float LQ(float Gb,float HM,float WM){float SV;SV=clamp(0.5+0.5*(HM-Gb)/WM,0.,1.);return mix(HM-SV*WM,Gb,SV);}float Kf(float Gb,float HM,float WM){return-LQ(-Gb,-HM,WM);}float Iu(float Lv,float EU,float AD,float FK){return(1.-smoothstep(EU-AD,EU+AD,FK))*smoothstep(Lv-AD,Lv+AD,FK);}mat3 CW(float IY,float ID){vec2 RW,Bu,SZ;RW=vec2(IY,ID);Bu=cos(RW);SZ=sin(RW);return mat3(Bu.y,0.,-SZ.y,0.,1.,0.,SZ.y,0.,Bu.y)*mat3(1.,0.,0.,0.,Bu.x,-SZ.x,0.,SZ.x,Bu.x);}vec2 NS(vec2 Tq,float BL){vec2 HV;HV=sin(BL+vec2(0.5*Ck,0.));return vec2(dot(Tq,vec2(HV.x,-HV.y)),dot(Tq.yx,HV));}vec2 Mh(vec2 Tq,vec2 HV){return vec2(dot(Tq,vec2(HV.x,-HV.y)),dot(Tq.yx,HV));}vec3 GF(vec3 ZJ){return ZJ.z*mix(vec3(1.),clamp(abs(fract(ZJ.xxx+vec3(1.,2./3.,1./3.))*6.-3.)-1.,0.,1.),ZJ.y);}const float Im=43758.54;float UG(vec2 TH){return fract(sin(mod(dot(TH,vec2(37.,39.)),2.*Ck))*Im);}vec2 Wr(vec2 TH){vec2 JX=vec2(37.,39.);return fract(sin(mod(dot(TH,JX)+vec2(0.,JX.x),2.*Ck))*Im);}float HI(vec2 TH){vec2 Gs,ED,Ks;ED=floor(TH);Ks=fract(TH);Ks=Ks*Ks*(3.-2.*Ks);Gs=mix(Wr(ED),Wr(ED+vec2(0.,1.)),Ks.y);return mix(Gs.x,Gs.y,Ks.x);}float PQ(vec2 TH){float Of,BL;Of=0.;BL=1.;for(int HZ=0;HZ<5;HZ++){Of+=BL*HI(TH);BL*=0.5;TH*=2.;}return Of*(1./1.9375);}float RB(vec3 TH,vec3 CB){vec3 Ro;float BL;Ro=vec3(0.);BL=1.;for(int HZ=0;HZ<5;HZ++){Ro+=BL*vec3(HI(TH.yz),HI(TH.zx),HI(TH.xy));BL*=0.5;TH*=2.;}return dot(Ro,abs(CB));}vec3 Jx(vec3 TH,vec3 CB,float Of){vec4 Eq;vec3 SV;vec2 DR;DR=vec2(0.1,0.);for(int HZ=Li;HZ<4;HZ++){Eq[HZ]=RB(TH+((HZ<2)?((HZ==0)?DR.xyy:DR.yxy):((HZ==2)?DR.yyx:DR.yyy)),CB);}SV=Eq.xyz-Eq.w;return normalize(CB+Of*(SV-CB*dot(CB,SV)));}float Fl(vec3 TH,float HE){vec3 Tq;float TU,Gs,Ro;TH.xz=vec2(-TH.z,TH.x);Tq=TH;Gs=1.;if(Tq.z<-0.1){Ro=(Tq.z+0.1)*(Tq.z+0.1);Gs*=1.-0.1*Ro;Tq.y-=0.05*Ro;}else if(Tq.z>0.1){Ro=(Tq.z-0.1)*(Tq.z-0.1);Gs*=1.-0.03*Ro;}Tq.x*=0.8;TU=KN(Tq,max(Gs,0.),2.);Tq=TH;Tq.yz=NS(Tq.yz-vec2(1.1,-4.2),-0.05*Ck);Gs=0.2*(1.+0.25*Tq.z);Tq.y*=0.7;TU=min(TU,KN(Tq,Gs,1.5));Tq=TH;Tq.yz-=vec2(1.7,-0.2);TU=min(TU,My(Tq.xzy,0.4,0.4));Tq=TH;Tq.yz-=vec2(0.4,-1.);Gs=1.1;if(Tq.z<0.){Ro=Tq.z*Tq.z;Gs*=1.-0.2*Ro;Tq.y-=0.1*Ro;}Tq.y*=0.8;TU=LQ(TU,KN(Tq,max(Gs,0.),1.5),0.03);Tq=TH;Tq.yz-=vec2(1.4,-6.15);TU=min(TU,max(PU(Tq.yzx,0.5,0.05,0.02),0.35-length(Tq.yz)));Tq=TH;La(QT);Tq=TH;Tq.yz=Mh(Tq.yz-vec2(1.4,-6.15),Lr);TU=Oj(Tq,vec3(0.01,0.32,0.04),0.02);La(Bh);Tq=TH;Tq.yz-=vec2(2.,-0.2);TU=My(Tq.xzy,0.12,0.5);Tq.y-=0.4;Tq.xz=Mh(Tq.xz,Lr);TU=min(TU,Oj(Tq,vec3(4.5,0.02,0.08),0.03));La(Zw);Tq=TH;Tq.x=abs(Tq.x);Tq.xy-=vec2(0.9,-1.4);TU=Oj(Tq,vec3(0.1,0.01,1.4),0.04);Tq.xy=NS(Tq.xy,-0.1*Ck);Tq.z=abs(Tq.z);Tq.yz-=vec2(0.4,0.7);TU=min(TU,My(Tq.xzy,0.06,0.4));La(CS);HE*=0.7;return HE;}float Yt(vec3 TH){TH-=GW.xyz;TH.xz=NS(TH.xz,GW.w);TH.xy=NS(TH.xy,0.05*Ck);return IH*Fl(TH/IH,Qh/IH);}float BP(vec3 IL,vec3 Yx){float FT,TU;FT=0.;for(int HZ=Li;HZ<120;HZ++){TU=Yt(IL+FT*Yx);FT+=TU;if(TU<0.001||FT>Qh)break;}return FT;}vec3 Ae(vec3 TH){vec4 Eq;vec2 DR;DR=1e-3*vec2(1.,-1.);for(int HZ=Li;HZ<4;HZ++){Eq[HZ]=Yt(TH+((HZ<2)?((HZ==0)?DR.xxx:DR.xyy):((HZ==2)?DR.yxy:DR.yyx)));}Eq.x=-Eq.x;return normalize(2.*Eq.yzw-dot(Eq,vec4(1.)));}vec4 WI(){vec4 CO;if(SE==QT){CO=mix(vec4(1.,1.,0.,0.2),vec4(0.1,0.9,0.9,0.2),smoothstep(0.,0.02,abs(Vb.y)-0.05));if(length(vec2(Vb.x,Vb.y/0.8))>1.24&&Vb.y>0.55&&Vb.z>0.4&&abs(abs(Vb.x)-0.3)>0.05)CO=vec4(0.,0.5,0.5,-2.);if(Vb.z>0.)CO=mix(vec4(1.,1.,0.,-1.),CO,step(0.15,length(Vb.xy)));else CO=mix(vec4(0.5+0.5*step(0.5,fract(2.*Id+0.25*sign(Vb.x))),0.,0.,-1.),CO,step(0.2,length(vec2(abs(Vb.x)-0.3,Vb.y))));}else if(SE==Zw){CO=(length(Vb.xz)<4.2)?vec4(0.8,0.8,0.9,0.1):vec4(1.,1.,0.2,0.1);}else if(SE==Bh){CO=(length(Vb.yz)>0.06)?vec4(0.8,0.8,0.9,0.1):vec4(1.,1.,0.2,0.1);}else if(SE==CS){CO=vec4(0.7,0.7,0.75,0.1);}return CO;}float DA(vec3 IL,vec3 Yx){float ZR,TU,SV;ZR=1.;TU=0.02;for(int HZ=Li;HZ<30;HZ++){SV=Yt(IL+TU*Yx);ZR=min(ZR,smoothstep(0.,0.02*TU,SV));TU+=max(SV,0.01);if(ZR<0.05||TU>Qh)break;}return 0.5+0.5*ZR;}float Cx(vec2 TH){return dot(TH,TH);}vec3 QG(vec2 TH){vec2 Xd,YO,Az,ML;float TU,VF,Xq,Qy,WM,Fh,Ro,ZA;bool Nc;Nc=(ON==2.||ON==4.);if(Nc){YO=-vec2(0.,GB);Az=vec2(We/2.*Bl(TH.x),0.5*GB);VF=Cx(TH-YO);Xq=Cx(TH-Az);TU=min(VF,Xq);Xd=(TU==VF)?YO:Az;WM=0.5;TU=abs(sqrt(TU)-WM);}else{if(GB!=0.)TH=0.5*vec2(TH.x-GB*We*TH.y,GB*We*TH.x+TH.y);YO=vec2(We/2.*Bl(TH.x),0.);Az=vec2(We*Bl(TH.x),0.);VF=sqrt(Cx(TH-YO));Xq=abs(sqrt(Cx(TH-Az))-1.5);TU=min(VF,Xq);Xd=(TU==VF)?YO:Az;WM=(TU==VF)?0.:1.5;}ML=TH-Xd;Qy=LI.x-LI.y;Ro=(Nc&&Qy<0.||!Nc&&abs(Qy-2.)==1.)?-1.:1.;Fh=(0.5-atan(ML.y,-ML.x)/(2.*Ck))*Ro;if(!Nc&&abs(Qy-2.)<=1.)Fh+=1./6.;ZA=Bl(length(ML)-WM);return vec3(TU*ZA,WM*ZA*Ro,Fh);}int Ql(vec2 w){vec2 DZ,Co;float Qy;bool Sj,Le;Qy=LI.x-LI.y;Sj=(mod(LI.y,2.)==1.);Co=Mh(w,sin(-Ck/3.+vec2(0.5*Ck,0.)))-vec2(0.,0.3);DZ=Mh(w,sin(Ck/3.+vec2(0.5*Ck,0.)));Le=(Qy==-2.&&Co.y>0.||!Sj&&(Qy==-3.&&w.y>-0.3||Qy==-2.||Qy==-1.&&Co.y>0.||Qy==1.&&Co.y<0.||(Qy==2.||Qy==3.)&&w.x<0.||Qy==4.||Qy==5.)||Sj&&(Qy==-3.||Qy==0.&&DZ.x>0.||(Qy==1.||Qy==2.)&&w.x>0.||Qy==3.||Qy==4.&&Co.x<0.||Qy==5.&&Co.y<0.));return Le?0:1;}\nvoid Ko(){float SV,Qy;VW=ZN(LI*By);SV=UG(LI);if(UG(17.11*LI)>0.4){GB=floor(3.*SV)-1.;ON=3.;}else{GB=2.*floor(2.*SV)-1.;ON=4.;}Qy=LI.x-LI.y;if(Qy==0.)ON=1.;else if(abs(Qy)==1.)ON=mod(LI.x,2.)+1.;else if(Qy==-2.||Qy==-3.||Qy==5.)ON=2.;else if(Qy==2.||Qy==3.||Qy==4.)ON=1.;if(ON<=2.){if(ON==1.&&(Qy==1.||Qy==2.||Qy==3.))GB=0.;else if(ON==1.&&Qy==4.)GB=-1.;else if(ON==2.&&Qy==5.)GB=1.;else GB=2.*mod(LI.x,2.)-1.;}}float Rk(vec2 TH){float Of,BL,Dw,SV;SV=0.;TH*=0.3;Of=0.;BL=1.;Dw=0.;for(int HZ=0;HZ<3;HZ++){Of+=BL*HI(TH);Dw+=BL;BL*=0.4;TH*=2.5;}SV+=YS+2.5+Of/Dw;return SV;}float Rg(vec3 TH){vec3 Tq,Ul;vec2 HV,ww;float HE,TU,Cg,WM,Fh,Ei,Pz,PD,Ro;int OA;HE=Qh;if(ON>0.){Tq=TH;ww=(Tq.xz-VW)/By;Ei=By*Yc(ww);Ul=QG(ww);Cg=By*abs(Ul.x);WM=abs(Ul.y);Fh=18.*Ul.z;OA=(ON<=2.&&WM!=0.&&Ql(ww)>0)?1:0;Pz=Rk(TH.xz);TU=Tq.y-Pz;if(OA>0&&Pz>0.){HV=sin(0.15*Ck+vec2(0.5*Ck,0.));TU=Kf(TU,-0.2-dot(vec2(Cg-EQ-0.5*PQ(0.5*Tq.xz),0.3*Pz-Tq.y),HV),0.2);}TU*=0.9;Jp(Pi);if(OA>0){PD=21.-length(vec2(Tq.y+19.5,Cg));Ro=abs(Ei-2.)-0.1;TU=max(max(abs(abs(PD)-0.06)-0.02,Ro),-max(PD,Ro+0.015));Jp(Nx);}}return HE;}float UC(vec3 IL,vec3 Yx){vec3 TL,OE,Iq;vec2 FC[3],Hr,Hn;float FT,TU,Ro,KJ;bool Zs;if(Yx.x==0.)Yx.x=1e-4;if(Yx.z==0.)Yx.z=1e-4;KJ=1e-3;FC[0]=vec2(1.,0.);FC[1]=0.5*vec2(1.,We);FC[2]=0.5*vec2(1.,-We);for(int JK=0;JK<3;JK++)FC[JK]*=Bl(dot(FC[JK],Yx.xz));TL=By/vec3(dot(Yx.xz,FC[0]),dot(Yx.xz,FC[1]),dot(Yx.xz,FC[2]));OE=0.5*We-vec3(dot(IL.xz,FC[0]),dot(IL.xz,FC[1]),dot(IL.xz,FC[2]))/By;FT=0.;LI=DV(IL.xz/By);Hr=ZN(LI);Zs=true;for(int HZ=Li;HZ<320;HZ++){if(Zs){Iq=(OE+vec3(dot(Hr,FC[0]),dot(Hr,FC[1]),dot(Hr,FC[2])))*TL;Ro=TY(Iq);Hn=We*FC[(Ro==Iq.x)?0:((Ro==Iq.y)?1:2)];Ko();Zs=false;}TU=Rg(IL+FT*Yx);if(FT+TU<Ro){FT+=TU;}else{FT=Ro+KJ;LI=DV((IL.xz+FT*Yx.xz)/By);Hr+=Hn;Zs=true;}if(TU<KJ||FT>Qh)break;}if(TU>=KJ)FT=Qh;return FT;}vec3 SR(vec3 TH){vec4 Eq;vec2 DR;DR=2e-4*vec2(1.,-1.);for(int HZ=Li;HZ<4;HZ++){Eq[HZ]=Rg(TH+((HZ<2)?((HZ==0)?DR.xxx:DR.xyy):((HZ==2)?DR.yxy:DR.yyx)));}Eq.x=-Eq.x;return normalize(2.*Eq.yzw-dot(Eq,vec4(1.)));}float Wn(vec3 IL,vec3 Yx){vec3 TH;vec2 Pe;float ZR,TU,SV;ZR=1.;TU=0.02;Pe=vec2(-999.);for(int HZ=Li;HZ<30;HZ++){TH=IL+TU*Yx;LI=DV(TH.xz/By);if(LI!=Pe){Pe=LI;Ko();}SV=Rg(TH);ZR=min(ZR,smoothstep(0.,0.05*TU,SV));TU+=max(SV,0.01);if(ZR<0.05||TU>By)break;}return 0.5+0.5*ZR;}void Wv(){vec2 Ha;XH=ZN(QP*Dj);Ha=Wr(73.*QP+1.1);XY.xz=0.1*clamp(floor(5.*Ha),2.,4.)+0.04;XY.y=0.6*sqrt(XY.x*XY.z);LZ.xz=(Dj*We/2.-length(XY.xz)-0.05)*(0.5+0.5*Ha.x)*sin(2.*Ck*Ha.y+vec2(0.5*Ck,0.));LZ.y=XY.y+YS+0.05;}void UK(vec2 Nt,vec2 Xy){vec3 Ul;vec2 ww;int OA;LI=Nt;Ko();ww=(Xy-VW)/By;Ul=QG(ww);OA=(ON<=2.&&Ul.y!=0.&&Ql(ww)>0)?1:0;if(OA==0||By*abs(Ul.x)>EQ-2.){JG=0.;}else{JG=max(UG(17.11*QP+1.11)-0.1,0.);NK=Ez(floor(3.*UG(17.11*LI+1.11)+0.5)*Ck/3.);}}float Pm(vec3 TH){vec3 Tq;float HE,TU;HE=Qh;if(JG>0.){Tq=TH;Tq.xz=Mh(Tq.xz-(XH+LZ.xz),NK);Tq.y-=LZ.y;TU=Jc(Tq.xz,XY.xz);TU=min(max(TU,abs(Tq.y-XY.y)-0.05*XY.y),max(TU,Tq.y+XY.y));Jp(LM);TU=length(mod(Tq.xz+0.05,0.1)-0.05)-0.05*XY.y-0.01;TU=max(TU,abs(Jc(Tq.xz,XY.xz-0.025))-0.025);TU=max(TU,abs(Tq.y)-XY.y);Jp(LM);}return HE;}float SI(vec3 IL,vec3 Yx){vec3 TL,OE,Iq;vec2 FC[3],Hr,Hn,Xy,Nt;float FT,TU,Ro,KJ;bool Zs;if(Yx.x==0.)Yx.x=1e-4;if(Yx.z==0.)Yx.z=1e-4;KJ=1e-3;FC[0]=vec2(1.,0.);FC[1]=0.5*vec2(1.,We);FC[2]=0.5*vec2(1.,-We);for(int JK=0;JK<3;JK++)FC[JK]*=Bl(dot(FC[JK],Yx.xz));TL=Dj/vec3(dot(Yx.xz,FC[0]),dot(Yx.xz,FC[1]),dot(Yx.xz,FC[2]));OE=0.5*We-vec3(dot(IL.xz,FC[0]),dot(IL.xz,FC[1]),dot(IL.xz,FC[2]))/Dj;FT=0.;QP=DV(IL.xz/Dj);Hr=ZN(QP);Zs=true;for(int HZ=Li;HZ<320;HZ++){if(Zs){Iq=(OE+vec3(dot(Hr,FC[0]),dot(Hr,FC[1]),dot(Hr,FC[2])))*TL;Ro=TY(Iq);Hn=We*FC[(Ro==Iq.x)?0:((Ro==Iq.y)?1:2)];Wv();}Xy=XH+LZ.xz;Nt=DV(Xy/By);if(Zs||LI!=Nt)UK(Nt,Xy);Zs=false;TU=Pm(IL+FT*Yx);if(FT+TU<Ro){FT+=TU;}else{FT=Ro+KJ;QP=DV((IL.xz+FT*Yx.xz)/Dj);Hr+=Hn;Zs=true;}if(TU<KJ||FT>Qh)break;}if(TU>=KJ)FT=Qh;return FT;}vec3 QX(vec3 TH){vec4 Eq;vec2 DR;DR=1e-4*vec2(1.,-1.);for(int HZ=Li;HZ<4;HZ++){Eq[HZ]=Pm(TH+((HZ<2)?((HZ==0)?DR.xxx:DR.xyy):((HZ==2)?DR.yxy:DR.yyx)));}Eq.x=-Eq.x;return normalize(2.*Eq.yzw-dot(Eq,vec4(1.)));}float Ut(vec3 IL,vec3 Yx){vec3 TH;vec2 Pe,Xy;float ZR,TU,SV;ZR=1.;TU=0.02;Pe=vec2(-999.);for(int HZ=Li;HZ<30;HZ++){TH=IL+TU*Yx;QP=DV(TH.xz/Dj);if(QP!=Pe){Pe=QP;Wv();}Xy=XH+LZ.xz;UK(DV(Xy/By),Xy);if(JG>0.){SV=Pm(TH);ZR=min(ZR,smoothstep(0.,0.1*TU,SV));TU+=SV;}else TU+=0.1*Dj;if(ZR<0.05||TU>2.*Dj)break;}return 0.5+0.5*ZR;}vec4 Pv(vec3 IL,vec3 Qp,inout vec2 OE){vec4 CO;if(SE==Pi){CO=vec4(0.6,0.5,0.3,0.);CO=mix(CO,vec4(0.45,0.35,0.2,0.),smoothstep(0.37,0.42,fract(2.*IL.y+4.*PQ(0.1*IL.xz)+0.5)-0.5)*(1.-smoothstep(0.6,0.7,Qp.y)));CO*=(0.9+0.1*PQ(4.*IL.xz))*(0.8+0.2*smoothstep(0.02,0.05,IL.y-YS));OE=vec2(16.,1.);}else if(SE==Nx){CO=vec4(0.5,0.55,0.5,0.);OE=vec2(64.,0.5);}return CO;}vec4 NB(vec3 IL,vec3 Qp,out vec2 OE){vec4 CO;if(SE==LM){CO=vec4(GF(vec3(UG(QP+0.1),0.3,0.8)),0.);if(Qp.y>0.95)CO*=0.5;OE=vec2(32.,0.1);}return CO;}vec3 EY(vec3 Yx){return mix(vec3(0.3,0.4,0.8),vec3(0.4,0.4,0.55),1.-max(Yx.y,0.));}vec3 GJ(vec3 IL,vec3 Yx){vec3 Bd,SA,Dn;vec2 Tq;float Of,Tm,UX,Yg;if(Yx.y>0.){Tq=0.005*(IL.xz+Id*vec2(0.5,2.)+((200.-IL.y)/Yx.y)*Yx.xz);UX=PQ(Tq);Of=smoothstep(0.1,0.8,UX);Tm=smoothstep(0.1,0.8,PQ(Tq+0.01*EH.xz))-Of;SA=0.7*(0.8+0.5*UX)*(vec3(1.)-vec3(0.3,0.3,0.2)*sign(Tm)*smoothstep(0.,0.05,abs(Tm)));Yg=max(dot(Yx,EH),0.);Tm=smoothstep(0.01,0.1,Yx.y);Dn=mix(vec3(0.8,0.8,0.75),vec3(0.3,0.4,0.7),0.3+0.7*Tm)+step(0.1,Yg)*vec3(1.,1.,0.9)*min(0.3*pow(Yg,64.)+0.5*pow(Yg,2048.),1.);Bd=mix(Dn,SA,0.1+0.9*Of*Tm);}else{Bd=EY(Yx);}return 0.9*Bd;}vec3 GJ(vec3 Yx){Yx.y=abs(Yx.y);return mix(vec3(0.3,0.35,0.7),vec3(0.8,0.8,0.8),clamp(2.*(PQ(4.*Yx.xz/Yx.y+0.1*Id)-0.1)*Yx.y,0.,1.));}\nvec3 BC(vec3 IL,vec3 Yx){vec4 CO;vec3 Bd,Qp,PD,Sa,Kw,Ai;vec2 OE,Xy;float RS,Vo,TD,YK,WZ,Av,ZR,BT;int Up,XL,Wa;bool Go;BT=1.;WZ=0.;Lr=sin(17.1*Ck*Id+vec2(0.5*Ck,0.));OE=vec2(0.);Kw=IL;Ai=Yx;Av=(Yx.y<0.)?-(IL.y-YS)/Yx.y:Qh;for(int JK=Li;JK<2;JK++){TD=UC(IL,Yx);Up=SE;YK=SI(IL,Yx);XL=SE;RS=Qh;Vo=BP(IL,Yx);Wa=SE;if(Vo<Qh){RS=Vo;SE=Wa;}if(min(TD,YK)<min(RS,Qh)){if(TD<YK){RS=TD;SE=Up;}else{RS=YK;SE=XL;}}if(JK==0&&Av<min(RS,Qh)){IL+=Av*Yx;Sa=Jx(4.*IL+0.1*Id,vec3(0.,1.,0.),0.1);Yx=reflect(Yx,Sa);IL+=0.01*Yx;WZ=RS;BT=0.9;}else break;}IL+=RS*Yx;Go=false;if(RS<Qh){CO=vec4(0.);if(SE==Up){LI=DV(IL.xz/By);Ko();Qp=SR(IL);CO=Pv(IL,Qp,OE);}else if(SE==XL){QP=DV(IL.xz/Dj);Wv();Xy=XH+LZ.xz;UK(DV(Xy/By),Xy);Qp=QX(IL);CO=NB(IL,Qp,OE);}else if(SE>=QT){Qp=Ae(IL);CO=WI();}if(CO.a>=0.){PD=IL+0.01*Qp;ZR=Ut(PD,EH);ZR=min(ZR,Wn(PD,EH));ZR=min(ZR,DA(PD,EH));if(OE.y>0.)Qp=Jx(OE.x*IL,Qp,OE.y);Go=true;}else if(CO.a==-2.){Bd=mix(CO.rgb,0.5*GJ(IL,reflect(Yx,Qp)),0.8);}else if(CO.a==-1.){Bd=CO.rgb*(0.4+0.6*max(-dot(Yx,Qp),0.));}}else{Bd=GJ(IL,Yx);}if(Go){Bd=CO.rgb*(0.2+0.2*max(dot(EH*vec3(-1.,1.,-1.),Qp),0.)+0.8*ZR*max(dot(Qp,EH),0.))+CO.a*step(0.95,ZR)*pow(max(dot(reflect(EH,Qp),Yx),0.),32.);Bd=mix(Bd,GJ(Kw,Yx),smoothstep(0.7,0.95,(WZ+RS)/Qh));}if(BT<1.)Bd=mix(mix(vec3(0.,0.1,0.),vec3(0.08,0.08,0.1),smoothstep(0.45,0.55,HI(128.*(Kw+Av*Ai).xz))),BT*Bd,1.-0.99*pow(max(dot(-Ai,Sa),0.),1.5));return clamp(Bd,0.,1.);}vec4 Vs(int JK){vec4 Xy;float Uc,Lz;Uc=1.;Lz=1.5;if(JK<8){if(JK<4){if(JK<2)Xy=(JK==0)?vec4(0.,0.,-1./6.,Lz):vec4(1.,0.,1./3.,-Uc);else Xy=(JK==2)?vec4(0.,1.,5./6.,Lz):vec4(-1.,1.,-1./3.,Uc);}else{if(JK<6)Xy=(JK==4)?vec4(-1.,2.,1.,Uc):vec4(0.,1.,-1./6.,Lz);else Xy=(JK==6)?vec4(1.,1.,1./6.,Lz):vec4(1.,2.,1.,Uc);}}else if(JK<16){if(JK<12){if(JK<10)Xy=(JK==8)?vec4(2.,1.,1./2.,-Lz):vec4(2.,0.,-1./2.,Lz);else Xy=(JK==10)?vec4(3.,-1.,-1./6.,Lz):vec4(4.,-1.,1./3.,-Uc);}else{if(JK<14)Xy=(JK==12)?vec4(3.,0.,-1./2.,-Lz):vec4(3.,1.,1./2.,Lz);else Xy=(JK==14)?vec4(2.,2.,5./6.,Lz):vec4(1.,2.,-1./3.,Uc);;}}else Xy=vec4(1.,3.,1.,Uc);return Xy;}vec2 Mu(float Gs){const int FG=17;vec4 Gk;vec2 OV,MT;float JO[FG+1],VN,WM,BL,AM;JO[0]=0.;for(int JK=Li;JK<FG;JK++)JO[JK+1]=JO[JK]+abs(Vs(JK).w);Nk=JO[FG];Gs/=3.;OV=floor(Gs/Nk)*vec2(2.);Gs=mod(Gs,Nk);for(int JK=Li;JK<FG;JK++){if(Gs>=JO[JK]&&Gs<JO[JK+1]){Gk=Vs(JK);VN=2.*(Gs-JO[JK])/(JO[JK+1]-JO[JK])-1.;break;}}OV+=Gk.xy;if(abs(Gk.w)==1.5){WM=1.5;AM=We;BL=Ck/6.;VN*=Bl(Gk.w);}else{WM=0.5;AM=1.;BL=-Bl(Gk.w)*Ck/3.;}MT=vec2(-1.,1.)*sin(Ck*Gk.z+vec2(0.,0.5*Ck));return(ZN(OV)+AM*MT-WM*Mh(MT,sin(VN*BL+vec2(0.5*Ck,0.))))*By;}void mainImage(out vec4 Md,in vec2 NO){const int Jt=2;mat3 Xh;vec4 Xu,Zb;vec3 IL,Yx,Bd,MT;vec2 Df,AU,CF,VJ[Jt],Zj[Jt],Zf,AQ;float IY,ID,Hv,GS,XP,Gs;int Vw,DE;\nFX=iFrame;Df=iResolution.xy;AU=2.*NO.xy/Df-1.;AU.x*=Df.x/Df.y;Id=iTime;Zb=iDate;Xu=iMouse;Xu.xy=Xu.xy/Df-0.5;\nId+=40.;GS=Df.x/Df.y;Zf=(1./5.)*vec2(GS,1.);VJ[0]=(1.-Zf.y)*vec2(GS,1.);VJ[1]=(1.-Zf.y)*vec2(-GS,1.);for(int JK=0;JK<Jt;JK++)Zj[JK]=abs(AU-VJ[JK])-Zf;DE=-1;if(Xu.z>0.){DE=0;for(int JK=0;JK<Jt;JK++){AQ=2.*Xu.xy-VJ[JK]/vec2(GS,1.);if(OR(abs(AQ))<Zf.y){DE=JK+1;AQ/=2.*Zf.y;break;}}if(DE==0)AQ=Xu.xy;}Vw=0;for(int JK=0;JK<Jt;JK++){if(OR(Zj[JK])<0.){AU=(AU-VJ[JK])/Zf.y;Vw=JK+1;break;}}if(DE>0&&(Vw==0||Vw==DE))Vw=DE-Vw;By=32.;Dj=1.;YS=-2.;EQ=6.;Sr=0.15;ID=0.;IY=0.;if(Xu.z>0.&&Vw==DE){ID+=2.*Ck*AQ.x;IY+=0.5*Ck*AQ.y;}Gs=Id*Sr;IH=0.1;GW.xz=Mu(Gs);GW.y=YS+1.5+0.7*Iu(0.25,0.75,0.2,fract(0.03*Id));MT.xz=Mu(Gs+0.1)-Mu(Gs-0.1);GW.w=-atan(MT.z,MT.x);Gs=Id*Sr;if(Vw==0||Vw==1){IL.xz=Mu(Gs-((Vw==0)?0.5:-0.5));IL.x+=0.01;IL.y=YS+3.+0.7*(GW.y-1.);MT=normalize(GW.xyz-IL);ID+=atan(MT.z,-MT.x)-0.5*Ck;IY+=asin(MT.y)-0.05*Ck;IY=clamp(IY,-0.3*Ck,0.2*Ck);Hv=3.;Qh=8.*By;}else if(Vw==2){IL=vec3(0.,50.,(-1.5*We+(2./Nk)*Gs)*By);IL.xz=NS(IL.xz,-Ck/3.);IL.xz+=0.01;IL.x-=1.5*By;MT=normalize(GW.xyz-IL);ID=atan(MT.z,-MT.x)-0.5*Ck;IY=asin(MT.y);Hv=40.;if(Xu.z>0.&&Vw==DE){Hv+=60.*(AQ.y+0.5);ID+=0.1*AQ.x;}Qh=30.*By;}Xh=CW(IY,ID);EH=normalize(vec3(0.,2.,-1.));EH.xz=NS(EH.xz,-Ck/3.);const float Em=1.;Bd=vec3(0.);XP=2.*mod(dot(mod(floor(0.5*(AU+1.)*Df),2.),vec2(1.)),2.)-1.;for(float BL=float(Li);BL<Em;BL++){CF=(AU+step(1.5,Em)*NS(vec2(0.5/Df.y,0.),XP*(0.667*BL+0.5)*Ck))/Hv;Yx=Xh*normalize(vec3(2.*tan(0.5*atan(CF.x/GS))*GS,CF.y,1.));Bd+=(1./Em)*BC(IL,Yx);}for(int JK=0;JK<Jt;JK++){if(OR(Zj[JK])<0.&&Sn(abs(Zj[JK]))*Df.y<3.)Bd=vec3(0.3,0.7,0.3);}Md=vec4(Bd,1.);}\n",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}