{
    "Shader": {
        "info": {
            "date": "1667761769",
            "description": "torus raymarch",
            "flags": 0,
            "hasliked": 0,
            "id": "cdBGRy",
            "likes": 1,
            "name": "torus - practice",
            "published": 3,
            "tags": [
                "3d",
                "phong",
                "sdf",
                "torus",
                "blinn",
                "raymrch"
            ],
            "usePreview": 0,
            "username": "kanayuki",
            "viewed": 176
        },
        "renderpass": [
            {
                "code": "float sdTorus(vec3 p, float r1, float r2)\n{\n    float l = length(p.xy)-r1;\n    return length(vec2(l,p.z))-r2;\n}\n\nfloat sdf(vec3 p) {return sdTorus(p,3.0,1.0);}\n\nfloat rayMarching(vec3 raySource, vec3 direction)\n{\n    float d;\n    for (int i=0; i<100; i++)\n    {\n        float len = sdf(raySource+direction*d);\n        if (len<0.001 || d>30.0) break;\n        d += len;\n    }\n    return d;\n}\n\nvec3 getNormal(vec3 p)\n{\n    vec2 e = vec2(0.0001,0);\n    float d = sdf(p);\n    float pdx=sdf(p+e.xyy)-d;\n    float pdy=sdf(p+e.yxy)-d;\n    float pdz=sdf(p+e.yyx)-d;\n    return normalize(vec3(pdx,pdy,pdz));\n \n}\n\nmat2 rotateMatrix(float theta)\n{\n    return mat2(cos(theta),-sin(theta),\n                sin(theta),cos(theta));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = (2.0*fragCoord-iResolution.xy)/iResolution.y * 4.0;\n\n    vec3 col = vec3(0.75);\n    vec3 raySource = vec3(0,0,20);\n    raySource.xz *= rotateMatrix(iTime);\n    \n    vec3 screen = vec3(uv,1.0);\n    screen.xz *= rotateMatrix(iTime);\n    \n    vec3 direction = normalize(screen-raySource);\n    \n    float d = rayMarching(raySource, direction );\n    if(d<30.0)\n    {\n        vec3 p = vec3(raySource+direction*d);\n        vec3 N = getNormal(p);\n        vec3 light =vec3(5,0,5);\n         light.xz *= rotateMatrix(iTime);\n        \n        vec3 L = normalize(light-p);\n        \n        float diffuse = dot(N,L);\n        // Lambert\n        // diffuse = max(0,diffuse);\n        // Half Lambert\n        diffuse = diffuse * 0.5 + 0.5;\n         \n        \n        // Phong\n        vec3 R = normalize(2.0*N*dot(N,L)-L);\n        vec3 V = -direction;\n        // vec3 specular = 0.1*vec3(1)*pow(dot(R,V),8.0);\n        \n        // Blinn\n        vec3 H = normalize(V+L);\n        vec3 specular = 0.9*vec3(1)*pow(dot(H,N),5.0);\n        \n        \n        vec3 ambient = vec3(0.1,0.1,0.3)*1.5;\n        \n        col = vec3(1,0,1);\n        col = ambient + 0.5*col*diffuse + specular;\n    }\n    \n    // Time varying pixel color\n    // col = 0.5 + 0.5*cos(iTime+uv.xyx+vec3(0,2,4));\n\n    // Output to screen\n    fragColor = vec4(col,1.0);\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}