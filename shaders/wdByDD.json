{
    "Shader": {
        "info": {
            "date": "1586812589",
            "description": "Web GL port of Opaq 4K Intro released at Revision 2020 demoparty (https://2020.revision-party.net/)\nhttps://www.pouet.net/prod.php?which=85234\nhttps://soundcloud.com/josh-revilo/k2-opaq-4kb-realtime-execute-music/s-gO96rwQ4qP6",
            "flags": 96,
            "hasliked": 0,
            "id": "wdByDD",
            "likes": 14,
            "name": "Opaq (4k Intro port)",
            "published": 3,
            "tags": [
                "3d",
                "raymarching",
                "sdf",
                "metaballs",
                "intro",
                "4k",
                "pathtracing",
                "revision",
                "multipass",
                "klos"
            ],
            "usePreview": 0,
            "username": "spolsh",
            "viewed": 962
        },
        "renderpass": [
            {
                "code": "/*\n''''''''''''''''''''''''''''''''''''''''''''        .revision 2020\n'''@@@@''''''''''@@@'''''@@@@@@@@@@@@@@@@'''\n'''@@@@'''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''  code  .klos\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''        .shx\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''        .pml\n''@@@@@@''''''''@@@@@''''''''''''''''@@@@@''\n''@@@@@@''''''''@@@@@''''''''''''''''@@@@@''  music .shx\n''@@@@@@''''''''@@@@@''''''''''''''''@@@@@''  \n''@@@@@@'''@@@@@@@@@@''''@@@@@@@@@@@@@@@@@''\n''@@@@@@'''@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''  gfx   .klos\n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''  \n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''\n'''@@@@''''@@@@@@@@@''''@@@@@@@@@@@@@@@@@@''  >>> Opaq <<<\n''''''''''''''''''''''''''''''''''''''''''''  \n''''''''''''''''''''''''''''''''''''''''''''\n'''@@@@''''@@@@@@@@@'''''@@@@@@@@@@@@@@@@'''  tools .crinkler\n'''@@@@''''@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''        .4klang\n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''        .shaderminifier\n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''        .opengl\n''@@@@@@'''@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''\n''@@@@@@''''''''@@@@@'''@@@@@'''''''''''''''  greets\n''@@@@@@''''''''@@@@@'''@@@@@'''''''''''''''    Aberration Creations,\n''@@@@@@''''''''@@@@@'''@@@@@'''''''''''''''    Abyss, Adapt, Alcatraz,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@'''    Altair, Brain Control,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''    Dekadence, Desire, FHI,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''    Fulcrum, Hprg, Jetlag,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''    LJ, Nuance, Prismbeings,\n'''@@@@'''''''''@@@@''''@@@@@@@@@@@@@@@@@@''    PVM, Rabenauge, Skyrunner,\n''''''''''''''''''''''''''''''''''''''''''''    Titan & everybody we forgot!\n*/\n\n// See Buffer A for sample count controls\n// Audio comes from soundcloud link, \n// \tmay need to wait a bit to load or refresh website\n\nvoid mainImage(out vec4 f, in vec2 fragCoord)\n{\n   vec2 k = min(vec2(1280., 720.), iResolution.xy);\n   vec2 uv = fragCoord.xy * k.xy / (iResolution.xy * iResolution.xy);\n   f = texture(iChannel0, uv);\n}\n",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "/*\n''''''''''''''''''''''''''''''''''''''''''''        .revision 2020\n'''@@@@''''''''''@@@'''''@@@@@@@@@@@@@@@@'''\n'''@@@@'''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''  code  .klos\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''        .shx\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''        .pml\n''@@@@@@''''''''@@@@@''''''''''''''''@@@@@''\n''@@@@@@''''''''@@@@@''''''''''''''''@@@@@''  music .shx\n''@@@@@@''''''''@@@@@''''''''''''''''@@@@@''  \n''@@@@@@'''@@@@@@@@@@''''@@@@@@@@@@@@@@@@@''\n''@@@@@@'''@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''  gfx   .klos\n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''  \n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''\n'''@@@@''''@@@@@@@@@''''@@@@@@@@@@@@@@@@@@''  >>> Opaq <<<\n''''''''''''''''''''''''''''''''''''''''''''  \n''''''''''''''''''''''''''''''''''''''''''''\n'''@@@@''''@@@@@@@@@'''''@@@@@@@@@@@@@@@@'''  tools .crinkler\n'''@@@@''''@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''        .4klang\n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''        .shaderminifier\n''@@@@@@''@@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''        .opengl\n''@@@@@@'''@@@@@@@@@@'''@@@@@@@@@@@@@@@@@@''\n''@@@@@@''''''''@@@@@'''@@@@@'''''''''''''''  greets\n''@@@@@@''''''''@@@@@'''@@@@@'''''''''''''''    Aberration Creations,\n''@@@@@@''''''''@@@@@'''@@@@@'''''''''''''''    Abyss, Adapt, Alcatraz,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@'''    Altair, Brain Control,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''    Dekadence, Desire, FHI,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''    Fulcrum, Hprg, Jetlag,\n''@@@@@@''''''''@@@@@'''@@@@@@@@@@@@@@@@@@''    LJ, Nuance, Prismbeings,\n'''@@@@'''''''''@@@@''''@@@@@@@@@@@@@@@@@@''    PVM, Rabenauge, Skyrunner,\n''''''''''''''''''''''''''''''''''''''''''''    Titan & everybody we forgot!\n*/\n\n// LOW DETAILS: 8.\n// COMPO VERSION: 32.\n#define RAYS 8.\n\n #define F gl_FragCoord\n #define N normalize\n #define M(v)smoothstep(0.,1.,v)\n #define C(v)clamp(v,0.,1.)\n #define H(v)fract(sin(v)*43758.5453)\n #define U(v)floatBitsToUint(v)\n #define S float\n #define V vec3\n // uniform int v;\n // out vec4 f;\n S y,x=.005,z=1e+08,s=2.23333,c=3.582,a=3.14159,i,m,r,l;\n V k=V(1280,720,0),\n   o=V(1,-1,0);\n S n(V y)\n {\n   return abs(length(vec2(y.x,max(0.,abs(y.y)-.15)))-.25)+.4;\n }\n S t(V y)\n {\n   y=-y;\n   bool m=y.x<0.?y.y<0.:atan(y.x,y.y+.15)>2.;\n   return min(min(abs(length(vec2(max(0.,abs(y.x)-.05),y.y-.2))-.2)+.4,length(vec2(y.x+.25,max(0.,abs(y.y-.2)-.2)))+.4),m?n(y):length(vec2(y.x-.22734,y.y+.254))+.4);\n }\n S p(V y)\n {\n   return min(n(y),length(V(y.x+.25,max(0.,abs(y.y+.2)-.6),0))+.4);\n }\n S h(V y)\n {\n   return y.x=-y.x,p(y);\n }\n mat2 w(S y)\n {\n   return mat2(cos(y),-sin(y),sin(y),cos(y));\n }\n V d(S y)\n {\n   return o.xxx*.5+.5*cos(6.28318*(V(1.,.7,.4)*y*.1+V(0.,.15,.2)));\n }\n S d(S y,S x)\n {\n   S z=y*x;\n   return z*exp(1.-z);\n }\n V d(V y,V z,V m,V x)\n {\n   V s=(m-y)/z,c=(x-y)/z,o=min(s,c),a=max(s,c);\n   return V(max(max(o.x,o.y),o.z),min(min(a.x,a.y),a.z),0.);\n }\n S u(V y)\n {\n   V m=floor(y);\n   y-=m;\n   vec4 o=vec4(7,157,113,0),x=vec4(0,o.yz,o.y+o.z)+dot(m,o.xyz);\n   y=y*y*(3.-2.*y);\n   x=mix(H(x),H(x+o.x),y.x);\n   x.xy=mix(x.xz,x.yw,y.y);\n   return mix(x.x,x.y,y.z);\n }\n uint b(uvec3 y)\n {\n   y.xy=1103515245U*(y.xy>>1U^y.yx);\n   uint m=1103515245U*(y.x^y.y>>3U);\n   return m^m>>16;\n }\n V g(inout S y)\n {\n   uint s=b(U(V(y+=.1,y+=.1,0.)));\n   return V(uvec3(s,s*16807U,s*48271U)&uvec3(2147483647U))/float(2147483647);\n }\n S e(V x)\n {\n   x.y-=2.+.5*abs(sin(y));\n   S s=0.,m=z,o,i;\n   for(;s<3.;++s)\n     {\n       V l=abs(2.*V(H(s),H(s+1.),H(s+4.)));\n       i=length(x+M((y-80.)/11.)*V(cos(l.x*c*y/a),.5*cos(c*y/a),sin(l.y*c*y/a)))-.2-.5*l.z;\n       o=C(.5+.5*(i-m)/.5);\n       m=mix(i,m,o)-.5*o*(1.-o);\n     }\n   return m-.02*smoothstep(0.,1.,sin(y-2.*x.y)+.5)*u(20.*x);\n }\n S q(V y)\n {\n   if(l>0.)\n     return e(y);\n   else\n      return y.y+=.3,y.yz*=w(.114),y.xz=mod(y.xz,1.)-.5,y.y-=clamp(y.y,0.,4.),length(y)-.02;\n }\n void b(V m,V z,inout S i,out V b,out V g,out V k,out S n)\n {\n   k=o.zzz;\n   V p,t=o.yzy*6.,h=V(6,200,6),T=d(m,z,t,h),B=o*x;\n   if(T.y>0.&&T.y<i)\n     {\n       g=p=m+z*T.y;\n       i=T.y;\n       b=g.x<t.x+x?o.xzz:g.x>h.x-x?o.yzz:g.y<t.y+x?o.zxz:g.y>h.y-x?o.zyz:o.zzx;\n       S Z=M((u(10.*p)-.3)/.7),Y=min(M((u(.9*p)-.2)/.8),M(u(1.7*p)/.9)),X=step(.1,p.y),W=20.*(p.y-.1),R=.05+pow(Y*Z*M((fract(5.*p.y)-.31)/.01),.1),Q=d(fract(s*y),10.),P=X*H(floor(p.y*.1+s*y))*u(10.*V(p.y+.1*floor(.01*y*c),.1*y,p.y+.1*floor(.01*y*c)))>.5?1.:0.;\n       n=mix(min(.5+.5*Z,.02+Y),R,X);\n       k+=.5*step(W,1.)*step(0.,W);\n       if(y>30.&&y<175.)\n         k+=P,k*=Q+(y<90.||y>112.?d(5.*y+.2*p.y)*C(.01*(-p.y+50.)):o.xxx);\n     }\n   V Z=d(m,z,V(-3,.01,-3),V(3,5,3));\n   if(Z.y>0.&&Z.x>0.&&Z.x<Z.y&&Z.x<i)\n     {\n       S Y=0.,X=Z.y-Z.x;\n       V W=m+z*Z.x;\n       for(int Q=0;Q<50;Q++)\n         {\n           S P=q(W+z*Y);\n           if(abs(P)<x||Y>X)\n             break;\n           Y+=P;\n         }\n       Z.x+=Y;\n       if(Y<X&&Z.x<i)\n         {\n           n=.1-.09*l;\n           i=Z.x;\n           g=p=m+z*Z.x;\n           b=N(B.xyy*q(p+B.xyy)+B.yyx*q(p+B.yyx)+B.yxy*q(p+B.yxy)+B.xxx*q(p+B.xxx));\n           if(l>0.)\n             {\n               p.xy*=.5+4.*H(floor(s*y*2.));\n               p.xz*=w(s/8.*y);\n               S P=.8+.1*H(floor(y*s*2.));\n               k=o.xxx*M((fract(.5+2.*H(floor(y*s*2.))*(p.y+sin(p.x)*cos(p.z)))-P)/.01);\n             }\n           else\n             {\n               if(y>60.)\n                 {\n                   S P=e(p);\n                   k=o.xxx*(fract(.125*c*y)>.5?step(P,.5+M((sin(c*y/a)+.8)/1.6)):step(1.-5.*C(.1*P),.1));\n                 }\n               else\n                 {\n                   S P=.2+.2*M((cos(-c*y/a)+.7)/1.4),R=mix(7.,y,M(y-8.));\n                   V Q=p;\n                   Q.xz*=.5;\n                   Q.xz+=2.*R;\n                   k=o.xxx*C(M((abs(fract((.2+.2*M((sin(.4*R-10.)+.7)/1.4))*(Q.y+sin(Q.x)*cos(Q.z))+.5)-.5)-P)/(.15-P)));\n                 }\n             }\n           k*=r>3.?2.*step(u(floor(10.*p+s*s*y)),.1):1.;\n           k*=y<18.||y>90.&&y<112.?o.xxx:d(-10.*s*y+g.y);\n         }\n     }\n }\n\n V b(V y,V m)\n {\n   V s=o.xxx,k=o.zzz,c,p,l;\n   S P=1.,r=0.,B,Q;\n   for(;r<4.;++r)\n     {\n       Q=z;\n       b(y,m,Q,c,p,l,B);\n       if(Q<z)\n         {\n           V Z=g(i)*V(2,2.*a,1)-o.xzz;\n           S n=Z.y,R=pow(Z.z,1./3.);\n           y=p,m=N(reflect(m,c)+B*R*V(sqrt(1.-Z.x*Z.x)*V(sin(n),cos(n),0).xy,Z.x)),k+=s*l*P,P=(1.-B)*pow(C(dot(m,c)+1.),32.);\n         }\n       else\n          break;\n       if(dot(s,s)<x)\n         break;\n     }\n   return k;\n }\n\n// void main()\nvoid mainImage(out vec4 f, in vec2 fragCoord)\n{\n    f=o.zzzz;\n    k=min(k, iResolution.xyz);\n    if (fragCoord.x > k.x || fragCoord.y > k.y)\n\t\treturn;\n    // y=S(v)/44100.;\n    y = iChannelTime[0];\n    \n    if (iMouse.xy==vec2(0) && iFrame==0) // preview time\n        y=179.5;\n    \n    i=S(b(U(F.xyz)))/S(-1U)+y;\n    V x=(2.*(F.xyz+g(i)-.5)-k)/k.y;\n    r=y<17.5?0.:8.*H(fract(y/c)>=.7?y*s:0.);\n    m=y<17.3?0.:mod(s*y,4.)>2.?5.*pow(H(floor(.5*s*y)),2.):0.;\n    l=y>60.?y>112.?step(mod(y,c)/c,.5):1.:0.;\n    S P=.1+.05*y,R=.01+.4*(1.-M((y-1.)/5.)+M((y-179.)/5.)),B=H(floor(s*y));\n    vec4 Z=m>3.?vec4(-.1,1.,.5,-3.5):m>2.?vec4(1.5,1.,-.01,-.6):m>1.?vec4(.1+1.4*l,4.2,.6,-3.5):m>0.?vec4(.8+l,4.2,3.,-3.+B):vec4(1.5,11.,3.,-3.5);\n    V Q=V(Z.y*cos(P),Z.z,Z.y*sin(P)),W=N(o.zxz*Z.x-Q),u=N(cross(W,o.zxz));\n    mat3 Y=mat3(u,cross(u,W),-W);\n    V X=N(Y*V(x.xy,Z.w)),T=Q+X*length(o.zxz*Z.x-Q),w=g(i)*V(1,2.*a,0),q=F.xyz/k;\n    x*=3.;\n    x+=V(-1.5,1.5,0);\n    S e=floor(x.x),O=w.y,L=sqrt(w.x);\n    X=N(T-Q+Y*L*V(sin(O),cos(O),0)*R);\n    for(S K=0.;K<RAYS;++K)\n        f.xyz+=b(Q,X);\n    q*=1.-q.yxz;\n    x.x=fract(x.x)-.5;\n    f=vec4(pow((f.xyz/RAYS*(1.+(y>18.?.5*d(fract(s*y),10.):0.))+smoothstep(0.,1.,((-1.==e?n(x):0.==e?p(x):1.==e?t(x):2.==e?h(x):z)-.42)/-.01)*(1.-M((y-5.)/.01)+M((y-180.)/.01)))*M((y-1.)/3.)*M((y-184.)/-3.)*pow(q.x*q.y*15.,.1),V(.4545)),1.);\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "musicstream",
                        "id": 21956,
                        "published": 0,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "https://soundcloud.com/josh-revilo/k2-opaq-4kb-realtime-execute-music"
                    }
                ],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            }
        ],
        "ver": "0.1"
    }
}