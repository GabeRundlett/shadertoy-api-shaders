{
    "Shader": {
        "info": {
            "date": "1681647586",
            "description": "The idea came from the previous shader post of Shane's comment.",
            "flags": 0,
            "hasliked": 0,
            "id": "DsVSDV",
            "likes": 33,
            "name": "Gears and conveyor belt",
            "published": 3,
            "tags": [
                "graphicdesign",
                "cineshader"
            ],
            "usePreview": 0,
            "username": "yasuo",
            "viewed": 2040
        },
        "renderpass": [
            {
                "code": "#define Rot(a) mat2(cos(a),-sin(a),sin(a),cos(a))\n#define antialiasing(n) n/min(iResolution.y,iResolution.x)\n#define S(d,b) smoothstep(antialiasing(3.0),b,d)\n#define B(p,s) max(abs(p).x-s.x,abs(p).y-s.y)\n#define deg45 .707\n#define R45(p) (( p + vec2(p.y,-p.x) ) *deg45)\n#define Tri(p,s) max(R45(p).x,max(R45(p).y,B(p,s)))\n#define DF(a,b) length(a) * cos( mod( atan(a.y,a.x)+6.28/(b*8.0), 6.28/((b*8.0)*0.5))+(b-1.)*6.28/(b*8.0) + vec2(0,11) )\n\nfloat random (vec2 p) {\n    return fract(sin(dot(p.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat innerGear(vec2 p, float dir){\n    p*=Rot(radians(-iTime*45.+45.)*dir);\n    vec2 prevP = p;\n\n    //p*=Rot(radians(iTime*45.+20.));\n    p = DF(p,7.);\n    p-=vec2(0.24);\n    p*=Rot(deg45);\n    float d = B(p,vec2(0.01,0.06));\n    p = prevP;\n    float d2 = abs(length(p)-0.42)-0.02;\n    d = min(d,d2);\n    d2 = abs(length(p)-0.578)-0.02;\n    d = min(d,d2);\n    d2 = abs(length(p)-0.499)-0.005;\n    d = min(d,d2);\n    \n    p = DF(p,7.);\n    p-=vec2(0.43);\n    p*=Rot(deg45);\n    d2 = B(p,vec2(0.01,0.04));\n    d = min(d,d2);\n    \n    return d;\n}\n\nvec3 pattern1(vec2 p, vec3 col, float dir){\n    vec2 prevP = p;\n    float size = 0.499;\n    float thick = 0.15;\n    \n    p+=vec2(size);\n    float d = abs(length(p)-size)-thick;\n    d = max(d,innerGear(p,dir));\n    col = mix(col,vec3(1.),S(d,0.0));\n    \n    p = prevP;\n    p-=vec2(size);\n    d = abs(length(p)-size)-thick;\n    d = max(d,innerGear(p,dir));\n    col = mix(col,vec3(1.),S(d,0.0));  \n    \n    return col;\n}\n\nvec3 pattern2(vec2 p, vec3 col, float dir){\n\n    vec2 prevP = p;\n    float size = 0.33;\n    float thick = 0.15;\n    float thift = 0.0;\n    float speed = 0.3;\n    \n    p-=vec2(size,0.);\n    float d = B(p,vec2(size,thick));\n    \n    p.x+=thift;\n    p.x-=iTime*speed*dir;\n    p.x=mod(p.x,0.08)-0.04;\n    d = max(d,B(p,vec2(0.011,thick)));\n    p = prevP;\n    d = max(-(abs(p.y)-0.1),d);\n    //d = min(B(p,vec2(1.,0.1)),d);\n    p.y=abs(p.y)-0.079;\n    d = min(B(p,vec2(1.,0.02)),d);\n    \n    p = prevP;\n    p-=vec2(0.0,size);\n    float d2 = B(p,vec2(thick,size));\n    \n    p.y+=thift;\n    p.y+=iTime*speed*dir;\n    p.y=mod(p.y,0.08)-0.04;\n    d2 = max(d2,B(p,vec2(thick,0.011)));\n    \n    p = prevP;\n    d2 = max(-(abs(p.x)-0.1),d2);\n    d2 = min(B(p,vec2(0.005,1.)),d2);\n    p.x=abs(p.x)-0.079;\n    d2 = min(B(p,vec2(0.02,1.)),d2);    \n    \n    d = min(d,d2);\n    \n    p = prevP;\n    p+=vec2(0.0,size);\n    d2 = B(p,vec2(thick,size));\n    \n    p.y+=thift;\n    p.y-=iTime*speed*dir;\n    p.y=mod(p.y,0.08)-0.04;\n    d2 = max(d2,B(p,vec2(thick,0.011)));\n        \n    p = prevP;\n    d2 = max(-(abs(p.x)-0.1),d2);\n    d2 = min(B(p,vec2(0.005,1.)),d2);\n    p.x=abs(p.x)-0.079;\n    d2 = min(B(p,vec2(0.02,1.)),d2);   \n    \n    d = min(d,d2);\n    \n    p = prevP;\n    p+=vec2(size,0.0);\n    d2 = B(p,vec2(size,thick));\n    \n    p.x+=thift;\n    p.x+=iTime*speed*dir;\n    p.x=mod(p.x,0.08)-0.04;\n    d2 = max(d2,B(p,vec2(0.011,thick)));\n    d = min(d,d2);    \n    p = prevP;\n    d = max(-(abs(p.y)-0.1),d);\n    d = min(B(p,vec2(1.,0.005)),d);\n    p.y=abs(p.y)-0.079;\n    d = min(B(p,vec2(1.,0.02)),d);    \n    \n    p = prevP;\n    d2 = abs(B(p,vec2(size*0.3)))-0.05;\n    d = min(d,d2); \n    \n    col = mix(col,vec3(1.),S(d,0.0));\n    \n    d = B(p,vec2(0.08));\n    col = mix(col,vec3(0.),S(d,0.0));\n    \n    p*=Rot(radians(60.*iTime*dir));\n    d = B(p,vec2(0.03));\n    col = mix(col,vec3(1.),S(d,0.0));     \n     \n    return col;\n}\n\nvec3 drawBelt(vec2 p, vec3 col, float size){\n    vec2 prevP = p;\n    \n    p*=size;\n    vec2 id = floor(p);\n    vec2 gr = fract(p)-0.5;\n    float dir = mod(id.x+id.y,2.)*2.-1.;\n    float n = random(id);\n    \n    if(n<0.5){\n        if(n<0.25){\n            gr.x*=-1.;\n        }\n        col = pattern1(gr,col,dir);\n    } else {\n        if(n>0.75){\n            gr.x*=-1.;\n        }\n        col = pattern2(gr,col,dir);\n    }\n    \n    return col;\n}\n\nvec3 gear(vec2 p, vec3 col, float dir){\n    vec2 prevP = p;\n\n    p*=Rot(radians(iTime*45.+13.)*-dir);\n    p = DF(p,7.);\n    p-=vec2(0.23);\n    p*=Rot(deg45);\n    float d = B(p,vec2(0.01,0.04));\n    p = prevP;\n    float d2 = abs(length(p)-0.29)-0.02;\n    d = min(d,d2);\n    col = mix(col,vec3(1.),S(d,0.0));\n    \n    p*=Rot(radians(iTime*30.-30.)*dir);\n    p = DF(p,6.);\n    p-=vec2(0.14);\n    p*=Rot(radians(45.));\n    d = B(p,vec2(0.01,0.03));\n    p = prevP;\n    d2 =abs( length(p)-0.1)-0.02;\n    p*=Rot(radians(iTime*25.+30.)*-dir);\n    d2 = max(-(abs(p.x)-0.05),d2);\n    d = min(d,d2);\n    col = mix(col,vec3(1.),S(d,0.0));\n    \n    return col;\n}\n\nvec3 item0(vec2 p, vec3 col, float dir){\n    vec2 prevP = p;\n    p.x*=dir;\n    p*=Rot(radians(iTime*30.+30.));\n    float d = abs(length(p)-0.2)-0.05;\n    col = mix(col,vec3(0.3),S(d,0.0));\n    \n    d = abs(length(p)-0.2)-0.05;\n    d = max(-p.x,d);\n    float a = clamp(atan(p.x,p.y)*0.5,0.3,1.);\n    \n    col = mix(col,vec3(a),S(d,0.0));\n    \n    return col;\n}\n\n\nvec3 item1(vec2 p, vec3 col, float dir){\n    p.x*=dir;\n    vec2 prevP = p;\n    p*=Rot(radians(iTime*30.+30.));\n    float d = abs(length(p)-0.25)-0.04;\n    d = abs(max((abs(p.y)-0.15),d))-0.005;\n    float d2 = abs(length(p)-0.25)-0.01;\n    d2 = max((abs(p.y)-0.12),d2);\n    d = min(d,d2);\n    \n    d2 = abs(length(p)-0.27)-0.01;\n    d2 = max(-(abs(p.y)-0.22),d2);\n    d = min(d,d2);\n    d2 = B(p,vec2(0.01,0.32));\n    d2 = max(-(abs(p.y)-0.22),d2);\n    d = min(d,d2);\n    \n    p = prevP;\n    p*=Rot(radians(iTime*-20.+30.));\n    p = DF(p,2.);\n    p-=vec2(0.105);\n    p*=Rot(radians(45.));\n    d2 = B(p,vec2(0.03,0.01));\n    d = min(d,d2);\n    \n    p = prevP;\n    d2 = abs(length(p)-0.09)-0.005;\n    d2 = max(-(abs(p.x)-0.03),d2);\n    d2 = max(-(abs(p.y)-0.03),d2);\n    d = min(d,d2);\n    \n    col = mix(col,vec3(0.6),S(d,0.0));\n    \n    return col;\n}\n\nvec3 item2(vec2 p, vec3 col, float dir){\n    p.x*=dir;\n    p*=Rot(radians(iTime*50.-10.));\n    vec2 prevP = p;\n    float d = abs(length(p)-0.15)-0.005;\n    float d2 =  abs(length(p)-0.2)-0.01;\n    d2 = max((abs(p.y)-0.15),d2);\n    d = min(d,d2);\n    \n    p = DF(p,1.);\n    p-=vec2(0.13);\n    p*=Rot(radians(45.));\n    d2 = B(p,vec2(0.008,0.1));\n    d = min(d,d2);    \n    \n    p = prevP;\n    p = DF(p,4.);\n    p-=vec2(0.18);\n    p*=Rot(radians(45.));\n    d2 = B(p,vec2(0.005,0.02));\n    d = min(d,d2);   \n    \n    col = mix(col,vec3(0.6),S(d,0.0));\n    \n    return col;\n}\n\nfloat needle(vec2 p){\n    p.y-=0.05;\n    p*=1.5;\n    vec2 prevP = p;\n    p.y-=0.3;\n    p.x*=6.;\n    float d = Tri(p,vec2(0.3));\n    p = prevP;\n    p.y+=0.1;\n    p.x*=2.;\n    p.y*=-1.;\n    float d2 = Tri(p,vec2(0.1));\n    d = min(d,d2);\n    return d;\n}\n\nvec3 item3(vec2 p, vec3 col, float dir){\n    \n    p*=Rot(radians(sin(iTime*dir)*120.));\n    vec2 prevP = p;\n   \n    p.y= abs(p.y)-0.05;\n    float d = needle(p);\n    p = prevP;\n    float d2 = abs(length(p)-0.1)-0.003;\n    d2 = max(-(abs(p.x)-0.05),d2);\n    d = min(d,d2);\n    d2 = abs(length(p)-0.2)-0.005;\n    d2 = max(-(abs(p.x)-0.08),d2);\n    d = min(d,d2);\n    \n    p = DF(p,4.);\n    p-=vec2(0.18);\n    d2 = length(p)-0.01;\n    p = prevP;\n    d2 = max(-(abs(p.x)-0.03),d2);\n    d = min(d,d2);   \n    \n    col = mix(col,vec3(0.6),S(d,0.0));\n    \n    return col;\n}\n\nvec3 drawGearsAndItems(vec2 p, vec3 col, float size){\n    vec2 prevP = p;\n    p*=size;\n    p+=vec2(0.5);\n    \n    vec2 id = floor(p);\n    vec2 gr = fract(p)-0.5;\n    \n    float n = random(id);\n    float dir = mod(id.x+id.y,2.)*2.-1.;\n    if(n<0.3){\n        col = gear(gr,col,dir);\n    } else if(n>=0.3 && n<0.5){\n        col = item0(gr,col,dir);\n    } else if(n>=0.5 && n<0.7){\n        col = item1(gr,col,dir);\n    } else if(n>=0.7 && n<0.8) {\n        col = item2(gr,col,dir);\n    } else if(n>=0.8){\n        col = item3(gr,col,dir);\n    }\n    \n    return col;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 p = (fragCoord-0.5*iResolution.xy)/iResolution.y;\n    p.y+=iTime*0.1;\n    \n    float size = 4.;\n    vec3 col = vec3(0.);\n    col = drawBelt(p,col,size);\n    col = drawGearsAndItems(p,col,size);\n\n    fragColor = vec4(col,1.0);\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}