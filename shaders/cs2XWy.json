{
    "Shader": {
        "info": {
            "date": "1670838006",
            "description": "Some nested overlapping pentagons. At each pixel, draw K polygons to handle overlaps.",
            "flags": 16,
            "hasliked": 0,
            "id": "cs2XWy",
            "likes": 26,
            "name": "Nest of Polygons II",
            "published": 3,
            "tags": [
                "simple",
                "sdf",
                "polygon",
                "dihedral"
            ],
            "usePreview": 0,
            "username": "mla",
            "viewed": 334
        },
        "renderpass": [
            {
                "code": "// Nest of Polygons II, mla, 2022\n\nfloat N = 5.0;  // Number of sides\nfloat M = 12.0; // Radial density.\nfloat K = 4.0;  // Number of polygons to draw\n\nconst float PI = 3.141592654;\n\n// Rotate vector p by angle t.\nvec2 rotate(vec2 p, float t) {\n  return cos(t)*p + sin(t)*vec2(-p.y,p.x);\n}\n\n// Signed distance from p segment qr. Positive distance for\n// points on the left of the line looking from q to r.\nfloat ssegment(vec2 p, vec2 q, vec2 r) {\n  p -= q; r -= q;\n  float k = dot(p,r)/dot(r,r);\n  k = clamp(k,0.0,1.0);\n  vec2 closestpoint = k*r;\n  float dist = distance(p,closestpoint);\n  vec2 normal = vec2(-r.y,r.x);\n  float s = dot(p,normal) >= 0.0 ? 1.0 : -1.0; // Don't want sign() here (since sign(0) == 0)\n  return s*dist;\n}\n\nvec3 h2rgb(float h) {\n  vec3 rgb = clamp( abs(mod(h*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );\n  return rgb*rgb*(3.0-2.0*rgb); // cubic smoothing\t\n}\n\nfloat polydist(float N, vec2 p, float r) {\n    float phi = PI/N; // angle of half sector\n    float theta = atan(p.x,-p.y);// negative y-axis is theta = 0\n    theta = mod(theta+phi,2.0*phi)-phi;\n    //theta /= 2.0*phi; theta -= round(theta); theta *= 2.0*phi; // Equivalent\n    theta = abs(theta); // Mirror symmetry\n    // With dihedral symmetry, the closest point is always in the\n    // fundamental region, so can limit attention just to there\n    // for finding the SDF.\n    vec2 p1 = length(p)*vec2(cos(theta),sin(theta));\n    vec2 q0 = r*vec2(cos(phi),sin(phi)), q1 = r*vec2(cos(phi),0);\n    return ssegment(p1,q0,q1);\n}\n\nfloat poly(float k, vec2 p) {\n    float k0 = k;\n    k /= M;\n    k += 0.25*iTime;\n    k = exp(k);\n    //p = rotate(p,0.5*iTime*sin(0.05*k0-0.1*sin(0.01*iTime)));\n    //p = rotate(p,0.5*sin(3.0*iTime+0.1*k0));\n    p = rotate(p,0.5*iTime*sin(0.05*k0));\n    float d = polydist(N,p,k);\n    return d;\n}\n\nvec3 getcol(float k) {\n  return 0.2+0.8*h2rgb(0.5*fract(100.0*sin(10.0*k)));\n}\n\nvoid mainImage(out vec4 fragColor, vec2 fragCoord) {\n    vec2 p = 2.0*(2.0*fragCoord-iResolution.xy)/iResolution.y;\n    float px = fwidth(p.x);\n    float lwidth = 0.002;\n    float k = length(p)-px-lwidth;\n    k = log(k);\n    k -= 0.25*iTime;\n    k *= M;\n    k = ceil(k);\n\n    float d = 1e8;\n    vec3 col = getcol(k+K);\n    for (float i = K-1.0; i >= 0.0; i--) {\n      float d0 = poly(k+i,p);\n      if (d0 < 0.0) { \n        d = -d0; \n        col = mix(col,getcol(k+i),smoothstep(-px,px,d)); \n      } else if (d0 < d) {\n        d = d0;\n        // mix(a,b,x) = (1-x)a+xb = a+x(b-a) = a-x(a-b)\n        col *= 1.0-0.5*(1.0-smoothstep(-8.0*px, 8.0*px, abs(d) - lwidth)); // Shane's shading\n      }\n    }\n    col *= smoothstep(-px,px,abs(d)-lwidth);\n    col = pow(col,vec3(0.4545));\n    fragColor = vec4(col,1.0);\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 3,
                        "ctype": "keyboard",
                        "id": 33,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/presets/tex00.jpg"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}