{
    "Shader": {
        "info": {
            "date": "1561647399",
            "description": "Living with color limitations of Commodore 64",
            "flags": 0,
            "hasliked": 0,
            "id": "wt2GDd",
            "likes": 7,
            "name": "Commodore 64 plasma",
            "published": 3,
            "tags": [
                "retro",
                "plasma",
                "commodore",
                "8x8"
            ],
            "usePreview": 0,
            "username": "klk",
            "viewed": 745
        },
        "renderpass": [
            {
                "code": "#define float3 vec3\n#define float2 vec2\n#define float4 vec4\n\n\nfloat3 pal(int c)\n{\n    float3 col = float3(  0.0,   0.0,   0.0);\n    if      (c ==  0)col = float3(  0.0,   0.0,   0.0);\n    else if (c ==  1)col = float3(  1.0,   1.0,   1.0);\n    else if (c ==  2)col = float3(103.7,  55.4,  43.0)/255.0;\n    else if (c ==  3)col = float3(111.9, 163.5, 177.9)/255.0;\n    else if (c ==  4)col = float3(111.4,  60.7, 133.6)/255.0;\n    else if (c ==  5)col = float3( 88.1, 140.6,  67.1)/255.0;\n    else if (c ==  6)col = float3( 52.8,  40.3, 121.4)/255.0;\n    else if (c ==  7)col = float3(183.9, 198.7, 110.6)/255.0;\n    else if (c ==  8)col = float3(111.4,  79.2,  37.2)/255.0;\n    else if (c ==  9)col = float3( 66.9,  57.4,   0.0)/255.0;\n    else if (c == 10)col = float3(153.7, 102.6,  89.1)/255.0;\n    else if (c == 11)col = float3( 67.9,  67.9,  67.9)/255.0;\n    else if (c == 12)col = float3(107.8, 107.8, 107.8)/255.0;\n    else if (c == 13)col = float3(154.2, 209.8, 131.6)/255.0;\n    else if (c == 14)col = float3(107.8,  94.1, 180.9)/255.0;\n    else             col = float3(149.5, 149.5, 149.5)/255.0;\n    return col;\n}\n\nstruct NC\n{\n    int i0;\n    int i1;\n    int w;\n};\n\n\nNC near(float3 col)\n{\n    const float3 W=float3(0.299,0.587,0.114);\n    NC res;\n    float rv=100.0;\n    float luma0=dot(col,W);\n    for(int i=0;i<15;i++)\n    {\n        for(int j=i+1;j<16;j++)\n        {\n            for(int f=0;f<4;f++)\n            {\n                float3 icol=mix(pal(i),pal(j),float(f)*.25);\n                float3 dist=(col-icol);\n                dist*=W;\n\n                float d=length(dist*dist);\n                if(d<rv)\n                {\n                    res=NC(i,j,f);\n                    rv=d;\n                }\n            }\n        }\n    }\n    return res;\n}\n\n\nvec3 col(int x, int y)\n{\n\tfloat time=iTime;\n\tvec2 uv = vec2(float(x), float(y))/160.0;\n    vec2 uv0=uv;\n\tfloat i0=1.1;\n\tfloat i1=0.9;\n\tfloat i2=0.5;\n\tfloat i3=0.6;\n\tfloat i4=0.0;\n    float r=0.0;\n    float g=0.0;\n    float b=0.0;\n    float w=0.0;\n\tfor(int s=0;s<4;s++)\n\t{\n\t\tvec2 d;\n\t\td=vec2(cos(uv.y*i0-i4+time/i1),-sin(uv.x*i0-i4+time/i1))/i3;\n        d+=vec2(-d.y,d.x)*0.7;\n\t\tuv.xy+=d;\n        \n\t\ti0=(i0-0.2)*1.1;\n\t\ti1=(i1-2.0)*1.05;\n\t\ti2=(i2-1.51)*1.06;\n\t\ti3*=0.8237;\n\t\ti4+=0.05;\n\t    r+=(sin(uv.x-time)*0.75+0.5)/i2;\n\t    b+=(sin(uv.y+time)*0.75+0.5)/i2;\n\t    g+=(sin((uv.x+uv.y+sin(time*0.5))*0.5)*0.75+0.5)/i2;\n        w+=1.0/i2;\n\t}\n    r/=w;\n    g/=w;\n    b/=w;\n\treturn vec3(r,g,b);\n}\n\nfloat4 border(int y)\n{\n    return float4(pal(int(float(y)+iTime*90.+sin(iTime))/12%16),1);\n}\n\nint ilen(int x, int y)\n{\n    return x*x+y*y;\n}\n\n\nvoid mainImage(out vec4 o, in vec2 fc )\n{\n    int sc=int(iResolution.y/200.);\n    \n    int ix=int(fc.x)/sc;\n    int iy=int(fc.y)/sc;\n    \n    int bx=int(iResolution.x)/sc-320;\n    int by=int(iResolution.y)/sc-200;\n    \n    o=border(iy);\n    if(!((ix<=bx/2)||(ix>=320+bx/2)))\n    {\n        ix-=bx/2;\n\n        if(!((iy<=by/2)||(iy>=200+by/2)))\n        {\n            iy-=by/2;\n\n            int x0=(ix/8)*8;\n            int y0=(iy/8)*8;\n\n            int fx=ix-x0;\n            int fy=iy-y0;\n\n            NC nc=near(col(x0+4, y0+4));\n\n            o = vec4(pal(nc.i0),1.0);\n            if(iMouse.z>0.)\n            {\n                switch(nc.w)\n                {\n                    case 1:if((fx%2+fy%2)==2)o = vec4(pal(nc.i1),1.0);break;\n                    case 2:if((fx+fy)%2==0)o = vec4(pal(nc.i1),1.0);break;\n                    case 3:if((fx%2+fy%2)<2)o = vec4(pal(nc.i1),1.0);break;\n                }\n            }\n            else\n            {\n                switch(nc.w)\n                {\n                    case 1:if(ilen(fx-3,fy-3)<2)o = vec4(pal(nc.i1),1.0);break;\n                    case 2:if(ilen(fx-3,fy-3)<6)o = vec4(pal(nc.i1),1.0);break;\n                    case 3:if(ilen(fx-3,fy-3)>=2)o = vec4(pal(nc.i1),1.0);break;\n                }\n            }\n        }\n    }\n    if(sc>1)\n    {\n        o*=1.0-abs(fract(fc.y/float(sc))-0.65);\n    }\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}