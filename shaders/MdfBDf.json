{
    "Shader": {
        "info": {
            "date": "1498475813",
            "description": "Quick enhancement of my shader at the Shader Showdown Paris #1.",
            "flags": 0,
            "hasliked": 0,
            "id": "MdfBDf",
            "likes": 28,
            "name": "Ice cream",
            "published": 3,
            "tags": [
                "shadershowdown"
            ],
            "usePreview": 0,
            "username": "Koltes",
            "viewed": 849
        },
        "renderpass": [
            {
                "code": "struct M{float d;vec3 c;};\nfloat C,S;\n#define rot(a) mat2(C=cos(a),S=sin(a),-S,C)\n#define t iTime\n\nM mmin(M a,M b,float k){\n    float h=clamp((b.d-a.d)/k*.5+.5,0.,1.);\n    M m;\n    m.d=mix(b.d,a.d,h)-k*h*(1.-h);\n    m.c=mix(b.c,a.c,h);\n    return m;\n}\n\nM map(vec3 p){   \n    p.y-=.1*sin(t*5.)-.2;\n    p.xz*=rot(t);\n    float a=atan(p.z,p.x);\n    float d=dot(normalize(vec2(.9,-.2)),vec2(length(p.xz),p.y+2.));\n    d=max(d,p.y-1.);\n    M m;\n    m.d=d;\n    vec2 st=fract(vec2(a/6.2831*10.+p.y*1., a/6.2831*2.-p.y*4.));\n    st*=(1.-st);\n    m.c=mix(vec3(.8,.4,.0),vec3(.9,.8,.0),pow(st.x*st.y*15.,.5));\n    d=length(p.xz)-(.8+.1*sin(a*8.+p.y*15.-.5))*(smoothstep(.5,1.,p.y)-smoothstep(1.5,3.,p.y));\n    M m2;\n    m2.d=d;\n    m2.c=mix(vec3(.9),vec3(.9,.1,.1),step(.5,fract(a/6.2831*4.+p.y/6.2831*7.5)));\n    m=mmin(m,m2,.1);\n    return m;\n}\n\nvec3 hsv(float h,float s,float v){\n    vec3 k=vec3(3.,2.,1.)/3.,\n        p=abs(fract(h+k.xyz)*6.-3.);\n    return v*mix(k.xxx,clamp(p-1.,0.,1.),s);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy,v=uv*(1.-uv);\n    uv-=.5;\n    uv.x*=iResolution.x/iResolution.y;\n    \n    vec3 ro=vec3(uv,-5.),rd=normalize(vec3(uv,1.)),mp=ro;\n    M m;\n    float f;for(f=0.;f<30.;++f){\n        m=map(mp);\n        if(abs(m.d)<.001)break;\n        mp+=rd*m.d;\n    }\n    float mbg=min(1.,length(mp-ro)*.01);\n    float a=atan(uv.y+.8,uv.x)/6.2831*40.+iTime;\n    vec3 bg=mix(vec3(.0,.4,.8),vec3(.1,.5,.9),step(.5,fract(a)))*2.;\n    vec3 c=mix(m.c*vec3(1.-f/30.)*1.2,bg,mbg);\n    for(f=0.;f<40.;++f){\n        vec4 h=fract(sin(f+vec4(0.,3.,5.,8.))*1e4);\n        h.y=fract(h.y-t*.1);\n        vec3 p=(h.xyz-.5)*8.;\n        p.xz*=rot(t*.7);\n        float l=length(cross(p-ro,rd));\n        c+=.01/l/l*hsv(h.w,1.,1.);\n    }\n    c=sqrt(c)*pow(v.x*v.y*20.,.6);\n\tfragColor = vec4(c,1.0);\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}