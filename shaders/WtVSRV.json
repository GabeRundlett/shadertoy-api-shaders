{
    "Shader": {
        "info": {
            "date": "1583157339",
            "description": "raymarched version of the classic tunnel effect",
            "flags": 0,
            "hasliked": 0,
            "id": "WtVSRV",
            "likes": 3,
            "name": "raymarched tunnel",
            "published": 3,
            "tags": [
                "raymarching",
                "tunnel"
            ],
            "usePreview": 0,
            "username": "isk",
            "viewed": 320
        },
        "renderpass": [
            {
                "code": "const int ITER=256;\nconst float MAX=100.,EPS=.001;\n\nvec3 ray(vec2 uv, vec3 ro, vec3 poi) {\n    vec3 f=normalize(poi-ro),\n         r=normalize(cross(vec3(0,1,0),f)),\n         u=cross(f,r),\n         m=ro+f,\n         p=m+r*uv.x+u*uv.y;\n    return normalize(p-ro);\n}\n\nfloat zcyl(vec3 p, float r) {\n    return length(p.xy)-r;\n}\n\nfloat scene(vec3 p) {\n    return .5-zcyl(p,.5);\n}\n\nfloat map(vec3 ro, vec3 rd) {\n    float t=0.,d;\n    for(int i=0; i<ITER; ++i) {\n        d=scene(ro+rd*t);\n        if(abs(d)<EPS) return t;\n        t+=d;\n        if(t>MAX) return t;\n    }\n    return t;\n}\n\nvec3 normal(vec3 p) {\n    const vec2 D=vec2(.001,0);\n    return normalize(scene(p)-vec3(scene(p-D.xyy),scene(p-D.yxy),scene(p-D.yyx)));\n}\n\nvec3 march(vec2 uv) {\n    vec3 ro=vec3(sin(iTime)/2.,sin(iTime*.8)*.2,cos(iTime)/2.),rd=ray(uv,ro,vec3(0));\n    \n    float t=map(ro, rd);\n    \n    if (t<MAX) {\n        vec3 p=ro+rd*t;\n        vec3 n=normal(p);\n        vec2 uv=vec2(p.z,atan(p.y,p.x));\n        vec3 tex=texture(iChannel0,uv-vec2(iTime,.0)).rgb;\n        return tex/max(abs(-p.z),1.);\n    }\n    \n    return vec3(0);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    vec2 uv=(fragCoord-.5*iResolution.xy)/iResolution.y;\n    vec3 col=march(uv);\n    fragColor=vec4(col,1);\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "texture",
                        "id": 8,
                        "published": 1,
                        "sampler": {
                            "filter": "mipmap",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "repeat"
                        },
                        "src": "/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}