{
    "Shader": {
        "info": {
            "date": "1561500511",
            "description": "This piece holds deep emotional significance for me.\n\nI know the code could be better/smaller, but I do not wish to be told how.\n\nReleased at NOVA 2019: [url]https://www.pouet.net/prod.php?which=81605[/url]",
            "flags": 32,
            "hasliked": 0,
            "id": "tlS3Wd",
            "likes": 22,
            "name": "Light at the end of the tunnel",
            "published": 3,
            "tags": [
                "pathtracer"
            ],
            "usePreview": 0,
            "username": "yx",
            "viewed": 1233
        },
        "renderpass": [
            {
                "code": "void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv=fragCoord.xy/iResolution.xy;\n\tvec4 tex = texture(iChannel0,uv)*3./(float(iFrame)+1.);\n\tuv-=.5;\n\tfragColor=pow(tex*(1.-dot(uv,uv)), vec4(.45));\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "#define pi acos(-1.)\n\nfloat sdBox( vec3 p, vec3 b )\n{\n    p=abs(p)-b;\n    return max(max(p.x,p.y),p.z);\n}\n\nvec2 hash2( const float n ) {\n\treturn fract(sin(vec2(n,n+1.))*vec2(43758.5453123));\n}\n\nbool m;\nfloat scene(vec3 p)\n{\n\tvec3 a=vec3(0,0,18.9),b=vec3(1.1,2,20);\n\tfloat diff=-min(sdBox(p+a,b),sdBox(p+a.zyx,b.zyx));\n\tfloat lite=sdBox(p+vec3(3,0,0),vec3(1,2,1));\n\tm=lite<diff;\n\treturn min(lite,diff);\n}\n\nvec2 rv2;\nvec3 B(vec3 n) {\n\tfloat theta = 2.*pi*rv2.x;\n\tfloat phi = acos(1.-2.*rv2.y);\n\tvec3 a = normalize(vec3(\n\t\tsin(phi) * cos(theta),\n\t\tsin(phi) * sin(theta),\n\t\tcos(phi)\n\t));\n\treturn a*sign(dot(a,n));\n}\n\nvec3 trace(vec3 h, vec3 dir)\n{\n    vec3 accum = vec3(1);\n    for(int bounce=0;bounce++<10;)\n    {\n        float k=1.;\n        for(int i=0;i++<100&&abs(k)>.001;)\n            k = scene(h),\n            h += dir*k;\n\t\t\t\n        if(abs(k)<.001)\n        {\n            if (m)\n                return accum*vec3((ivec3(7,25,31)>>int(abs(h.y*2.5)))&1);\n            \n\t\t\tvec3 o = vec3(.001, 0,0),n = normalize(vec3(\n\t\t\t\tscene(h+o.xyy)-scene(h-o.xyy),\n\t\t\t\tscene(h+o.yxy)-scene(h-o.yxy),\n\t\t\t\tscene(h+o.yyx)-scene(h-o.yyx)\n\t\t\t));\n\n            h +=n*.01;\n            dir = B(n);\n            accum *= dot(dir,n);\n        }\n\t\t\n        rv2 = hash2(rv2.y+rv2.x);\n    }\n    \n    return vec3(0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = gl_FragCoord.xy/iResolution.xy-.5;\n\n\tfloat seed = iTime+(uv.x+iResolution.x*uv.y)*1.51269341231;\n\trv2 = hash2( 24.4316544311+iTime+seed );\n\n\tuv += (rv2-.5)/iResolution.xy;\n\n\tuv.x*=iResolution.x/iResolution.y;\n\n    fragColor=texture(iChannel0,fragCoord/iResolution.xy);\n\tfragColor.rgb+=trace(vec3(0,0,-12),normalize(vec3(uv,1)));\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            }
        ],
        "ver": "0.1"
    }
}