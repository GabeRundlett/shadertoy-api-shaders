{
    "Shader": {
        "info": {
            "date": "1473885630",
            "description": "The visuals for the third part of my video \"Collatz and Self Similarity\": [url]https://www.youtube.com/watch?v=GJDz4kQqTV4[/url] (minus the text overlays, which cannot do in the online version of Shadertoy cause we don't support custom textures)",
            "flags": 0,
            "hasliked": 0,
            "id": "llcGDS",
            "likes": 34,
            "name": "Collatz",
            "published": 3,
            "tags": [
                "2d",
                "fractal",
                "mathematics",
                "maths",
                "collatzconjecture",
                "collatz"
            ],
            "usePreview": 0,
            "username": "iq",
            "viewed": 3518
        },
        "renderpass": [
            {
                "code": "// Created by inigo quilez - iq/2016\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n\n\n// The visuals for the last part of \"Collatz and Self Similarity\": \n//\n// https://www.youtube.com/watch?v=GJDz4kQqTV4\n\n\n//------------------------------------------------------\n// global\n//------------------------------------------------------\n\n#define AA 3 // supersampling level. Make higher for more quality.\n\nconst float pi = 3.1415926535897932384626433832795; // should be pronounced \"pee\" not \"pie\", dear english speakers!\n\n//------------------------------------------------------\n// complex numbers\n//------------------------------------------------------\n\nvec2 cadd( vec2 a, float s ) { return vec2( a.x+s, a.y ); }\nvec2 cmul( vec2 a, vec2 b )  { return vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x ); }\nvec2 cdiv( vec2 a, vec2 b )  { float d = dot(b,b); return vec2( dot(a,b), a.y*b.x - a.x*b.y ) / d; }\nvec2 cmulj( vec2 z ) { return vec2(-z.y,z.x); }\nvec3 cexp( vec2 z ) { return vec3( exp(z.x), vec2( cos(z.y), sin(z.y) ) ); }\nvec3 cexpj( vec2 z ) { return vec3( exp(-z.y), vec2( cos(z.x), sin(z.x) ) ); }\n\n//------------------------------------------------------\n// signed distance functions\n//------------------------------------------------------\n\nfloat sdSegment( vec2 p, vec2 a, vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nfloat smin( float a, float b, float k )\n{\n    float h = clamp( 0.5+0.5*(b-a)/k, 0.0, 1.0 );\n    return mix( b, a, h ) - k*h*(1.0-h);\n}\n\nfloat sdCurveb( in vec2 p, vec2 k0, vec2 k1, vec2 k2, float h)\n{\n    h = smoothstep(0.0,0.8,h);\n    vec2 c = k0;\n    vec2 b = (4.0*k1 - k2 - 3.0*k0);\n    vec2 a = 2.0*k0 - 4.0*k1 + 2.0*k2;\n    float res = length(p-k0);\n    for( int i=0; i<50; i++ )\n    {\n        float t1 = float(i+0)/50.0;\n        float t2 = float(i+1)/50.0;\n        if( t1>=h ) break;\n        t2 = min(t2,h);\n        \n        vec2 p1 = a*t1*t1 + b*t1 + c;\n        vec2 p2 = a*t2*t2 + b*t2 + c;\n        \n        res = min( res, sdSegment( p, p1, p2 ) );\n    }\n    \n    return res;    \n}\n\n//------------------------------------------------------\n// Visualization\n//------------------------------------------------------\n\nconst vec2 fp4 = vec2(-4.001318,0.1870178);\nconst vec2 fp3 = vec2(-2.008426,0.2190410);\nconst vec2 fp2 = vec2(-0.5185009860894,0.124974296258);\nconst vec2 fp1 = vec2( 0.0);\nconst vec2 fp5 = vec2( 1.9982895,0.1291284);\n\nvec3 render( in vec2 fragCoord, float time )\n{\n    float sc = 4.5;\n    vec2 ce = vec2(0.0,0.0);    \n\n    if( time>0.0 )\n    {\n        sc = 4.5 * pow( 0.9, 0.2*time );\n    }\n    if( time>43.0 )\n    {\n        sc = 4.5 * pow( 0.9, 0.2*time ) * pow( 0.9, 88.0*smoothstep( 43.0, 60.0, time ) );\n    }\n    if( time>60.0 )\n    {\n        float f = smoothstep( 60.0, 75.0, time );\n    \tsc = mix( sc, 2.5, 1.0-exp(-0.001*pow(time-60.0,3.0)) );\n    \tce = mix( ce, vec2(3.0,0.0), pow(smoothstep(60.0,75.0,time), 3.0 ) );\n    }\n    if( time>75.0 )\n    {\n        sc = mix( sc, 3.5 * pow( 0.9, 6.3*smin(time-75.0,15.0,5.0) ), smoothstep(75.0,80.0,time) );\n    }\n    if( time>96.0 )\n    {\n\tfloat f = smin(time-96.0,5.0,0.5)/5.0;\n        sc = mix( sc, 2.5, pow( f, 6.0 ) );\n        sc = mix( sc, 2.5/pow(0.9, 0.08*smin(time-100.0,35.0,2.0) ), smoothstep(100.0,103.0,time) );\n    }\n    if( time>157.5 )\n    {\n        sc = mix( sc, 2.5*pow(0.9, 1.4*smin(time-157.5,5.5,0.5) ), pow(smoothstep(157.5,162.5,time),2.0) );\n    }\n    if( time>187.0 )\n    {\n        sc = mix( sc, sc*pow(0.9, 8.2*smin(time-187.5,5.5,0.5) ), pow(smoothstep(187.0,192.5,time),2.0) );\n    }\n    if( time>212.0 )\n    {\n        sc = mix( sc, sc*pow(0.9, 2.4*smin(time-212.0,6.0,0.2) ), pow(smoothstep(212.0,218.0,time),2.0) );\n    }\n\n\n    if( time>268.0 )\n    {\n        sc = mix( sc, sc/pow(0.9, 3.5*smin(time-268.0,19.0,0.2) ), pow(smoothstep(268.0,268.0+19.0,time),2.0) );\n    }\n\n    vec2 p = ce + sc*(-iResolution.xy+2.0*fragCoord) / iResolution.x;\n    float e = sc*2.0/iResolution.x;\n    \n    vec2 z = p;\n    \n    const float th = 10000000000.0;\n    \n    vec2 lz = z;\n    float d = 0.0;\n    float f = 0.0;\n    float rmin = th;\n    vec2 dz = vec2(1.0,0.0);\n    vec2 ldz = dz;\n    for( int i=0; i<64; i++ )\n    {\n        vec3 k = cexpj( pi*z );\n        \n        lz = z;\n        ldz = dz;\n\n        dz = cmul( (vec2(7.0,0.0) - k.x*cmul(k.yz,vec2(5.0-5.0*pi*z.y, pi*(5.0*z.x+2.0))))/4.0, dz );\n        \n        z = ( cadd(7.0*z,2.0) - k.x*cmul(k.yz,cadd(5.0*z,2.0)) )/4.0;\n\n        float r = length(z);\n        rmin = min( rmin, r );\n        if( r>th ) { d=1.0; break; }\n        f += 1.0;\n    }\n    \n    vec3 col = vec3(0.0);\n    if( d<0.5 )\n    {\n        col = vec3(0.0,0.0,0.0);\n    }\n    else if( d<1.5 )\n    {\n        col = vec3(1.0,0.6,0.2);\n        \n        f += clamp( log(th/length(lz))*1.8, 0.0, 1.0 ) - 1.0;\n        col = 0.5 + 0.5*cos(0.15*f + 1.5 + vec3(0.2,0.9,1.0));\n        col *= 0.027*f;\n        \n        float dis = log(length(lz))*length(lz)/length(ldz);\n        col += 0.025*sqrt(dis/sc) - 0.1;\n        col *= 1.1;\n    }\n    else //if( d<0.5 )\n    {\n        col = vec3(1.0,1.0,0.0);\n    }\n    \n    // anchor\n    #if 1\n    float ra = 1.0*sqrt(abs(p.x))/5.0;\n    col = mix( col, vec3(1.0,1.0,0.0), (1.0 - smoothstep( ra, ra+0.01, rmin ))*smoothstep(100.0,103.0,time)*(1.0-smoothstep(268.0,273.0,time )) );\n    #endif\n\n    // fixed point\n    #if 1\n    {\n    float show = smoothstep( 21.0, 22.0, time ) - smoothstep( 32.0, 33.0, time );\n    col = mix( col, vec3(1.0,0.9,0.4), show*(1.0 - smoothstep( sc*0.002, sc*0.004, abs(length(p-fp1)-0.03*sc) )) );\n    col = mix( col, vec3(1.0,0.9,0.4), show*(1.0 - smoothstep( sc*0.002, sc*0.004, abs(length(p-fp2)-0.03*sc) )) );\n    col = mix( col, vec3(1.0,0.9,0.4), show*(1.0 - smoothstep( sc*0.002, sc*0.004, abs(length(p-fp3)-0.03*sc) )) );\n    col = mix( col, vec3(1.0,0.9,0.4), show*(1.0 - smoothstep( sc*0.002, sc*0.004, abs(length(p-fp4)-0.03*sc) )) );\n    col = mix( col, vec3(1.0,0.9,0.4), show*(1.0 - smoothstep( sc*0.002, sc*0.004, abs(length(p-fp5)-0.03*sc) )) );\n    }\n    #endif\n\n    // integers\n    #if 1\n    {\n    float show = smoothstep( 16.0, 17.0, time ) - smoothstep( 19.0, 20.0, time );\n    if( abs(p.y)<0.5 )\n    {\n    float f = length( fract(p+0.5) - 0.5 );\n    col = mix( col, vec3(1.0,1.0,0.0), (1.0 - smoothstep( sc*0.002, sc*0.004, abs(f-0.03*sc) ))*show );\n    }\n    }\n    #endif\n\n    // first preimages of 0\n    #if 0\n    {\n    vec2 z = p;\n    vec3 k = cexpj( pi*z );\n    vec2 dz = cdiv( cadd(7.0*z,2.0) , cadd(5.0*z,2.0) ) - k.x*k.yz;\n    float f = length(dz);\n    col = mix( col, vec3(1.0,1.0,0.0), 1.0 - smoothstep( 0.15,0.2,f) );\n    }\n    #endif\n    \n    col = clamp( col, 0.0, 1.0 );\n    \n    // axis\n    #if 1\n    float show = 1.0 - smoothstep(268.0,273.0,time );\n    float g  = smoothstep( 0.0, 1.0*e, abs( fract(p.y+0.5)-0.5 ) );\n          g *= smoothstep( 0.0, 1.0*e, abs( fract(p.x+0.5)-0.5) );\n    col = mix( col, vec3(0.0,0.0,0.0), (1.0-g)*show );\n\n          g  = smoothstep( 0.5*e, 2.0*e, abs(p.y) );\n          g *= smoothstep( 0.5*e, 2.0*e, abs(p.x) );\n    col = mix( col, vec3(0.0,0.0,0.0), (1.0-g)*show );\n   \n    #endif\n\n    // zoom point\n    #if 1\n    {\n    float show = smoothstep(142.0,143.0,time ) - smoothstep(268.0,273.0,time );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0-smoothstep( 17.0*e, 18.0*e, length(p - ce)))*show );\n    }\n    #endif\n\n    // fingers\n    #if 1\n    {\n    float d1 = sdSegment( p, vec2(0.4,-2.0), vec2(-0.0,1.0) );\n    float d2 = sdSegment( p, vec2(1.32,-2.0), vec2(0.95,1.0) );\n    float d3 = sdSegment( p, vec2(2.2,-2.0), vec2(1.9,1.0) );\n    float d4 = sdSegment( p, vec2(3.2,-2.0), vec2(2.9,1.0) );\n    float ct = smoothstep( 156.0, 158.0, time );\n    col = mix( col, vec3(1.0,1.0,0.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d1 ))*(smoothstep(150.0,151.0,time)-ct) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d2 ))*(smoothstep(151.0,152.0,time)-ct) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d3 ))*(smoothstep(152.0,153.0,time)-ct) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d4 ))*(smoothstep(153.0,154.0,time)-ct) );\n    }\n    #endif\n\n    // fingers2\n    #if 1\n    {\n    float show = smoothstep( 172.5, 173.0, time ) - smoothstep( 185.0, 187.0, time );\n\n    float f0 = smoothstep(173.0,174.5,time);\n    float f1 = smoothstep(174.9,175.4,time);\n    float f2 = smoothstep(175.3,175.8,time);\n    float f3 = smoothstep(175.7,176.2,time);\n    float f4 = smoothstep(176.8,177.3,time);\n    float f5 = smoothstep(177.1,177.6,time);\n    float f6 = smoothstep(177.4,177.9,time);\n    float f7 = smoothstep(178.0,178.5,time);\n    float f8 = smoothstep(178.3,178.8,time);\n    float f9 = smoothstep(178.6,179.1,time);\n    float f10 = smoothstep(179.1,179.6,time);\n\n    float d0 = sdCurveb( p, vec2(2.28,-0.17), vec2(2.12,-0.08), vec2(1.92,-0.08), f0 );\n    float d1 = sdCurveb( p, vec2(2.32,-0.14), vec2(2.12,-0.01), vec2(1.92,0.05), f1 );\n    float d2 = sdCurveb( p, vec2(2.36,-0.10), vec2(2.20,0.05), vec2(1.95,0.15), f2 );\n    float d3 = sdCurveb( p, vec2(2.41,-0.08), vec2(2.20,0.22), vec2(2.0,0.35), f3 );\n    float d4 = sdCurveb( p, vec2(2.46,-0.05), vec2(2.37,0.22), vec2(2.2,0.5), f4 );\n    float d5 = sdCurveb( p, vec2(2.53,-0.04), vec2(2.50,0.30), vec2(2.5,0.6), f5 );\n    float d6 = sdCurveb( p, vec2(2.59,-0.04), vec2(2.65,0.30), vec2(2.76,0.55), f6 );\n    float d7 = sdCurveb( p, vec2(2.65,-0.05), vec2(2.81,0.25), vec2(3.1,0.5), f7 );\n    float d8 = sdCurveb( p, vec2(2.70,-0.06), vec2(2.84,0.12), vec2(3.0,0.25), f8 );\n    float d9 = sdCurveb( p, vec2(2.76,-0.09), vec2(2.93,0.06), vec2(3.1,0.12), f9 );\n    float d10 = sdCurveb( p, vec2(2.8,-0.12), vec2(2.95,-0.01), vec2(3.1,0.02), f10 );\n\n    col = mix( col, vec3(1.0,1.0,0.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d0 ))*show*step(0.0001,f0) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d1 ))*show*step(0.0001,f1) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d2 ))*show*step(0.0001,f2) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d3 ))*show*step(0.0001,f3) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d4 ))*show*step(0.0001,f4) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d5 ))*show*step(0.0001,f5) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d6 ))*show*step(0.0001,f6) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d7 ))*show*step(0.0001,f7) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d8 ))*show*step(0.0001,f8) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d9 ))*show*step(0.0001,f9) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d10 ))*show*step(0.0001,f10) );\n    }\n    #endif\n\n    // fingers3\n    #if 1\n    {\n    float show = smoothstep( 197.5, 198.0, time ) - smoothstep( 210.0, 212.0, time );\n\n    float f0 = smoothstep(198.0,198.5,time);\n    float f1 = smoothstep(202.2,202.7,time);\n    float f2 = smoothstep(202.6,203.1,time);\n    float f3 = smoothstep(203.0,203.5,time);\n    float f4 = smoothstep(203.9,204.4,time);\n    float f5 = smoothstep(204.5,205.0,time);\n\n    float d0 = sdCurveb( p, vec2(2.9936,-0.004), vec2(2.9926,-0.001), vec2(2.9915,0.0005), f0 );\n    float d1 = sdCurveb( p, vec2(2.9948,-0.004), vec2(2.994,-0.001), vec2(2.993,0.001), f1 );\n    float d2 = sdCurveb( p, vec2(2.9959,-0.003), vec2(2.9953,-0.001), vec2(2.9941,0.0015), f2 );\n    float d3 = sdCurveb( p, vec2(2.9973,-0.0027), vec2(2.9967,0.0), vec2(2.996,0.002), f3 );\n    float d4 = sdCurveb( p, vec2(2.9988,-0.0024), vec2(2.9983,0.0), vec2(2.9975,0.0028), f4 );\n    float d5 = sdCurveb( p, vec2(3.00045,-0.0021), vec2(3.00005,0.0), vec2(2.9994,0.0031), f5 );\n\n    col = mix( col, vec3(1.0,1.0,0.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d0 ))*show*step(0.0001,f0) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d1 ))*show*step(0.0001,f1) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d2 ))*show*step(0.0001,f2) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d3 ))*show*step(0.0001,f3) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d4 ))*show*step(0.0001,f4) );\n    col = mix( col, vec3(1.0,1.0,1.0), (1.0 - smoothstep( sc*0.005, sc*0.006, d5 ))*show*step(0.0001,f5) );\n    }\n    #endif\n    \n    return col;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec3 col = vec3(0.0);\n    \n    int ZERO = min(iFrame,0);\n    \n#if AA>1\n    for( int m=ZERO; m<AA; m++ )\n    for( int n=ZERO; n<AA; n++ )\n    {\n        vec2 px = fragCoord + vec2(float(m),float(n))/float(AA);\n    \tcol += render( px, iTime );    \n    }\n    col /= float(AA*AA);\n#else\n        \n    col = render( fragCoord, iTime );\n#endif            \n    \n\tfragColor = vec4( col, 1.0 );\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}