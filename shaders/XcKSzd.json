{
    "Shader": {
        "info": {
            "date": "1715673733",
            "description": "Ozone absorption spectrum and number density, and their approximations.\nPlots:\nRed   - number density (logscale) vs height (0..90 km).\nGreen - absorption cross section (logscale) vs wavelength (200..1100 nm).",
            "flags": 0,
            "hasliked": 0,
            "id": "XcKSzd",
            "likes": 6,
            "name": "Ozone spectrum & density approx.",
            "published": 3,
            "tags": [
                "spectrum",
                "atmosphere",
                "ozone"
            ],
            "usePreview": 0,
            "username": "FordPerfect",
            "viewed": 175
        },
        "renderpass": [
            {
                "code": "// Public Domain under http://unlicense.org, see link for details.\n\n// Ozone absorption spectrum and number density, and their approximations.\n// Yet another \"I need this written down somewhere\" shader.\n// See also tabulated values at the bottom of the shader.\n// Quality of approximations is pretty low, but may be sufficient for\n// computer graphics purposes.\n// Plots:\n// Red   - number density (logscale) vs height (0..90 km).\n// Green - absorption cross section (logscale) vs wavelength (200..1100 nm).\n// Sources:\n// Gorshelev, V., Serdyuchenko, A., Weber, M., Chehade, W., and Burrows, J. P.: High spectral resolution ozone absorption cross-sections – Part 1: Measurements, data analysis and comparison with previous measurements around 293 K, Atmos. Meas. Tech., 7, 609–624, https://doi.org/10.5194/amt-7-609-2014, 2014.\n//     https://amt.copernicus.org/articles/7/609/2014/amt-7-609-2014.pdf\n// Krueger, A. & Minzner, Raymond. (1976). A MidLatitude Ozone Model for the 1976 U.S. Standard Atmosphere. Journal of Geophysical Research. 81. 4477-4481. 10.1029/JC081i024p04477. \n//     https://ntrs.nasa.gov/api/citations/19750004397/downloads/19750004397.pdf\n\n// WARNING: careful with the units - the code freely intermixes nm, cm, and m.\n\n// Some numbers, for scale reference:\n// 1 DU (Dobson Unit) = column of 1/100 mm of pure ozone at NTP.\n// Equals ~2.69e20 molecules/m^2, or ~2.69e16 molecules/cm^2.\n// Earth average ~300 DU.\n// Ozone hole ~100 DU.\n// At 300 DU, the optical depth of vertical ozone column is\n//     at 305 nm:  ~3.7  (~97% absorption)\n//     at 550 nm:  ~0.03 (~ 3% absorption)\n// For comparison, the optical depth of rayleigh scattering\n// for vertical column at 550 nm is ~0.09.\n// The optical depth of the horizontal column is ~38 times larger for\n// rayleigh scattering, and ~14 times larger for ozone absorption.\n// The maximum cross section is             ~1.09e-17 cm^2/molecule at ~250 nm (UV).\n// The maximum in visible range is          ~5.1e-21  cm^2/molecule at ~603 nm (orange).\n// The second maximum in visible range is   ~4.7e-21  cm^2/molecule at ~574 nm (yellow).\n// The cross section at 550 nm (green) is   ~3.3e-21  cm^2/molecule.\n// Maximum ozone number density is ~4.86e18 molecules/m^3 at ~22 km.\n// This corresponds to volume-absorption coefficient ~1.6e-6 m^-1 at 550 nm.\n\n// Approximation of ozone absorption cross section at 293 K. Fitted to\n//     https://igaco-o3.fmi.fi/ACSO/files/cross_sections/Serdyuchenko/SerdyuchenkoGorshelev5digits.dat\n// WARNING: smoothed-out version that ignores and/or gets wrong many individual peaks.\n// Valid range: [214;1099] nm. May be VERY wrong outside.\n// Input: wavelength in nm.\n// Output: ozone absorption cross section, in cm^2/molecule.\n// Accuracy:\n//     x<=380: Eabs<2.5e-18 (<22% of peak)\n//     x>=380: Eabs<3.0e-22 (<5.9% of peak)\n// Relative accuracy is atrocious (Erel>100%).\nfloat sigmaO3(float x)\n{\n    if(x>213.0&&x<380.0) return\n        exp(-1632.43483+x*(+27.2816384+x*(-0.188136709+x*(+0.000652848908+x*(-1.13680875e-06+x*(+7.90050380e-10))))));\n    if(x>=380.0&&x<=780.0) return\n        exp(-178.194363+x*(+1.07246495+x*(-0.00403429758+x*(+8.14291496e-06+x*(-8.30370951e-09+x*+3.31168412e-12)))))+\n        exp(0.1*min(603.0-x,0.0)+0.02*x-60.414287)*(exp(0.5*cos(0.19039955476*x-114.810931522))-1.0);\n    if(x>780.0) return\n        exp(-36.6867555-x*0.0162778335);\n    return 0.0;\n}\n\n// Approximation of ozone number density for 1976 US Standard\n// Atmosphere. Fitted to\n//     https://ntrs.nasa.gov/api/citations/19750004397/downloads/19750004397.pdf\n// Input: height, in m.\n// Output: number density, in m^-3.\n// NOTE: vertical column integrates to ~9.918e22 molecules/m^2 (~368.7 Dobson Units).\n// Accuracy on [2000;74000]:\n//     Eabs<7.1e17 (<15% of peak)\n//     Erel<0.34\nfloat number_density(float x)\n{\n    if(x<0.0||x>74000.0) return 0.0;\n    return exp((((-1.2272e-18*x+2.6322e-13)*x-2.2212e-8)*x+6.3885e-4)*x+3.7199e+1)+exp(-2.1512e-4*x+41.491);\n}\n\n// Optical depth of ozone column.\n// Input: TCO (Total Column Ozone), in Dobson Units and wavelength, in nm.\n// Output: optical depth, dimensionless.\nfloat optical_depth(float TCO,float lambda)\n{\n    // Dobson Unit is ~2.69e16 molecules/cm^2.\n    return 2.69e16*TCO*sigmaO3(lambda);\n}\n\n// Volume-absorption coefficient of ozone.\n// Input: number density, in molecules/m^3 and wavelength, in nm.\n// Output: volume-absorption coefficient, in m^-1.\nfloat absorption_coefficient(float n,float lambda)\n{\n    return 1e-4*n*sigmaO3(lambda);\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord)\n{\n    float x=fragCoord.x/iResolution.x;\n    float y=fragCoord.y/iResolution.y;\n    float t,z;\n    vec3 col=vec3(0.25);\n    t=mix(200.0,1100.0,x);\n    col+=sign(fract(t/200.0)-0.5)/16.0;\n    z=log(sigmaO3(t))-mix(-56.0,-38.0,y);\n    col+=vec3(0.2,0.7,0.2)*smoothstep(1.5*fwidth(z),0.0,abs(z));\n    t=mix(0.0,90000.0,x);\n    z=log(number_density(t))-mix(32.0,44.0,y);\n    col+=vec3(0.7,0.2,0.2)*smoothstep(1.5*fwidth(z),0.0,abs(z));\n    fragColor=vec4(col,1.0);\n}\n\n/*\nTabulated ozone cross section at 293K, from\n    https://igaco-o3.fmi.fi/ACSO/files/cross_sections/Serdyuchenko/SerdyuchenkoGorshelev5digits.dat\n\nwavelength, cross section,\nnm          cm^2/molecule\n    215    8.69174e-19\n    220    1.70771e-18\n    225    2.95248e-18\n    230    4.46946e-18\n    235    6.23129e-18\n    240    8.18922e-18\n    245    9.68108e-18\n    250    1.09532e-17\n    255    1.12151e-17\n    260    1.05002e-17\n    265    9.47834e-18\n    270    7.98173e-18\n    275    5.94789e-18\n    280    4.08060e-18\n    285    2.55630e-18\n    290    1.44218e-18\n    295    7.70425e-19\n    300    3.85774e-19\n    305    1.99593e-19\n    310    1.00606e-19\n    315    5.17281e-20\n    320    3.19929e-20\n    325    1.80650e-20\n    330    4.47970e-21\n    335    2.51992e-21\n    340    1.64281e-21\n    345    7.28649e-22\n    350    2.96595e-22\n    355    1.14737e-22\n    360    7.86729e-23\n    365    4.89998e-23\n    370    1.43998e-23\n    375    1.07535e-23\n    380    6.05000e-24\n    385    5.63129e-24\n    390    6.37119e-24\n    395    9.93041e-24\n    400    1.08931e-23\n    405    1.45614e-23\n    410    2.73584e-23\n    415    2.73272e-23\n    420    3.67918e-23\n    425    6.88229e-23\n    430    6.34511e-23\n    435    8.67188e-23\n    440    1.36017e-22\n    445    1.70103e-22\n    450    1.90910e-22\n    455    2.06409e-22\n    460    3.73736e-22\n    465    3.62710e-22\n    470    4.23633e-22\n    475    4.62059e-22\n    480    7.50064e-22\n    485    8.12383e-22\n    490    8.05562e-22\n    495    8.82009e-22\n    500    1.17690e-21\n    505    1.59589e-21\n    510    1.53550e-21\n    515    1.62933e-21\n    520    1.78775e-21\n    525    2.12908e-21\n    530    2.60581e-21\n    535    2.80770e-21\n    540    2.85800e-21\n    545    3.12041e-21\n    550    3.28728e-21\n    555    3.47567e-21\n    560    3.85734e-21\n    565    4.28641e-21\n    570    4.56971e-21\n    575    4.71594e-21\n    580    4.54067e-21\n    585    4.36403e-21\n    590    4.35934e-21\n    595    4.65333e-21\n    600    5.04591e-21\n    605    5.04864e-21\n    610    4.68299e-21\n    615    4.27739e-21\n    620    3.96949e-21\n    625    3.73459e-21\n    630    3.48286e-21\n    635    3.22636e-21\n    640    2.93639e-21\n    645    2.67983e-21\n    650    2.46527e-21\n    655    2.26778e-21\n    660    2.07607e-21\n    665    1.89287e-21\n    670    1.69000e-21\n    675    1.51048e-21\n    680    1.36070e-21\n    685    1.25981e-21\n    690    1.12029e-21\n    695    9.80889e-22\n    700    8.61826e-22\n    705    7.79101e-22\n    710    7.21213e-22\n    715    6.92089e-22\n    720    6.15793e-22\n    725    5.33050e-22\n    730    4.69532e-22\n    735    4.32453e-22\n    740    4.20804e-22\n    745    4.38452e-22\n    750    4.24676e-22\n    755    3.29706e-22\n    760    2.80398e-22\n    765    2.54689e-22\n    770    2.49432e-22\n    775    2.82993e-22\n    780    3.16317e-22\n    785    2.54422e-22\n    790    2.01525e-22\n    795    1.64354e-22\n    800    1.50869e-22\n    805    1.44894e-22\n    810    1.78793e-22\n    815    2.15641e-22\n    820    2.03527e-22\n    825    1.37866e-22\n    830    9.25718e-23\n    835    7.41137e-23\n    840    7.25890e-23\n    845    8.24592e-23\n    850    1.08252e-22\n    855    1.42024e-22\n    860    1.08465e-22\n    865    6.83539e-23\n    870    4.66398e-23\n    875    3.38458e-23\n    880    3.54366e-23\n    885    4.53529e-23\n    890    5.17083e-23\n    895    5.43790e-23\n    900    6.04610e-23\n    905    4.48766e-23\n    910    2.88631e-23\n    915    1.89764e-23\n    920    1.46353e-23\n    925    1.48116e-23\n    930    1.62084e-23\n    935    1.56034e-23\n    940    2.92209e-23\n    945    4.24532e-23\n    950    2.42652e-23\n    955    1.60530e-23\n    960    1.06555e-23\n    965    8.72538e-24\n    970    4.74497e-24\n    975    3.10778e-24\n    980    3.39292e-24\n    985    4.37270e-24\n    990    1.72173e-23\n    995    2.51912e-23\n   1000    7.10749e-24\n   1005    4.00193e-24\n   1010    3.26705e-24\n   1015    2.19712e-24\n   1020    2.18297e-24\n   1025    1.66007e-24\n   1030    1.84401e-24\n   1035    2.01267e-24\n   1040    3.47933e-24\n   1045    4.68956e-24\n   1050    7.35739e-24\n   1055    3.87269e-24\n   1060    3.27044e-24\n   1065    3.31533e-24\n   1070    2.89031e-24\n   1075    2.19173e-24\n   1080    2.11441e-24\n   1085    1.70173e-24\n   1090    2.29484e-24\n   1095    1.69736e-24\n   1100    1.73668e-24\n\nCompare to data from\n    A. J. Preetham, P. Shirley, and B. Smits. “A Practical Analytic Model for Daylight”. In: Proceedings of the 26th Annual Conference on Computer Graphics and Interactive Techniques. SIGGRAPH ’99. New York, NY, USA: ACM Press/Addison-Wesley Publishing Co., 1999, pp. 91–100. isbn: 0-201-48560-5. doi: 10.1145/311535.311545. url: http://dx.doi.org/10.1145/311535.311545\n    https://courses.cs.duke.edu/fall01/cps124/resources/p91-preetham.pdf\n\nlambda, nm   ko  \n 380         -  \n 390         -  \n 400         -  \n 410         -  \n 420         -  \n 430         -  \n 440         -  \n 450        0.3 \n 460        0.6 \n 470        0.9 \n 480        1.4 \n 490        2.1 \n 500        3.0 \n 510        4.0 \n 520        4.8 \n 530        6.3 \n 540        7.5 \n 550        8.5 \n 560       10.3 \n 570       12.0 \n 580       12.0 \n 590       11.5 \n 600       12.5 \n 610       12.0 \n 620       10.5 \n 630        9.0 \n 640        7.9 \n 650        6.7 \n 660        5.7 \n 670        4.8 \n 680        3.6 \n 690        2.8 \n 700        2.3 \n 710        1.8 \n 720        1.4 \n 730        1.1 \n 740        1.0 \n 750        0.9 \n 760        0.7 \n 770        0.4 \n 780         -  \n\nwhich gives optical depth as ko*l, where l is the amount of ozone, in m,\nat NTP (i.e. l=1e-5*TCO), listing l=0.0035 m as common amount for vertical\ncolumn.\n\n\nTabulated ozone number density, from\n    https://ntrs.nasa.gov/api/citations/19750004397/downloads/19750004397.pdf\nHeight, number density,\nm       m^-3\n 2000   6.8e17\n 4000   5.8e17\n 6000   5.7e17\n 8000   6.5e17\n10000   1.13e18\n12000   2.02e18\n14000   2.35e18\n16000   2.95e18\n18000   4.04e18\n20000   4.77e18\n22000   4.86e18\n24000   4.54e18\n26000   4.03e18\n28000   3.24e18\n30000   2.52e18\n32000   2.03e18\n34000   1.58e18\n36000   1.22e18\n38000   8.73e17\n40000   6.07e17\n42000   3.98e17\n44000   2.74e17\n46000   1.69e17\n48000   1.03e17\n50000   6.64e16\n52000   3.84e16\n54000   2.55e16\n56000   1.61e16\n58000   1.12e16\n60000   7.33e15\n62000   4.81e15\n64000   3.17e15\n66000   1.72e15\n68000   7.5e14\n70000   5.4e14\n72000   2.2e14\n74000   1.7e14\n\n*/",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}