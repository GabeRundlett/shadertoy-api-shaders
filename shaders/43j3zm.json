{
    "Shader": {
        "info": {
            "date": "1708323365",
            "description": "Approximation for total Rayleigh volume-scattering coefficient for Standard Air, in range of 380..780 nm.\nPlots: red - const*λ^-4, green - this approximation.",
            "flags": 0,
            "hasliked": 0,
            "id": "43j3zm",
            "likes": 4,
            "name": "Rayleigh scattering coef. approx",
            "published": 3,
            "tags": [
                "approximation",
                "scattering",
                "rayleigh"
            ],
            "usePreview": 0,
            "username": "FordPerfect",
            "viewed": 190
        },
        "renderpass": [
            {
                "code": "// Public Domain under http://unlicense.org, see link for details.\n\n// Approximation for total Rayleigh volume-scattering coefficient for Standard Air,\n// in range of 380..780 nm.\n// NOTE: this is mostly an excuse to have this written down somewhere.\n// Rayleigh scattering is generally considered to have const*λ^-4 behavior.\n// This is not quite right, as some elements of the supposed \"const\" are\n// themselves dependent on λ. The difference is only ~4% in the visible spectrum,\n// but can be substantial outside (where this approximation also performs poorly,\n// though not quite as bad): β(200 nm)/β(900 nm)≈589.5, but (900/200)^4≈410.\n// The source data is taken from the publication below.\n// Plots:\n//     red   - const*λ^-4.\n//     green - this approximation.\n//\n// If you don't care about accuracy, (β [in km^-1]) ≈ 1e-3 * (λ [in µm])^-4\n// works passably well (<10% in visible spectrum, <33% on 200..900 nm).\n\n/*\nSource:\nBucholtz, A. (1995). Rayleigh-scattering calculations for the terrestrial atmosphere. Applied Optics, 34(15), 2765. doi:10.1364/ao.34.002765\n\nTable 2. Total Rayleigh-Scattering Cross Section σ and Total Rayleigh\nVolume-Scattering Coefficient βs for Standard Air (Ps=1013.25 mbars,\nTs=288.15 K)\n\nWavelength λ | Rayleigh-Scattering    | Rayleigh Volume-Scattering\n  (µm)       | Cross Section σ (cm^2) | Coefficient βs (km^-1)\n-------------+------------------------+----------------------------\n  0.20       |     3.612e-25          | 9.202e-1\n  0.21       |     2.836e-25          | 7.225e-1\n  0.22       |     2.269e-25          | 5.781e-1\n  0.23       |     1.841e-25          | 4.691e-1\n  0.24       |     1.515e-25          | 3.859e-1\n  0.25       |     1.259e-25          | 3.208e-1\n  0.26       |     1.056e-25          | 2.690e-1\n  0.27       |     8.939e-26          | 2.277e-1\n  0.28       |     7.614e-26          | 1.940e-1\n  0.29       |     6.534e-26          | 1.665e-1\n  0.30       |     5.642e-26          | 1.437e-1\n  0.31       |     4.903e-26          | 1.249e-1\n  0.32       |     4.279e-26          | 1.090e-1\n  0.33       |     3.752e-26          | 9.557e-2\n  0.34       |     3.307e-26          | 8.425e-2\n  0.35       |     2.924e-26          | 7.450e-2\n  0.36       |     2.598e-26          | 6.619e-2\n  0.37       |     2.317e-26          | 5.901e-2\n  0.38       |     2.071e-26          | 5.275e-2\n  0.39       |     1.858e-26          | 4.734e-2\n  0.40       |     1.673e-26          | 4.261e-2\n  0.41       |     1.509e-26          | 3.845e-2\n  0.42       |     1.366e-26          | 3.479e-2\n  0.43       |     1.239e-26          | 3.156e-2\n  0.44       |     1.127e-26          | 2.870e-2\n  0.45       |     1.027e-26          | 2.616e-2\n  0.46       |     9.378e-27          | 2.389e-2\n  0.47       |     8.583e-27          | 2.187e-2\n  0.48       |     7.871e-27          | 2.005e-2\n  0.49       |     7.232e-27          | 1.842e-2\n  0.50       |     6.656e-27          | 1.696e-2\n  0.51       |     6.138e-27          | 1.564e-2\n  0.52       |     5.669e-27          | 1.444e-2\n  0.53       |     5.245e-27          | 1.336e-2\n  0.54       |     4.860e-27          | 1.238e-2\n  0.55       |     4.509e-27          | 1.149e-2\n  0.56       |     4.189e-27          | 1.067e-2\n  0.57       |     3.897e-27          | 9.927e-3\n  0.58       |     3.630e-27          | 9.247e-3\n  0.59       |     3.385e-27          | 8.624e-3\n  0.60       |     3.161e-27          | 8.053e-3\n  0.61       |     2.956e-27          | 7.530e-3\n  0.62       |     2.767e-27          | 7.049e-3\n  0.63       |     2.593e-27          | 6.605e-3\n  0.64       |     2.432e-27          | 6.196e-3\n  0.65       |     2.284e-27          | 5.819e-3\n  0.66       |     2.147e-27          | 5.470e-3\n  0.67       |     2.020e-27          | 5.146e-3\n  0.68       |     1.903e-27          | 4.847e-3\n  0.69       |     1.793e-27          | 4.568e-3\n  0.70       |     1.692e-27          | 4.310e-3\n  0.71       |     1.597e-27          | 4.069e-3\n  0.72       |     1.510e-27          | 3.846e-3\n  0.73       |     1.428e-27          | 3.637e-3\n  0.74       |     1.351e-27          | 3.442e-3\n  0.75       |     1.280e-27          | 3.261e-3\n  0.76       |     1.213e-27          | 3.090e-3\n  0.77       |     1.150e-27          | 2.931e-3\n  0.78       |     1.092e-27          | 2.781e-3\n  0.79       |     1.037e-27          | 2.641e-3\n  0.80       |     9.854e-28          | 2.510e-3\n  0.90       |     6.129e-28          | 1.561e-3\n  1.00       |     4.010e-28          | 1.022e-3\n  1.10       |     2.734e-28          | 6.964e-4\n  1.20       |     1.927e-28          | 4.909e-4\n  1.30       |     1.398e-28          | 3.560e-4\n  1.40       |     1.038e-28          | 2.644e-4\n  1.50       |     7.872e-29          | 2.005e-4\n  1.60       |     6.077e-29          | 1.548e-4\n  1.70       |     4.766e-29          | 1.214e-4\n  1.80       |     3.790e-29          | 9.656e-5\n  1.90       |     3.052e-29          | 7.775e-5\n  2.00       |     2.485e-29          | 6.331e-5\n  2.20       |     1.697e-29          | 4.322e-5\n  2.40       |     1.197e-29          | 3.050e-5\n  2.60       |     8.691e-30          | 2.214e-5\n  2.80       |     6.460e-30          | 1.646e-5\n  3.00       |     4.901e-30          | 1.249e-5\n  3.50       |     2.645e-30          | 6.737e-6\n  4.00       |     1.550e-30          | 3.948e-6\n*/\n\n// Input is wavelength, in nm.\n// Output is Rayleigh volume-scattering coefficient, in km^-1.\nfloat rayleigh_beta(float lambda)\n{\n    float x=1e3/lambda,x2=x*x,x4=x2*x2;\n    // Accuracy:\n    //     Erel<4e-3 on [200;4000] nm.\n    return x4*(+0.00100015817+x*(+2.88665402e-5+x*(-8.11554757e-6+x*+4.20198457e-6)));\n    // Alternative version, tuned for visible spectrum\n    //     Erel<6.5e-4 on [360; 830] nm.\n    //     Erel<1.1e-2 on [200;4000] nm.\n    // return x4*(+0.000993168185+x*(+2.88651029e-05+x*(-4.76165072e-06+x*(+3.51883561e-06))));\n}\n\n#if 0\n// Old version.\n// Accuracy:\n//     Erel<5.6e-4 on [380;780].\n//     Erel<8.7e-2 on [200;900].\n//     VERY wrong for λ>1100 nm. \nfloat rayleigh_beta(float lambda)\n{\n    float x=1e-3*lambda;\n    return 0.0010544*pow(x,(x*(x*(x*1.8998-3.01335)+1.848948)-4.41594));\n    // NOTE: the version below has more uniform accuracy:\n    //     Erel<1.5e-2 on [200;900].\n    // return 0.0010503*pow(x,(x*(x*(x*3.4259-5.60816)+3.27612)-4.65924));\n}\n#endif\n\n#if 0\n// Expression from the paper. Slightly less accurate on [380;780] nm,\n// but has MUCH better accuracy across entire [200;4000] nm measured\n// range. Quote:\n// Equation (8) fits the data to within 0.4% for wavelengths\n// less than 0.25 µm, to better than 0.2% in the 0.25–0.5-µm range,\n// and to better than 0.1% for wavelengths greater than 0.5 µm.\n//\n// NOTE: testing suggests that the actual errors are slightly larger,\n// but reasonably close to cited.\nfloat rayleigh_beta(float lambda)\n{\n    float x=1e-3*lambda;\n    return x<0.5?\n        7.68246e-4*pow(x,-(3.55212+1.35579*x+0.11563/x)):\n        10.21675e-4*pow(x,-(3.99668+1.10298e-3*x+2.71393e-2/x));\n}\n#endif\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord)\n{\n    vec2 xy=fragCoord/iResolution.xy;\n    float lambda=mix(380.0,780.0,xy.x);\n    vec3 col=vec3(0.125);\n    float y=rayleigh_beta(lambda);\n    float d,z=0.0010514*pow(1e-3*lambda,-4.0); // const*λ^-4, matched at λ=550 nm.\n    d=y/5.5e-2-xy.y;\n    col+=vec3(0.2,0.8,0.2)*smoothstep(1.0*fwidth(d),0.0,abs(d));\n    d=z/5.5e-2-xy.y;\n    col+=vec3(0.8,0.2,0.2)*smoothstep(1.0*fwidth(d),0.0,abs(d));\n    col=mix(12.92*col,1.055*pow(col,vec3(1.0/2.4))-0.055,step(0.0031308,col)); // sRGB\n    fragColor=vec4(col,1.0);\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}