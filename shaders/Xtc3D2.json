{
    "Shader": {
        "info": {
            "date": "1471540439",
            "description": "#shaderaday shader #7\n",
            "flags": 0,
            "hasliked": 0,
            "id": "Xtc3D2",
            "likes": 35,
            "name": "Aliens",
            "published": 3,
            "tags": [
                "alien",
                "egg",
                "aliens",
                "shaderaday"
            ],
            "usePreview": 0,
            "username": "ivansafrin",
            "viewed": 5125
        },
        "renderpass": [
            {
                "code": "const float PI = 3.14159265359;\nconst float EPSILON = 0.005;\n\nvec2 sphere_map(vec3 n) {\n\treturn vec2((atan(n.z,n.x)/(2.0 * PI)), acos(n.y) / (PI));\n}\n\nvec3 smin( vec3 a, vec3 b, float k ) {\n    float h = clamp( 0.5+0.5*(b.x-a.x)/k, 0.0, 1.0 );\n    return mix( b, a, h ) - k*h*(1.0-h);\n}\nvec3 scene(vec3 position) {\n    position.xz = mod(position.xz, 1.4) - 1.0;\n     \n    vec2 uv = sphere_map(normalize(position));\n    \n    float beat = 0.2+ (sin(iTime*20.0) * 0.05);\n    float height = 0.3 + texture(iChannel0, uv).x * beat * (0.5-distance(uv.y, 0.5));\n    vec3 r = vec3(height-0.1, height, height-0.1);\n    vec3 membraneVal = vec3((length(position/r) - 1.0) * min(min(r.x,r.y),r.z), 1.0, 0.0);\n   \n\tr = vec3(0.25, 0.35, 0.25);\n\tvec3 shellVal = vec3((length(position/r) - 1.0) * min(min(r.x,r.y),r.z), 0.0, 1.0);\n    \n    float mixAmt = texture(iChannel0, uv).x*1.1;\n    mixAmt = max(mixAmt, 0.2) - 0.2;\n    vec3 floorval = vec3(position.y+0.3+texture(iChannel0, position.xz).x*0.02, 0.0, 1.0);\n    vec3 eggVal = mix(shellVal, membraneVal, mixAmt);\n    return smin(floorval, eggVal, 0.2);\n}\n\nvec3 raymarch(vec3 position, vec3 direction) {\n    float total_distance = 0.0;\n    for(int i = 0 ; i < 64 ; ++i) {\n        vec3 result = scene(position + direction * total_distance);\n        if(result.x < EPSILON) {\n            return vec3(total_distance, result.y, result.z);\n        }\n        total_distance += result.x;\n    }\n    return vec3(-1.0, 0.0, 0.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 uv = fragCoord.xy / iResolution.y;\n    uv -= vec2(0.5*iResolution.x/iResolution.y, 0.5);\n    uv.y -= 0.3;\n    vec3 direction = normalize(vec3(uv, 2.5));\n    vec3 origin = vec3(0.3, 0.6, iTime*0.5);\n    vec3 result = raymarch(origin, direction);\n    \n    vec4 fogColor = vec4(0.1, 0.3, 0.1, 1.0);\n    \n      if(result.x < 0.0) {\n\t\tfragColor = fogColor;\n    } else{\n        vec3 pos = origin+direction*result.x;\n        const vec2 eps = vec2(0.0, EPSILON);\n        vec3 N = normalize(vec3(\n\t\t\tscene(pos + eps.yxx).x - scene(pos - eps.yxx).x,\n\t\t\tscene(pos + eps.xyx).x - scene(pos - eps.xyx).x,\n\t\t\tscene(pos + eps.xxy).x - scene(pos - eps.xxy).x));  \n          \n          vec3 lightPos = origin+vec3(sin(iTime), 0.0, 5.0);\n          \n \t\tfloat diffuse = dot(N, -normalize(pos-lightPos));\n    \t\n        float dist = length(pos-lightPos) * 0.1;\n        float attenuation = 1.0 / (1.0 + 2.3*dist + 6.0*dist*dist);\n  \n          \n\t\tdiffuse = max(0.0, diffuse) * attenuation; \n        vec2 auv = sphere_map(normalize(pos));\n        \n\t\tfloat beat = max(0.0, sin(iTime));\n        \n\t\tfloat distance = length(origin-pos);\n\t\tfloat fogVal = exp(-distance*distance*0.03);  \n        \n\t\tvec4 pulseColor = vec4(0.0, 0.3, 0.1, 1.0);\n\t\tvec4 membraneColor = vec4(0.756, 0.627 ,0.172, 1.0) ;\n\t\tvec4 finalColor = (pulseColor*diffuse*result.y)+ result.y * texture(iChannel0, auv).x * beat * vec4(1.0, 1.0, 0.0, 1.0) * 2.0 +\n            (membraneColor*diffuse*result.z)+\n            pow(max(0.0,dot(normalize(reflect(pos-lightPos, N)),normalize(-pos))), 40.0)\n            ;\n       fragColor = mix(fogColor, finalColor, fogVal);\n          fragColor.a = 1.0;\n      }\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 1,
                        "ctype": "cubemap",
                        "id": 26,
                        "published": 1,
                        "sampler": {
                            "filter": "mipmap",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png"
                    },
                    {
                        "channel": 0,
                        "ctype": "texture",
                        "id": 47,
                        "published": 1,
                        "sampler": {
                            "filter": "mipmap",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "repeat"
                        },
                        "src": "/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}