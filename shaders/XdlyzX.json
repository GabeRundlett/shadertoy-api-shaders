{
    "Shader": {
        "info": {
            "date": "1489141171",
            "description": "Tubes Grid 2",
            "flags": 0,
            "hasliked": 0,
            "id": "XdlyzX",
            "likes": 4,
            "name": "Tubes Grid 2",
            "published": 3,
            "tags": [
                "grid",
                "2",
                "tubes"
            ],
            "usePreview": 0,
            "username": "aiekick",
            "viewed": 658
        },
        "renderpass": [
            {
                "code": "// Created by Stephane Cuillerdier - Aiekick/2017 (twitter:@aiekick)\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n// Tuned via XShade (http://www.funparadigm.com/xshade/)\n\nmat3 RotZ(float a){return mat3(cos(a),-sin(a),0.,sin(a),cos(a),0.,0.,0.,1.);}\t// get rotation matrix near z\n\nfloat tubes(vec3 p, float a, float o)\n{\n    p *= RotZ(p.z * 0.1 + a * sin(iTime * .1) * 2.);\n   \tp.z = mod(p.z + o, 1.) - .5;\n    p.x -= 0.5;// + sin(iTime * 2.) * 0.5;\n    p.x += length(p.xy)*.5 - 1.5;// - (.7 + ((cos(iTime * 3.)*.5+.5)*0.3));\n    return length(p.xz) - 0.15;\n}\n\nvec2 df(vec3 p)\n{\n    float t0 = tubes(p, 0., 0.);\n    float t1 = tubes(p, 1.57, 0.25);\n    float t2 = tubes(p, 3.14, .5);\n    float t3 = tubes(p, 4.19, .75);\n    float d = min(t0,min(t1, min(t2,t3)));\n\treturn vec2(d,0);\n}\n\nvec3 nor( vec3 p, float prec )\n{\n    vec2 e = vec2( prec, 0. );\n    vec3 n = vec3(\n\t\tdf(p+e.xyy).x - df(p-e.xyy).x,\n\t\tdf(p+e.yxy).x - df(p-e.yxy).x,\n\t\tdf(p+e.yyx).x - df(p-e.yyx).x );\n    return normalize(n);\n}\n\n// from Dave Hoskins // https://www.shadertoy.com/view/Xsf3zX\nvec3 GetSky(in vec3 rd, in vec3 sunDir, in vec3 sunCol)\n{\n\tfloat sunAmount = max( dot( rd, sunDir), 0.0 );\n\tfloat v = pow(1.0-max(rd.y,0.0),6.);\n\tvec3  sky = mix(vec3(.1, .2, .3), vec3(.32, .32, .32), v);\n\tsky = sky + sunCol * sunAmount * sunAmount * .25;\n\tsky = sky + sunCol * min(pow(sunAmount, 800.0)*1.5, .3);\n\treturn clamp(sky, 0.0, 1.0);\n}\n\nfloat SubDensity(vec3 p, float ms) \n{\n\treturn df(p - nor(p,0.0001) * ms).x/ms;\n}\n\nvec2 shade(vec3 ro, vec3 rd, float d, vec3 lp, vec3 ldo, float li)\n{\n\tvec3 p = ro + rd * d;\n\tvec3 n = nor(p, 0.1);\n\tvec3 ldp = normalize(lp-n*1.5-p);\n\tvec3 refl = reflect(rd,n);\n\tfloat amb = 0.6;\n\tfloat diff = clamp( dot( n, ldp ), 0.0, 1.0);\n\tfloat fre = pow( clamp( 1. + dot(n,rd),0.0,1.0), 4.);\n\tfloat spe = pow(clamp( dot( refl, ldo ), 0.0, 1.0 ), 16.);\n\tfloat sss = 1. - SubDensity(p, 0.1);\n\treturn vec2(\n        (diff + fre + spe) * amb * li,\n        (diff + fre + sss) * amb * li + spe\n    );\n}\n\nvoid mainImage( out vec4 fragColor, vec2 fragCoord )\n{\n\tvec2 uv = (2.*fragCoord.xy-iResolution.xy)/iResolution.y;\n\tfloat t = iTime * 5.;\n\n    vec3 ld = vec3(0.,1., .5);\n    \n\tvec3 ro = vec3(0,0,t);\n\tvec3 cu = vec3(0,1,0);\n\tvec3 tg = ro + vec3(0,0,.1);\n\t\n\tfloat fov = .5;\n\tvec3 z = normalize(tg - ro);\n\tvec3 x = normalize(cross(cu, z));\n\tvec3 y = normalize(cross(z, x));\n\tvec3 rd = normalize(z + fov * (uv.x * x + uv.y * y));\n\t\n\tfloat s = 1., d = 0.;\n\tfloat dm = 200.;\n\t\n\tfor (float i=0.; i<250.; i++)\n\t{\n\t\tif (log(d*d/s/1e5)>0. || d>dm) break;\n\t\td += (s = df(ro + rd * d).x) * .3;\n\t}\n\t\n    fragColor.rgb = GetSky(rd, ld, vec3(1.5));\n    \n\tif (d<dm)\n\t{\n\t\tvec2 sh = shade(ro, rd, d, ro, ld, 1.2);\n\t\tfragColor.rgb = mix( \n            vec3(.4,1,.8) * sh.y * sh.x * .6 + vec3(.45,0,.72) * sh.x * 1.2, \n            fragColor.rgb, \n            1. - exp( -0.005*d*d ) ); \n\t}\n}\n",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}