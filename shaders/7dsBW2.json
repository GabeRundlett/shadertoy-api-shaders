{
    "Shader": {
        "info": {
            "date": "1645442383",
            "description": "Just drive - will not go off-road",
            "flags": 32,
            "hasliked": 0,
            "id": "7dsBW2",
            "likes": 29,
            "name": "Drive the Mapper",
            "published": 3,
            "tags": [
                "game",
                "interactive",
                "trail",
                "car",
                "building",
                "steer"
            ],
            "usePreview": 1,
            "username": "dr2",
            "viewed": 638
        },
        "renderpass": [
            {
                "code": "// \"Drive the Mapper\" by dr2 - 2022\n// License: Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License\n\n/*\n  No. 7 in \"Driving\" series; others are listed in \"Truck Driving 2\" (ftt3Ds)\n*/\n\n#define OE min(VJ,0)\n#define HV(DA)if(XH<Gk){Gk=XH; Pz=DA; Vb=RF;}\n#define JG(RF)Up=Wa; Wa=Up/2; if(Wa*2!=Up)XH+=Ez(RF)\n#define JG(RF)Up=Wa; Wa=Up/2; if(Wa*2!=Up)XH+=Ez(RF)\n#define VN iChannel0\n#define Zj iChannelResolution[0].xy\nconst float Xd=3.1415927;const int CB=32;const int AQ=7;const int IH=1,Fl=2,Dj=3,Yc=4,UG=5,Wr=6,EU=7,NO=8,Ks=9,GW=10,ZN=11;vec4 Wn,Jg;vec3 CW,Vb,FK,ZJ,LZ;vec2 GS[6],KR[6],DZ[6],YK,Go;float Lr,Id,Hv,Bl,SI,OA,PQ,Ha,Nk;int VJ,Pz;bool Nx,Pi,Iq;float Az(vec3 TH,vec3 UK){vec3 XH;XH=abs(TH)-UK;return min(max(XH.x,max(XH.y,XH.z)),0.)+length(max(XH,0.));}float YO(vec2 TH,vec2 UK){vec2 XH;XH=abs(TH)-UK;return min(max(XH.x,XH.y),0.)+length(max(XH,0.));}float KN(vec3 TH,vec3 UK,float BT){return length(max(abs(TH)-UK,0.))-BT;}float Hr(vec3 TH,vec3 UK,float BT){TH=max(abs(TH)-UK,0.);return sqrt(length(TH*TH))-BT;}float Jc(vec2 TH,vec2 UK,float BT){return length(max(abs(TH)-UK,0.))-BT;}float FG(vec3 TH,float Ai,float RB){return max(length(TH.xy)-Ai,abs(TH.z)-RB);}float My(vec3 TH,float Ai,float BT,float RB){return length(max(vec2(length(TH.xy)-Ai,abs(TH.z)-RB),0.))-BT;}float Ck(vec3 TH,float Ai,float RB){return length(vec3(TH.xy,sign(TH.z)*(max(0.,abs(TH.z)-RB))))-Ai;}float DV(vec3 TH,vec2 VW,float Ai,float RB){float XH;XH=max(dot(vec2(length(TH.xy)-Ai,TH.z),VW),abs(TH.z)-RB);RB/=VW.x*VW.x;Ai/=VW.x;XH=min(XH,min(length(vec3(TH.xy,TH.z+Ai*VW.y-RB))-Ai+RB*VW.y,length(vec3(TH.xy,TH.z+Ai*VW.y+RB))-Ai-RB*VW.y));return XH;}float Oj(vec3 TH,float Kw,float Ai){return length(vec2(length(TH.xy)-Ai,TH.z))-Kw;}float ED(vec2 TH){return min(TH.x,TH.y);}float CS(vec2 TH){return max(TH.x,TH.y);}float QX(float HM,float Jx,float Ai){float RB;RB=clamp(0.5+0.5*(Jx-HM)/Ai,0.,1.);return mix(Jx-RB*Ai,HM,RB);}float Pm(float HM,float Jx,float Ai){return-QX(-HM,-Jx,Ai);}mat3 ZA(float Xq,float ID){vec2 RW,Rg,Wv;RW=vec2(Xq,ID);Rg=cos(RW);Wv=sin(RW);return mat3(Rg.y,0.,-Wv.y,0.,1.,0.,Wv.y,0.,Rg.y)*mat3(1.,0.,0.,0.,Rg.x,-Wv.x,0.,Wv.x,Rg.x);}vec2 Ro(vec2 RF,float BL){vec2 VW;VW=sin(BL+vec2(0.5*Xd,0.));return vec2(dot(RF,vec2(VW.x,-VW.y)),dot(RF.yx,VW));}vec2 PD(vec2 RF,vec2 VW){return vec2(dot(RF,vec2(VW.x,-VW.y)),dot(RF.yx,VW));}vec3 BP(vec3 Pv){return Pv.z*mix(vec3(1.),clamp(abs(fract(Pv.xxx+vec3(1.,2./3.,1./3.))*6.-3.)-1.,0.,1.),Pv.y);}float Ez(vec2 RF){return(1.-smoothstep(0.13,0.17,abs(RF.x)))*(1.-smoothstep(0.5,0.57,abs(RF.y)));}float EY(vec2 RF,int QT){float XH;int Up,Wa;const vec2 Xh=vec2(0.5,0.5),Sa=vec2(-0.5,0.5),Vw=vec2(1.,0.);if(QT==-1)Up=8;else if(QT<2)Up=(QT==0)?119:36;else if(QT<4)Up=(QT==2)?93:109;else if(QT<6)Up=(QT==4)?46:107;else if(QT<8)Up=(QT==6)?122:37;else    Up=(QT==8)?127:47;RF=(RF-0.5)*vec2(1.8,2.3);XH=0.;Wa=Up;JG(RF.yx-Vw); JG(RF.xy-Xh); JG(RF.xy-Sa); JG(RF.yx);JG(RF.xy+Sa); JG(RF.xy+Xh); JG(RF.yx+Vw);return XH;}float GJ(vec2 RF,vec2 Bu,float Ng,float Li){float Sn,Md,UK,Gb;RF=vec2(-RF.x,RF.y)/Bu;UK=0.;if(min(RF.x,RF.y)>=0.&&max(RF.x,RF.y)<1.){RF.x*=Ng;Sn=Ng;Md=Ng-1.-floor(RF.x);RF.x=fract(RF.x);Li=max(Li,0.);Gb=Li/pow(10.,Ng-Md-1.);if(Md>=Ng-Sn)UK=EY(RF,int(mod(floor(Gb),10.)));}return UK;}const float Df=43758.54;vec2 Tm(float TH){return fract(sin(mod(TH+vec2(0.,1.),2.*Xd))*Df);}vec2 UX(vec2 TH){vec2 EQ=vec2(37.,39.);return fract(sin(mod(dot(TH,EQ)+vec2(0.,EQ.x),2.*Xd))*Df);}vec3 WI(vec2 TH){vec2 EQ=vec2(37.,39);return fract(sin(mod(dot(TH,EQ)+vec3(0.,EQ.xy),2.*Xd))*Df);}float Xu(float TH){vec2 EH;float LM,Qh;LM=floor(TH);Qh=fract(TH);Qh=Qh*Qh*(3.-2.*Qh);EH=Tm(LM);return mix(EH.x,EH.y,Qh);}float Zf(vec2 TH){vec2 EH,LM,Qh;LM=floor(TH);Qh=fract(TH);Qh=Qh*Qh*(3.-2.*Qh);EH=mix(UX(LM),UX(LM+vec2(0.,1.)),Qh.y);return mix(EH.x,EH.y,Qh.x);}float Cx(float TH){float AM,BL;AM=0.;BL=1.;for(int SE=0;SE<5;SE++){AM+=BL*Xu(TH);BL*=0.5;TH*=2.;}return AM*(1./1.9375);}float Ei(vec2 TH){float AM,BL;AM=0.;BL=1.;for(int SE=0;SE<5;SE++){AM+=BL*Zf(TH);BL*=0.5;TH*=2.;}return AM*(1./1.9375);}float FT(vec3 TH,vec3 OR){vec3 UK;float BL;UK=vec3(0.);BL=1.;for(int SE=0;SE<5;SE++){UK+=BL*vec3(Zf(TH.yz),Zf(TH.zx),Zf(TH.xy));BL*=0.5;TH*=2.;}return dot(UK,abs(OR));}vec3 MT(vec3 TH,vec3 OR,float AM){vec4 Gb;vec3 RB;vec2 VF=vec2(0.1,0.);for(int SE=OE;SE<4;SE++){Gb[SE]=FT(TH+((SE<2)?((SE==0)?VF.xyy:VF.yxy):((SE==2)?VF.yyx:VF.yyy)),OR);}RB=Gb.xyz-Gb.w;return normalize(OR+AM*(RB-OR*dot(OR,RB)));}const float Xy=128.;vec4 Bh(int By){float Ow;Ow=float(By);return texture(VN,(vec2(mod(Ow,Xy),floor(Ow/Xy))+0.5)/Zj);}float FX(vec3 TH){vec3 RF,Tq;float Gk,XH,EH,Zs,TU;TH-=Wn.xyz;TH.xz=Ro(TH.xz,Wn.w);Gk=Lr;if(!Nx)XH=KN(TH,vec3(ZJ.x,ZJ.y+1.2,ZJ.z),0.5);if(Nx||XH<0.1){RF=TH;TU=My(vec3(abs(RF.x)-FK.x,RF.y,FK.z*(fract(RF.z/FK.z+0.5)-0.5)).yzx,Hv+0.02,0.05,0.35);RF.y-=1.1;Zs=Hr(RF,ZJ-1.,1.);XH=min(abs(Zs)-0.05,max(Zs,TU-0.05));XH=Pm(XH,-max(abs(abs(RF.z)-FK.z-Hv-0.2)-0.01,0.02-abs(Zs)),0.02);XH=Pm(XH,-min(min(Jc(vec2(RF.y-0.3,abs(RF.z)-1.05),vec2(0.3,0.75),0.2),Jc(vec2(abs(RF.x)-0.6,RF.y-0.3),vec2(0.3,0.25),0.2)),max(Jc(vec2(RF.x,RF.z-0.8),vec2(0.8,0.5),0.2),-RF.y)),0.02);XH=max(XH,-max(TU,max(abs(RF.z)-FK.z-(Hv+0.1),FK.x-0.7-abs(RF.x))));HV(IH);RF=TH;RF.yz-=vec2(ZJ.y+1.33+0.05,-1.);XH=My(RF.xzy,0.15,0.05,0.22);RF.y-=max(0.5*SI,0.)-0.05;XH=min(XH,My(RF.xzy,0.6,0.15,0.03));HV(Ks);RF=TH;RF.xz=abs(RF.xz)-FK.xz-vec2(-0.2,-0.5*FK.z);RF.z=abs(RF.z)-0.5*FK.z;XH=FG(RF.yzx,0.1,0.2);HV(Fl);for(int Up=OE;Up<6;Up++){RF=TH;RF.xz=PD(RF.xz-GS[Up]*FK.xz,KR[Up]);EH=Hv-length(RF.yz);RF.yz=PD(RF.yz,DZ[Up]);Tq=abs(RF);XH=min(max(length(max(vec2(0.1-EH,Tq.x-0.1),0.))-0.1,EH-0.2),max(0.2-EH,Tq.x-0.12));XH=max(XH,-max(abs(fract(4.*RF.x/0.24)-0.5)-0.2,EH-0.05));XH=min(XH,FG(vec3(Tq.x-0.1,((Tq.y<Tq.z)?RF.yz:RF.zy)),0.06,Hv-0.15));RF.x*=sign(TH.x);HV(Dj);}RF=TH;XH=KN(RF-vec3(-0.4,0.5,ZJ.z-0.4),vec3(0.1,0.5,0.03),0.05);RF.yz=Ro(RF.yz-vec2(0.72,-0.2),-0.1*Xd);RF-=vec3(-0.4,0.9,1.8);XH=min(XH,My(RF,0.03,0.03,0.35));RF.z-=-0.35;RF.xy=Ro(RF.xy,-8.*Bl+Xd/6.);RF.xy=Ro(RF.xy,2.*Xd*floor(3.*atan(RF.y,-RF.x)/(2.*Xd)+0.5)/3.);XH=min(XH,Oj(RF,0.025,0.35));RF.x+=0.17;XH=min(XH,FG(RF.yzx,0.02,0.17));HV(Yc);RF=TH;RF.yz-=vec2(0.5,0.8);XH=KN(RF,vec3(0.98,0.2,0.35)-0.05,0.05);RF.yz=Ro(RF.yz-vec2(0.5,-0.45),0.1*Xd);RF.x=abs(RF.x)-0.49;XH=min(XH,KN(RF,vec3(0.48,0.35,0.1)-0.05,0.05));HV(UG);RF=TH;RF.yz-=vec2(0.6,-1.);XH=KN(RF,vec3(0.98,0.2,0.35)-0.05,0.05);RF.yz=Ro(RF.yz-vec2(0.5,-0.45),0.1*Xd);RF.x=abs(RF.x)-0.49;XH=min(XH,KN(RF,vec3(0.48,0.35,0.1)-0.05,0.05));HV(UG);RF=TH;RF-=vec3(0.1,-0.1,1.5);RF.yz=Ro(RF.yz,Xd*(0.02+0.06*sign(SI)));RF.y-=0.5;XH=Ck(RF.xzy,0.04,0.5);HV(Wr);RF=TH;RF.yz-=vec2(1.1,2.4);XH=Ck(RF.xzy,0.06,0.05);HV(EU);RF=TH;XH=Ck((vec3(abs(RF.xz),RF.y).xzy-vec3(0.7,0.4,ZJ.z+0.02)).yzx,0.05,0.3);HV(NO);}else Gk=min(Gk,XH);return Gk;}\nfloat Jt(vec3 Mh,vec3 BT){vec3 TH;float CO,XH;CO=0.;for(int SE=OE;SE<160;SE++){TH=Mh+CO*BT;XH=FX(TH);CO+=XH;if(XH<0.001||CO>Lr||TH.y<0.)break;}if(TH.y<0.)CO=Lr;return CO;}vec3 HI(vec3 TH){vec4 Gb;vec2 VF;VF=vec2(0.001,-0.001);for(int SE=OE;SE<4;SE++){Gb[SE]=FX(TH+((SE<2)?((SE==0)?VF.xxx:VF.xyy):((SE==2)?VF.yxy:VF.yyx)));}Gb.x=-Gb.x;return normalize(2.*Gb.yzw-dot(Gb,vec4(1.)));}float OV(vec3 TH){vec3 RF;float XH;TH-=Wn.xyz;TH.xz=Ro(TH.xz,Wn.w);RF=TH;RF.y-=1.1;return max(Hr(RF,ZJ-1.,1.),-0.5-RF.y);}float Sr(vec3 Mh,vec3 BT){vec3 TH;float CO,XH;CO=0.;for(int SE=OE;SE<60;SE++){TH=Mh+CO*BT;XH=OV(TH);CO+=XH;if(XH<0.001||CO>Lr||TH.y<0.)break;}if(TH.y<0.)CO=Lr;return CO;}vec3 QG(vec3 TH){vec4 Gb;vec2 VF;VF=vec2(0.001,-0.001);for(int SE=OE;SE<4;SE++){Gb[SE]=OV(TH+((SE<2)?((SE==0)?VF.xxx:VF.xyy):((SE==2)?VF.yxy:VF.yyx)));}Gb.x=-Gb.x;return normalize(2.*Gb.yzw-dot(Gb,vec4(1.)));}float Le(vec3 Mh,vec3 BT){float Dn,XH,RB;int SV;SV=Pz;Dn=1.;XH=0.02;Nx=true;for(int SE=OE;SE<30;SE++){RB=FX(Mh+XH*BT);Dn=min(Dn,smoothstep(0.,0.1*XH,RB));XH+=RB;if(Dn<0.05||XH>Lr)break;}Nx=false;Pz=SV;return 0.5+0.5*Dn;}void BC(){LZ=4.*floor(vec3(0.08*PQ,4.,0.08*PQ)*(0.4+0.6*WI(YK+Go)))-0.5;Nk=10.+2.*LZ.y;}float DR(vec3 TH){vec3 RF,Yx,Tq;float Gk,XH,Zs;Gk=Lr;RF=TH;RF.xz-=PQ*(YK+0.5);RF.y-=LZ.y;Zs=Az(RF,LZ);if(Pi){XH=Zs;}else{Yx=mod(RF+2.,4.)-2.;Yx.y-=0.2;Tq=abs(RF)-LZ+1.;XH=Pm(abs(Zs)-0.1,-min(max(YO(Yx.xy,vec2(1.3,1.)),CS(Tq.xy)),max(YO(Yx.zy,vec2(1.3,1.)),CS(Tq.zy))),0.05);XH=min(XH,max(abs(Yx.y-1.1)-0.05,Zs));}HV(GW);if(!Pi){RF.y-=-LZ.y;RF=vec3(abs(RF.xz)-LZ.xz-4.,RF.y-0.1*Nk);XH=Nk*DV(RF/Nk,sin(0.06*Xd+vec2(0.5*Xd,0.)),0.03,0.06);HV(ZN);}return Gk;}float Hn(vec3 Mh,vec3 BT){vec3 TH,DE;vec2 Av;float CO,XH,Zb;Zb=0.01;if(BT.x==0.)BT.x=0.0001;if(BT.z==0.)BT.z=0.0001;DE.xz=1./BT.xz;Av=vec2(-999.);CO=Zb;for(int SE=OE;SE<120;SE++){TH=Mh+CO*BT;TH.xz-=0.5*PQ;YK=floor(TH.xz/PQ);if(YK!=Av){Av=YK;BC();}XH=DR(TH);CO+=min(XH,Zb+max(0.,ED((PQ*(YK+step(0.,BT.xz))-TH.xz)*DE.xz)));if(XH<Zb||CO>Lr||TH.y<0.)break;}if(XH>=Zb||TH.y<0.)CO=Lr;return CO;}vec3 FC(vec3 TH){vec4 Gb;vec2 VF=vec2(0.001,-0.001);TH.xz-=0.5*PQ;for(int SE=OE;SE<4;SE++){Gb[SE]=DR(TH+((SE<2)?((SE==0)?VF.xxx:VF.xyy):((SE==2)?VF.yxy:VF.yyx)));}Gb.x=-Gb.x;return normalize(2.*Gb.yzw-dot(Gb,vec4(1.)));}float IY(vec3 Mh,vec3 BT){vec3 TH;vec2 Av;float Dn,XH,RB;int SV;SV=Pz;Dn=1.;Av=vec2(-999.);XH=0.01;for(int SE=OE;SE<30;SE++){TH=Mh+XH*BT;TH.xz-=0.5*PQ;YK=floor(TH.xz/PQ);if(YK!=Av){Av=YK;BC();}RB=DR(TH);Dn=min(Dn,smoothstep(0.,0.1*XH,RB));XH+=max(RB,0.01);if(RB<0.001||XH>Lr)break;}Pz=SV;return 0.5+0.5*Dn;}float Lz(vec2 TH){vec4 AU;vec2 Vo[2],WZ[2],Bd,RF;float We,UK,Cg;We=1.;for(float XL=-1.+float(OE);XL<=1.;XL++){Vo[0]=Wn.xz;WZ[0]=Vo[0]+Ro(vec2(0.,XL*FK.z),-Wn.w);for(int SE=OE;SE<CB;SE++){Vo[1]=Vo[0];WZ[1]=WZ[0];AU=Bh(AQ+SE);if(AU.z>=0.){Vo[0]=AU.xy;WZ[0]=Vo[0]+Ro(vec2(0.,XL*FK.z),-AU.z);UK=1.;if(XL==0.){Bd=WZ[0]-WZ[1];Cg=length(Bd);if(Cg>0.){RF=PD(TH-0.5*(WZ[0]+WZ[1]),Bd.yx/Cg);RF.x=abs(RF.x)-FK.x;UK=min(UK,Jc(RF,vec2(0.1,0.5*Cg),0.05));}}else{for(float Up=-1.;Up<=1.;Up+=2.){Bd=WZ[0]-WZ[1];Cg=length(Bd);if(Cg>0.){RF=PD(TH-0.5*(WZ[0]+WZ[1])+Ro(vec2(Up*FK.x,0.),-AU.z),Bd.yx/Cg);UK=min(UK,Jc(RF,vec2(0.1,0.5*Cg),0.05));}}}We=min(We,1.-0.3*sqrt(1.-min(1.,(float(SE)+20.*(Id-AU.w))/float(CB)))*(1.-smoothstep(0.,0.05,UK)));We=min(We,1.-0.3*sqrt(1.-float(SE)/float(CB))*(1.-smoothstep(0.,0.05,UK)));}else break;}}return We;}vec3 Mu(vec2 TH){vec2 VF;VF=vec2(0.01,0.);TH*=0.5;return vec3(normalize(vec3(Ei(TH)-vec2(Ei(TH+VF.xy),Ei(TH+VF.yx)),8.*VF.x)).xzy);}float Vs(vec2 TH,float TU){return Jc(mod(TH+0.5*PQ,PQ)-0.5*PQ,vec2(0.5*PQ)-2.*Ha-TU,Ha);}float Of(vec2 TH){float XH;XH=Lr;for(int Up=0;Up<6;Up++)XH=min(XH,length(Wn.xz-Ro((vec2(2.*mod(float(Up),2.),float(Up/2))-1.)*FK.xz,-Wn.w)-TH));return 0.7+0.3*smoothstep(0.2,0.3,XH);}vec3 KJ(vec2 TH,float Nc,float Dn){vec3 JX,Pe,TL;vec2 Qp,RF;float AM,We;Pe=0.4*mix(vec3(0.8,1.,0.5),vec3(0.7,0.9,0.5),0.2+0.6*smoothstep(0.3,0.7,Ei(0.5*TH)));Qp=vec2(0.);if(Vs(TH,0.4)>0.){AM=smoothstep(0.,0.1,abs(Vs(TH,0.2))-0.2);JX=mix(vec3(0.4,0.4,0.1),vec3(0.3),AM);TL=vec3(0.,1.,0.);Qp=vec2(4.,0.2+0.5*AM);}else{RF=TH-0.5*PQ;YK=floor(RF/PQ);BC();RF-=PQ*(YK+0.5);if(Jc(RF,LZ.xz+2.,0.5)<0.){JX=vec3(0.25);TL=vec3(0.,1.,0.);Qp=vec2(4.,1.);}else{JX=Pe;TL=Mu(TH);}}JX*=Of(TH);We=Lz(TH);Qp*=1.+2.*step(We,0.99);Qp.y*=1.-smoothstep(0.5,0.8,Nc/Lr);if(Qp.y>0.)TL=MT(Qp.x*vec3(TH.x,0.,TH.y),TL,Qp.y);JX*=(0.2+0.8*Dn*max(dot(TL,CW),0.))*(0.5+0.5*We);return JX;}vec3 LQ(vec3 Mh,vec3 BT){vec3 JX,GB,Kf;vec2 RF;float AM,La,ML,ZR;if(BT.y>-0.02&&BT.y<0.03*Cx(16.*atan(BT.z,-BT.x))){JX=vec3(0.3,0.4,0.5);}else{RF=0.01*(Mh.xz+2.*Id+((100.-Mh.y)/BT.y)*BT.xz);ML=Ei(RF);AM=smoothstep(0.2,0.8,ML);La=smoothstep(0.2,0.8,Ei(RF+0.01*CW.xz))-AM;GB=(0.7+0.5*ML)*(vec3(0.7)-0.7*vec3(0.3,0.3,0.2)*sign(La)*smoothstep(0.,0.05,abs(La)));ZR=max(dot(BT,CW),0.);Kf=vec3(0.3,0.4,0.8)+step(0.1,ZR)*vec3(1.,1.,0.9)*min(0.3*pow(ZR,64.)+0.5*pow(ZR,2048.),1.);JX=mix(Kf,GB,0.1+0.9*AM*smoothstep(0.01,0.1,BT.y));}return JX;}vec4 UC(out float IL){vec4 LI,Nt;float EH;Nt=vec4(0.95,0.9,0.9,0.2);LI=Nt;if(Pz==IH){if(!Iq){if(abs(Vb.z)<FK.z+Hv+0.2)LI.rgb*=0.7+0.3*smoothstep(0.,0.02,abs(length(vec2(Vb.y+1.1,FK.z*(fract(Vb.z/FK.z+0.5)-0.5)))-Hv-0.14)-0.02);LI.rgb*=0.7+0.3*smoothstep(0.,0.02,Jc(vec2(Vb.y-0.3,abs(Vb.z)-1.05),vec2(0.3,0.75),0.2)-0.04);LI.rgb*=0.7+0.3*smoothstep(0.,0.02,Jc(vec2(abs(Vb.x)-0.6,Vb.y-0.3),vec2(0.3,0.25),0.2)-0.04);if(Vb.y>0.)LI.rgb*=0.7+0.3*smoothstep(0.,0.02,Jc(vec2(Vb.x,Vb.z-0.8),vec2(0.8,0.5),0.2)-0.04);}else{LI*=0.5;}}else if(Pz==Ks){LI.rgb*=0.1+0.9*smoothstep(0.,0.02,length(vec2(Vb.y,dot(Vb.zx,sin(2.*Xd*floor(12.*atan(Vb.z,-Vb.x)/(2.*Xd)+0.5)/12.+vec2(0.5*Xd,0.)))))-0.12);}else if(Pz==Fl){LI=vec4(0.3,0.3,0.4,0.1);}else if(Pz==Dj){EH=Hv-length(Vb.yz);if(EH<0.17){LI=vec4(0.3,0.3,0.3,0.);if(EH<0.07)LI*=1.-0.5*abs(step(0.,cos(32.*Xd*Vb.x))-step(0.5,mod(32.*atan(Vb.z,-Vb.y)/(2.*Xd)+0.5,1.)));}else if(EH<0.2||Vb.x<0.){LI*=0.5;}}else if(Pz==Yc){LI=vec4(0.9,0.9,0.7,0.2);}else if(Pz==Wr){LI=vec4(0.9,0.9,0.7,0.2);}else if(Pz==UG){LI=vec4(0.9,0.7,0.4,0.05)*(0.95+0.05*cos(64.*Vb.x));}else if(Pz==EU){LI=(OA>0.)?vec4(0.,0.8,0.,-1.):vec4(0.8,0.,0.,-1.);}else if(Pz==NO){if(abs(Bl)>0.03*Xd&&Bl*Vb.x<0.&&abs(Vb.x)>0.95&&mod(2.*Id,1.)>0.5)LI=vec4(0.7,0.7,0.,-1.);else LI=(Vb.z>0.)?vec4(1.,1.,0.95,-1.):vec4(0.9,0.,0.,-1.);LI.rgb*=0.8+0.2*smoothstep(0.,0.02,abs(abs(Vb.x)-0.95));}IL=0.;if(LI==Nt)IL=0.3;return LI;}vec3 Ae(vec3 JX,vec3 BT){return mix(JX,vec3(0.3,0.4,0.5),pow(1.+BT.y,16.));}\nvec4 Ko(inout vec3 TL){vec4 LI;vec2 EH,Qp;float RB,UK,NK;RB=mod(dot(YK+Go,vec2(17.11,21.11)),1.);Qp=vec2(0.);if(Pz==GW){LI=vec4(BP(vec3(RB,0.4,0.8)),0.1);if(Az(Vb,LZ)<0.){LI*=0.3;if(TL.y<-0.95)LI=mix(vec4(1.,1.,0.5,-1.),LI,step(0.5,length(mod(Vb.xz+2.,4.)-2.)));}else{UK=0.;EH=vec2(dot(Vb.xz,normalize(vec2(-TL.z,TL.x)))-1.3,Vb.y+LZ.y-0.8);if(CS(abs(TL.xz))>0.99&&YO(EH,vec2(3.,1.))<0.1){NK=dot(mod(YK+31.+floor(0.4*Go),100.),vec2(100.,1.));UK=GJ(EH,vec2(2.4,0.6),4.,NK);if(UK>0.)LI=vec4(1.,1.,0.8,-1.);}if(UK==0.)Qp=vec2(16.,0.5);}}else if(Pz==ZN){LI=vec4(BP(vec3(mod(0.25+0.2*RB,1.),0.6,0.9)),0.);Qp=vec2(32.,1.);}if(Qp.y>0.)TL=MT(Qp.x*Vb,TL,Qp.y);return LI;}vec3 Iu(vec3 Mh,vec3 BT){vec4 LI;vec3 NS,Fp,JX,QP,TL,WM,RF;float Qy,ON,Sj,Nc,TY,IL,Dn;int Rk;NS=Mh;Fp=BT;Nx=false;Pi=false;ZJ=vec3(FK.x+0.05,1.2,FK.z+1.);for(int Up=OE;Up<6;Up++){GS[Up]=vec2(2.*mod(float(Up),2.),float(Up/2))-1.;KR[Up]=sin(-Bl*GS[Up].y+vec2(0.5*Xd,0.));DZ[Up]=sin(-((GS[Up].y!=1.)?((GS[Up].x<0.)?Jg.x:Jg.y):((GS[Up].x<0.)?Jg.z:Jg.w))+vec2(0.5*Xd,0.));}Qy=Hn(Mh,BT);Rk=Pz;WM=Vb;ON=Jt(Mh,BT);if(Qy<min(ON,Lr)){Pz=Rk;Vb=WM;ON=Qy;}if(ON<Lr){Mh+=ON*BT;TL=(Pz==Rk)?FC(Mh):HI(Mh);if(Pz==IH)Iq=(Hr(Vb,ZJ-1.,1.)<0.03);IL=0.;LI=(Pz==Rk)?Ko(TL):UC(IL);if(LI.a>=0.){TY=max(dot(TL,CW),0.);if(Pz!=Rk){Dn=Le(Mh+0.01*TL,CW);}else{Dn=1.;TY*=TY;}JX=LI.rgb*(0.2+0.8*Dn*TY)+LI.a*step(0.95,Dn)*pow(max(dot(CW,reflect(BT,TL)),0.),32.);if(Pz==Rk)JX=mix(JX,0.9*Ae(KJ(Mh.xz,Nc,Dn),BT),smoothstep(0.85,0.95,ON/Lr));if(IL>0.)BT=reflect(BT,TL);}else if(LI.a==-1.){JX=LI.rgb*(0.5-0.5*dot(BT,TL));}}if(ON>=Lr||IL>0.){if(BT.y<0.){Nc=-Mh.y/BT.y;Mh+=Nc*BT;Dn=(Nc<Lr)?min(Le(Mh+0.01*vec3(0.,1.,0.),CW),IY(Mh+0.01*vec3(0.,1.,0.),CW)):1.;QP=Ae(KJ(Mh.xz,Nc,Dn),BT);}else{QP=LQ(Mh,BT);}JX=(IL>0.)?mix(JX,0.9*QP,IL):QP;}Sj=Sr(NS,Fp);if(Sj<min(ON,Lr)){Mh=NS+Sj*Fp;TL=QG(Mh);JX*=vec3(0.9,1.,0.9);BT=reflect(Fp,TL);JX=mix(JX,LQ(Mh,BT),0.2+0.8*pow(1.-abs(dot(TL,BT)),5.));}Pi=true;Qy=Hn(NS,Fp);if(Qy<min(ON,Lr)){Mh=NS+Qy*Fp;TL=FC(Mh);BT=reflect(Fp,TL);JX=mix(0.8*JX,LQ(Mh,BT),0.6);}return clamp(JX,0.,1.);}void mainImage(out vec4 RS,in vec2 TD){mat3 YS;vec4 XP;vec3 BT,Mh,JX,Pv,AD;vec2 SR,Eq,CF,Im;float Xq,ID,Dw,PY,Uc,UK,Ut;\nVJ=iFrame;SR=iResolution.xy;Eq=2.*TD.xy/SR-1.;Eq.x*=SR.x/SR.y;Id=iTime;\nDw=SR.x/SR.y;XP=Bh(1);FK=XP.xyz;Hv=FK.y;SI=XP.w;XP=Bh(2);PQ=XP.x;Ha=XP.y;OA=XP.z;Uc=XP.w;XP=Bh(3);ID=XP.x;Xq=XP.y;Im=XP.zw;XP=Bh(4);Bl=XP.y;Go=mod(vec2(floor(XP.w),floor(XP.w/100.)),100.);XP=Bh(5);Wn=XP;XP=Bh(6);Jg=XP;Xq=clamp(Xq-0.1*Xd,-0.49*Xd,0.02*Xd);YS=ZA(Xq,ID);Mh=Wn.xyz+YS*vec3(0.,1.,-12.);Mh.y+=2.;Wn.y+=Hv;PY=3.5+2.*Xq;Lr=400.;CW=normalize(vec3(1.,2.,-1.));CW.xz=Ro(CW.xz,-ID);const float QC=1.;JX=vec3(0.);Ut=2.*mod(dot(mod(floor(0.5*(Eq+1.)*SR),2.),vec2(1.)),2.)-1.;for(float a=float(OE);a<QC;a++){BT=YS*normalize(vec3(Eq+step(1.5,QC)*Ro(vec2(0.5/SR.y,0.),Ut*(0.667*a+0.5)*Xd),PY));JX+=(1./QC)*Iu(Mh,BT);}AD=vec3(0.41,-0.32,0.135);CF=0.5*Eq-AD.xy*vec2(Dw,1.);UK=(length(CF)-AD.z)*SR.y;JX=mix(vec3(0.,1.,1.),JX,smoothstep(0.,1.,abs(UK)-1.));if(UK<0.){JX=mix(vec3(0.,1.,1.),JX,step(1.,ED(abs(CF))*SR.y));Pv=(OA>0.)?vec3(0.,1.,0.):vec3(0.8,0.,0.);JX=mix(Pv,JX,smoothstep(2.5,3.5,abs(length(CF-Im)*SR.y-10.)));CF=Ro(CF,atan(Im.y,-Im.x));if(CF.x<0.&&(length(Im)-length(CF))*SR.y>10.)JX=mix(Pv,JX,smoothstep(1.5,2.5,abs(CF.y)*SR.y));}JX=mix(JX,vec3(0.,1.,1.),GJ(0.5*Eq-vec2(0.44*Dw,-0.15),vec2(0.06*Dw,0.03),4.,mod(floor(Uc/(2.*Hv)),1e4)));RS=vec4(JX,1.);}\n",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "#define VN iChannel0\n#define Zj iChannelResolution[0].xy\nconst float Xd=3.1415927;const float Xy=128.;const int CB=32;const int AQ=7;vec4 Wn;vec3 FK;float PQ,Ha;int VJ;float Jc(vec2 TH,vec2 UK,float BT){return length(max(abs(TH)-UK,0.))-BT;}float NB(float Zw,float Yt,float ww,float xx){return(1.-smoothstep(Yt-ww,Yt+ww,xx))*smoothstep(Zw-ww,Zw+ww,xx);}vec2 Ro(vec2 RF,float BL){vec2 VW;VW=sin(BL+vec2(0.5*Xd,0.));return vec2(dot(RF,vec2(VW.x,-VW.y)),dot(RF.yx,VW));}vec4 Bh(int By){float Ow;Ow=float(By);return texture(VN,(vec2(mod(Ow,Xy),floor(Ow/Xy))+0.5)/Zj);}void Yg(int By,vec4 Li,inout vec4 HE,vec2 Jp){vec2 XH;float Ow;Ow=float(By);XH=abs(Jp-vec2(mod(Ow,Xy),floor(Ow/Xy))-0.5);if(max(XH.x,XH.y)<0.5)HE=Li;}bool Ql(){vec2 TH;bool MP;MP=true;for(int Up=0;Up<6;Up++){if(Up<=1||Up>=4){TH=Wn.xz-Ro((vec2(2.*mod(float(Up),2.),float(Up/2))-1.)*FK.xz,-Wn.w);MP=(Jc(mod(TH+0.5*PQ,PQ)-0.5*PQ,vec2(0.5*PQ)-2.*Ha,Ha)>0.);if(!MP)break;}}return MP;}void mainImage(out vec4 RS,in vec2 TD){vec4 HZ,JK,XP,XY,Jg,MC;vec3 AD;vec2 GF,SR,Im,SA,CF,ww,SZ;float JO,Id,Fh,Ul,Hv,Bl,SI,Lv,Uc,OA,Gs,Em,ID,Xq,Dw,UK;int PU,Co;bool Kb;GF=floor(TD);PU=int(GF.x+Xy*GF.y);if(PU>=AQ+CB)discard;\nVJ=iFrame;SR=iResolution.xy;Id=iTime;JO=iDate.w;HZ=iMouse;HZ.xy=HZ.xy/SR-0.5;\nKb=(VJ<=1);Dw=SR.x/SR.y;if(Kb){PQ=80.;Lv=mod(floor(1000.*JO),10000.);Wn=vec4(0.5*PQ+3.,0.,0.,0.);Bl=0.;Hv=0.5;FK=vec3(1.4,Hv,1.5);Jg=vec4(0.);ID=-0.3*Xd;Xq=-0.1*Xd;Em=0.;Im=vec2(0.);JK=HZ;Co=0;Fh=1.;Ha=5.;OA=0.;Uc=0.;}else{XP=Bh(0);JK.xyz=XP.xyz;Co=int(XP.w);XP=Bh(1);FK=XP.xyz;XP=Bh(2);PQ=XP.x;Ha=XP.y;OA=XP.z;Uc=XP.w;XP=Bh(3);ID=XP.x;Xq=XP.y;Im=XP.zw;XP=Bh(4);Em=XP.x;Bl=XP.y;Fh=XP.z;Lv=XP.w;XP=Bh(5);Wn=XP;XP=Bh(6);Jg=XP;}if(PU<AQ){AD=vec3(0.41,-0.32,0.135);if(HZ.z>0.){if(Co==0&&JK.z>0.){ID=-2.*Xd*HZ.x;Xq=-Xd*HZ.y;}else{CF=HZ.xy*vec2(Dw,1.)-AD.xy*vec2(Dw,1.);if(Co==1){Fh=-Id;Im=CF;UK=length(Im);if(UK>0.)Im=min(UK,AD.z)*Im/UK;}else if(JK.z<=0.&&length(CF)<AD.z)Co=1;}}else{Co=0;Im*=vec2(1.-1e-2,1.-2e-3);}Hv=FK.y;++Em;if(Fh>0.){Gs=mod(0.004*Em,4.);Bl=0.04*Xd*NB(0.3,0.7,0.1,mod(Gs,1.))*sign(mod(Gs,2.)-1.)*sign(Gs-2.);SI=0.7*(0.12-0.06*abs(Bl/(0.15*Xd)));ww=vec2(-Bl/(0.15*Xd),SI/0.5);ww=pow(abs(ww),1./vec2(1.5))*sign(ww);Im=ww*AD.z;}else{ww=Im/AD.z;ww=pow(abs(ww),vec2(1.5))*sign(ww);Bl=-0.15*Xd*ww.x;SI=0.2*ww.y*smoothstep(0.01,0.02,abs(ww.y));if(Id+Fh>20.)Fh=1.;}XY=Wn;SA=Wn.xz;MC=vec4(1.);if(abs(Bl)>1e-4){Ul=Wn.w-Bl*SI/Xd;SZ.x=FK.z/asin(Bl);UK=FK.z/SZ.x;SZ.y=SZ.x*sqrt(1.-UK*UK);Wn.xz+=2.*SZ.x*(sin(Wn.w-vec2(0.5*Xd,0.))-sin(Ul-vec2(0.5*Xd,0.)));Wn.w=mod(Ul,2.*Xd);MC+=FK.x*vec4(-1.,1.,-1.,1.)/SZ.xxyy;}else{Wn.xz+=SI*sin(Wn.w+vec2(0.,0.5*Xd));}OA=Ql()?1.:0.;if(OA>0.){Jg+=MC*SI/Hv;if(SI>0.)Uc+=length(Wn.xz-SA);}else{Wn=XY;SI=0.;Uc=0.;}}if(!Kb){if(mod(float(VJ),12.)==0.){if(PU==AQ)XP=vec4(Bh(5).xzw,Id);else if(PU<AQ+CB)XP=Bh(PU-1);}else if(PU>=AQ&&PU<AQ+CB)XP=Bh(PU);}else{XP=vec4(0.,0.,-1.,0.);}if  (PU==0)XP=vec4(HZ.xyz,float(Co));else if(PU==1)XP=vec4(FK,SI);else if(PU==2)XP=vec4(PQ,Ha,OA,Uc);else if(PU==3)XP=vec4(ID,Xq,Im);else if(PU==4)XP=vec4(Em,Bl,Fh,Lv);else if(PU==5)XP=Wn;else if(PU==6)XP=Jg;Yg(PU,XP,RS,TD);}\n",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            }
        ],
        "ver": "0.1"
    }
}