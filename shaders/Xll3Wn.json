{
    "Shader": {
        "info": {
            "date": "1420826241",
            "description": "Although their accomplishments were few the real pride of the institute was their well lit ample parking.",
            "flags": 0,
            "hasliked": 0,
            "id": "Xll3Wn",
            "likes": 18,
            "name": "The Institute",
            "published": 3,
            "tags": [
                "partitions"
            ],
            "usePreview": 0,
            "username": "eiffie",
            "viewed": 1437
        },
        "renderpass": [
            {
                "code": "//The Institute by eiffie\n\n#define time iTime\n#define size iResolution\n#define AUTO_OVERSTEP\n\nfloat px;\nvec4 prp=vec4(0.0);\nvec3 L;\n\nfloat rnd(vec2 c){return fract(sin(dot(vec2(1.317,19.753),c))*413.7972);}\nfloat rndStart(vec2 fragCoord){\n\treturn 0.5+0.5*rnd(fragCoord.xy);\n}\nfloat smin(float a,float b,float k){float h=clamp(0.5+0.5*(b-a)/k,0.0,1.0);return b+h*(a-b-k+k*h);}\nfloat noyz(vec2 p){//value noise - original author??\n\tvec2 c=floor(p),f=fract(p);f=f*f*(3.0-2.0*f);\n\tfloat k=257.0,u=c.x+c.y*k;\n\tvec4 v=vec4(u,u+1.0,u+k,u+k+1.0);v=fract(fract(v*1.23456789)*9.18273645*v);\n\treturn mix(mix(v.x,v.y,f.x),mix(v.z,v.w,f.x),f.y);\n}\nfloat fbm(vec2 p){\n\tvec2 s=sin(p*0.3+2.4*sin(p.yx*0.3));\n\tfloat h=1.0+(s.x+s.y)*0.5,a=0.5;\n\tp+=s.yx*0.66;\n\tfor(int i=0;i<3;i++){\n\t\th+=noyz(p)*a;\n\t\ta*=0.3;p=vec2(p.x+p.y*0.7,p.x-p.y+0.13)*2.0;\n\t}\t\n\treturn h;\n}\nvec3 Sky(vec3 rd){\n\tvec3 col=mix(vec3(0.4,0.2,0.0),vec3(0.5,0.7,0.7),clamp(0.25-0.5*rd.z,0.0,1.0));\n\tcol+=vec3(1.2,1.1,0.9)*pow(max(0.0,dot(rd,L)),100.0);\n\tfloat h=noyz(rd.xy*5.0)*0.5+noyz(vec2(2.0*abs(atan(rd.y,rd.x)),rd.z*20.0));\n\tcol=mix(col,vec3(0.9,0.8,0.6),clamp(h*0.5-0.4,0.0,1.0));\n\treturn mix(vec3(0.1,0.2,0.1),col,clamp((-rd.z+0.05)*20.0,0.0,1.0));\n}\n\nfloat capsule(vec3 p){return length(vec3(p.x,p.y-clamp(p.y,-3.0,10.0),p.z));}\nfloat rcap(vec3 p){return length(vec2(p.x-clamp(p.x,-7.0,7.0),max(abs(p.y),abs(p.z))));}\n\nfloat DE(in vec3 p){\n\tfloat layoutv=(length(p.xy+vec2(8.0,-6.0))-45.0);\n\tlayoutv=smin(layoutv,abs(p.y-28.0+sin(p.x*0.01)*40.0)-5.0,20.0)*0.02;\n\tfloat h=fbm(p.xy*0.1)*10.0*pow(clamp(layoutv,0.0,1.0),0.7),d=-p.z+7.0-h,dG=d;\n\tfor (int n = 0; n < 4; n++) {\n\t\tp=clamp(p, -3.1, 3.1) *2.0-p;\n\t\tp+=vec3(1.9,3.2,8.6);\n\t\tp=p.yzx;\n\t\td=min(d,min(capsule(p)-3.0,rcap(p)-2.0));\n\t}\n\t\n\tif(d<0.25 && d<dG){\n\t\tfloat flr=floor(p.y);\n\t\tfloat rs=1.0+sin(flr)*0.5;\n\t\tp=vec3(rs,1.0,rs)*0.5-abs(mod(p,vec3(rs,1.0,rs))-vec3(rs,1.0,rs)*0.5);\n\t\tfloat d2=d+0.05;\n\t\tif(flr<-rs || rs<0.6)\n\t\t\td=min(d2,max(d,min(p.y,min(p.x,p.z))-0.0125));\n\t\telse if(flr<rs*2.0 || rs<0.75)\n\t\t\td=max(d,min(p.y,min(p.x,p.z))-0.025);\n\t\telse {\n\t\t\td=max(d,min(p.y,max(p.x,p.z))-0.05);\n\t\t\tif(prp.x<0.0)prp=vec4((rs>1.3)?length(p):10.0,0.0,0.0,(max(p.x,p.z)<0.06)?4.0:3.0);\n\t\t}\n\t\tif(prp.x<0.0){\n\t\t\tif(d==d2)prp=vec4(10.0,0.0,0.0,2.0);\n\t\t\telse prp=vec4(10.0,0.0,0.0,3.0);\n\t\t}\n\t}else if(prp.x<0.0)prp=vec4(10.0,h,layoutv,1.0);\n\treturn d;\n}\n\nfloat shadao(vec3 ro, vec3 rd, float px,vec2 fragCoord){//pretty much IQ's SoftShadow\n\tfloat res=1.0,d,t=10.0*px*rndStart(fragCoord);\n\tfor(int i=0;i<12;i++){\n\t\td=max(0.0,DE(ro+rd*t)*1.5);\n\t\tt+=d;\n\t\tres=min(res,d/t);\n\t}\n\treturn res;\n}\n\nvec3 Color(vec3 ro, vec3 rd, float t, vec3 col, bool bFill, vec2 fragCoord){\n\tro+=rd*t;\n\tprp.x=-1.0;\n\tfloat d=DE(ro),spec=0.0,n=noyz(ro.xy*3.0);\n\tvec2 e=vec2(px*t,0.0);\n\tvec3 dn=vec3(DE(ro-e.xyy),DE(ro-e.yxy),DE(ro-e.yyx));\n\tvec3 dp=vec3(DE(ro+e.xyy),DE(ro+e.yxy),DE(ro+e.yyx));\n\tvec3 N=(dp-dn)/(length(dp-vec3(d))+length(vec3(d)-dn));\n\tvec3 R=reflect(rd,N);\n\tvec3 lc=vec3(1.0,0.9,0.8),sc,rc=Sky(R);\n\tif(prp.w<1.5){\n\t\tsc=mix(vec3(0.8,0.8,0.3),vec3(0.2),clamp(abs(abs(ro.y-28.0+sin(ro.x*0.01)*40.0)-0.25)*4.0,0.0,1.0));\n\t\tsc=mix(sc,mix(vec3(0.2,0.3,0.1),vec3(0.6,0.5,0.4),clamp(prp.y*0.05-0.25,0.0,1.0)),clamp(prp.z*100.0,0.0,1.0));\n\t\tspec=0.2;//clamp(2.5-prp.y,0.0,1.0);\n\t\tn*=0.1;\n\t}else if(prp.w<2.5){sc=vec3(0.4,0.5,0.6);spec=1.0;n*=0.3;\n\t}else if(prp.w<3.5){sc=vec3(0.6,0.63,0.62);spec=0.5;n*=0.4;}\n\telse {sc=vec3(0.5,0.5,0.0);spec=0.5;}\n\tsc*=(1.0-n);\n\tfloat sh=clamp(shadao(ro,L,px*t,fragCoord)+0.2,0.0,1.0);\n\tsh=sh*(0.5+0.5*dot(N,L))+exp(-prp.x*5.0);\n\tvec3 scol=sh*lc*(sc+0.5*spec*rc*pow(max(0.0,dot(R,L)),2.0));\n\tif(bFill)d*=0.05;\n\tcol=mix(scol,col,clamp(d/(px*t),0.0,1.0));\n\treturn col;\n}\nmat3 lookat(vec3 fw){\n\tfw=normalize(fw);vec3 rt=normalize(cross(fw,vec3(0.0,0.0,-1.0)));return mat3(rt,cross(rt,fw),fw);\n}\nvec3 cpnt(float t){\n\tif(t<0.5)return vec3(-45.0,30.0,-38.0);\n\tif(t<1.5)return vec3(-20.0,23.0,-25.0);\n\tif(t<2.5)return vec3(-13.0,23.0,-2.5);\n\tif(t<3.5)return vec3(10.0,26.0,-2.5);\n\treturn vec3(12.0,21.0,6.6);\n}\nvec3 path(float t){\n\tfloat t2=t-t*t*0.05;\n\tif(t<10.0)return vec3(-1000.0+t2*200.0,30.0-sin((-1000.0+t2*200.0)*0.01)*40.0,4.25);\n\tt2=time-10.0;\n\tfloat r=60.0-t2;\n\tif(t<25.0)return vec3(-8.0+r*cos(t2*0.3),6.0+r*sin(t2*0.25),-t2*4.0);\n\tif(t<45.0){\n\t\tt2=(t-25.0)/5.0;r=floor(t2);t2=fract(t2);\n\t\treturn mix(cpnt(r),cpnt(r+1.0)-0.25*cpnt(r+2.0)*(1.0-t2),t2);\n\t}\n\tif(t<60.0){\n\t\tt2=t-45.0;\n\t\tt2=t2-t2*t2*0.025;\n\t\tr=500.0-t2*50.0;\n\t\tvec3 p=vec3(cos(t2*0.2)*r,sin(t2*0.2)*r,-30.0);\n\t\tfloat d1=DE(p),d2=DE(p+vec3(0.0,-10.0,0.0));\n\t\tp.z+=(d1+d2)*0.4;\n\t\treturn p;\n\t}\n\treturn vec3(-8.0+cos(t*0.3)*60.0,6.0+60.0*sin(t*0.2),-29.5+sin(t*0.1)*10.0);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tpx=0.5/size.y;\n\tL=normalize(vec3(0.5,0.3,-0.6));\n\tfloat tim=time;\n\tvec3 ro=path(tim);\n\tvec3 ta=path(tim+0.5);\n\tif(tim>10.0 && tim<25.0)ta=vec3(0.0);\n\tif(tim>60.0)ta=vec3(0.0,0.0,-20.0);\n\tvec3 rd=lookat(ta-ro)*normalize(vec3((2.0*fragCoord.xy-size.xy)/size.y,3.0));\n\t//ro=eye*10.0;rd=normalize(dir);\n\tfloat t=DE(ro)*rndStart(fragCoord),d=0.0,od=1.0,step=0.0,os=0.0,pd=10.0;\n\tif(t<0.0){\n\t\tfragColor=vec4(0.0,0.0,0.0,1.0);\n\t\treturn;\n\t}\n\tvec4 edge=vec4(-1.0);\n\tbool bGrab=false;\n\tfor(int i=0;i<78;i++){\n\t\tt+=step;\n\t\td=DE(ro+rd*t);\n#ifdef AUTO_OVERSTEP\n\t\tif(d>=os){\t\t//we have NOT stepped over anything\n\t\t\tos=0.36*d*d/pd;//overstep based on ratio of this step to last\n\t\t\tstep=d+os;\t//add in the overstep\n\t\t\tpd=d;\t\t//save this step length for next calc\n\t\t}else{step=-os;d=0.0001;pd=100000.0;os=0.0;}//remove overstep\n#else\n\t\tstep=d;\n#endif\n\n\t\tif(d>od){\n\t\t\tif(bGrab && od<px*t && edge.x<0.0){\n\t\t\t\tedge=vec4(edge.yzw,t-od);\n\t\t\t\tbGrab=false;\n\t\t\t}\n\t\t}else bGrab=true;\n\t\tod=d;\n\t\tif(t>1000.0 || d<0.00001)break;\n\t}\n\tbool bFill=false;\n\td*=0.05;\n\tif(d<px*t){\n\t\tif(edge.x>0.0)edge=edge.wxyz;\n\t\tedge=vec4(edge.yzw,t);\n\t\tbFill=true;\n\t}\n\tvec3 col=Sky(rd);\n\tfor(int i=0;i<4;i++){\n\t\tif(edge.w>0.0)col=Color(ro,rd,edge.w,col,bFill,fragCoord);\n\t\tedge=edge.wxyz;\n\t\tbFill=false;\n\t}\n\tfloat dimmer=clamp(min(abs(time-10.0),min(abs(time-25.0),min(abs(time-45.0),abs(time-60.0)))),0.0,1.0);\n\tfragColor = vec4(1.5*col*dimmer*dimmer,1.0);\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}