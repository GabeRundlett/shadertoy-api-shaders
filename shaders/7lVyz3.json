{
    "Shader": {
        "info": {
            "date": "1661949928",
            "description": "Screen-space pixels checking their distance to the closest point in 3d space.",
            "flags": 0,
            "hasliked": 0,
            "id": "7lVyz3",
            "likes": 3,
            "name": "Abstract crystals",
            "published": 3,
            "tags": [
                "3d",
                "abstract",
                "distance",
                "perspective"
            ],
            "usePreview": 0,
            "username": "icylavah",
            "viewed": 190
        },
        "renderpass": [
            {
                "code": "// https://gist.github.com/icy-lava/d227da91a1256ab43d0d42093b1271d8\n// point_generator.moon - 100 points\nstruct Point { vec3 pos; vec3 color; };\nPoint points[] = Point[](\n        Point(vec3(-0.56350449741428, -0.47094099812521, 0.23110218386531), vec3(0.78951807025629, 0.52874486142465, 0.3345057682311)),\n        Point(vec3(0.56560977377901, -0.49977267732381, -0.25983021010801), vec3(0.13105054479537, 0.24369378429049, 0.56898755239844)),\n        Point(vec3(-0.062101908140461, 0.086238602291222, -0.62585386835153), vec3(0.52711876360264, 0.40886723657706, 0.1883286366086)),\n        Point(vec3(-0.60018256881268, 0.51596671331407, 0.4098355541758), vec3(0.73952808004072, 0.80096710386691, 0.38031074266251)),\n        Point(vec3(-0.15719610893209, 0.58105231251957, 0.034671846720975), vec3(0.70495394634956, 0.45968501366961, 0.62034162606704)),\n        Point(vec3(0.14854058685591, 0.74371335080931, 0.59965916101419), vec3(0.054002388746694, 0.26644158698752, 0.18016947120704)),\n        Point(vec3(0.029126752766087, -0.57673322895354, -0.53705989561797), vec3(0.39016060910681, -0.095394095410171, 0.15509951530198)),\n        Point(vec3(-0.41386187969739, 0.51052813472895, 0.59591369271636), vec3(0.25482482891291, 0.1391609592075, 0.32817485640601)),\n        Point(vec3(0.66314556412772, 0.0075299932506101, -0.69741758516432), vec3(0.3817747513845, 0.21005634059613, 0.22489143335343)),\n        Point(vec3(0.48911556505964, -0.78807410008602, 0.30810441611929), vec3(0.29681293730234, 0.16402289180575, 0.24330070581846)),\n        Point(vec3(0.57964539363688, 0.63272741359425, -0.20878995523343), vec3(0.02469082143322, 0.23146816380885, 0.1016171557583)),\n        Point(vec3(-0.013900265932766, 0.18795706755113, 0.32952874838521), vec3(-0.047934764933635, 0.22488825879577, -0.24125517537568)),\n        Point(vec3(-0.010803262402436, -0.55625844483999, 0.17992465119292), vec3(0.94914249278237, 0.71747545592635, 1.1243645061067)),\n        Point(vec3(0.27610050970984, 0.47141102412507, -0.032138185402532), vec3(0.36590324504341, 0.69013636019869, 0.81819544001739)),\n        Point(vec3(-0.2998521459182, 0.048155703149464, 0.27071858838149), vec3(0.37739350672261, -0.049570562040314, -0.22497327743498)),\n        Point(vec3(0.37906090142118, -0.58224390338919, 0.70838502999468), vec3(-1.0305732800176, 0.51193814375745, 0.37860833913036)),\n        Point(vec3(0.25022860971083, 0.46685954294579, 0.10107586886663), vec3(0.1650967224815, 0.14267638649143, -0.38793538544577)),\n        Point(vec3(0.27268702214389, -0.72172127554871, 0.17389119521674), vec3(0.32368679873677, 0.29958308415606, 0.071035901294474)),\n        Point(vec3(0.082036059974003, -0.59739946894976, 0.52875993205144), vec3(-0.2884266976858, 0.34162278650264, 0.51510328808097)),\n        Point(vec3(-0.65831793341689, 0.33912615459138, -0.50276384149328), vec3(-0.081642279068456, 0.33824633390468, 0.11481592743715)),\n        Point(vec3(0.32880426706661, 0.42749491413928, 0.14256746412069), vec3(0.075491797236695, 0.68458610480511, 0.71726469420239)),\n        Point(vec3(0.19283195836707, 0.2100429376647, 0.84555697120285), vec3(-1.5477040229303, 0.5327719509351, 0.79079958540605)),\n        Point(vec3(-0.93864597101336, -0.23706878245073, 0.22790368263132), vec3(0.74831368886185, 0.3638340248244, 0.58853076322977)),\n        Point(vec3(-0.48831664155532, 0.58683435833331, -0.20488755102208), vec3(1.0712953024484, 0.66219316404105, 0.724094441042)),\n        Point(vec3(0.35083697205189, 0.45347834432959, 0.69519957729317), vec3(-0.0074912949312643, 0.20310455471875, 0.11711292941524)),\n        Point(vec3(-0.05072764688636, -0.85814817595609, -0.45887155015586), vec3(0.32954855366744, 0.27885257739702, 0.50837552185481)),\n        Point(vec3(0.11510990367839, -0.73337162871782, -0.21737589098291), vec3(-0.55429238091256, 0.91565378682682, 0.64049008059968)),\n        Point(vec3(0.34285730044588, -0.062498740298174, -0.64582712441627), vec3(0.5769426206685, 0.84199370206258, 0.56514178199765)),\n        Point(vec3(-0.78205404505837, -0.35739553672494, 0.49585742567592), vec3(0.48208737158392, 0.59341903677527, 0.76649358446829)),\n        Point(vec3(0.55492065782103, 0.14636673487039, 0.76769786154664), vec3(-0.12037308552199, 0.17950683604641, 0.16642621944054)),\n        Point(vec3(-0.55647787599446, 0.39880129452345, 0.53175443323323), vec3(0.67129611389003, 0.68988732337507, 0.88464345429425)),\n        Point(vec3(0.33230657902006, 0.82649848205525, -0.21362180883999), vec3(0.4902700127776, 0.59498347924453, 0.477173579825)),\n        Point(vec3(0.70504789483934, -0.37495781303046, 0.048817336980411), vec3(0.87001625974906, 0.55363934888351, 0.56614823310291)),\n        Point(vec3(-0.1029093658871, -0.10781224054888, 0.50086854091191), vec3(0.38108378289916, -0.015145902725493, 0.36197647047146)),\n        Point(vec3(-0.68184495231668, 0.4405367966101, -0.44426436300126), vec3(0.63658488995014, 0.31174494427758, 0.43798999717317)),\n        Point(vec3(-0.29086874226438, -0.280615570877, -0.4384592275257), vec3(0.17097891314477, 0.31212455702216, 0.055050108595554)),\n        Point(vec3(-0.24629753888963, 0.26337177600556, 0.22769005210134), vec3(0.39840261300821, 0.40505078346746, -0.10438139496792)),\n        Point(vec3(0.79872758099016, -0.53189691366391, 0.070258449798114), vec3(0.31090863429809, 0.75132013616448, 0.91990329909757)),\n        Point(vec3(0.37373357840086, -0.59205487331253, -0.17790531161919), vec3(0.37534596433227, 0.49389419753704, 0.74067088884418)),\n        Point(vec3(-0.77777320140852, 0.20212566835454, -0.19890114448794), vec3(0.74258771402205, 0.76206304895319, 0.55519804672537)),\n        Point(vec3(-0.39955729357465, 0.05010948514257, -0.11083318295704), vec3(-1.1593981919248, 0.59039488452126, 0.40129978541933)),\n        Point(vec3(-0.90558302696935, -0.27985682798402, 0.13480574634408), vec3(0.2566267352765, 0.35653212124245, 0.63925339241042)),\n        Point(vec3(-0.65929601191446, 0.34810083109616, -0.074360561194972), vec3(0.35395949912804, 0.19935578037441, 0.18503101403084)),\n        Point(vec3(0.20100256145331, -0.010914226945715, 0.71864712809086), vec3(0.63941940393948, 0.76150945314267, 1.1646308192556)),\n        Point(vec3(0.27539418270716, -0.77669811759915, 0.090461988759145), vec3(-0.60451335806098, 0.45079887128485, 0.70498361669943)),\n        Point(vec3(0.1636987274619, 0.62311432965205, 0.0026178398043921), vec3(-3.215915013796, 0.61011457357103, 0.81825035848035)),\n        Point(vec3(-0.68478285792643, -0.27424328285401, -0.13986798128387), vec3(-0.14460497455492, 0.32852141367727, 0.31506055547241)),\n        Point(vec3(0.22879938586522, 0.25874673402278, 0.062176094829307), vec3(0.31542654418823, 0.33428857030516, 0.19996206903691)),\n        Point(vec3(0.55806876882053, -0.051137247831866, 0.17694378611614), vec3(-0.071738695288467, 0.29431530802514, 0.46392155057171)),\n        Point(vec3(0.49457915894443, 0.35951448013153, -0.083222656397495), vec3(-0.23015969546125, 0.12749178256953, 0.38403754189072)),\n        Point(vec3(0.13762881384502, 0.84858103053932, -0.1745287561024), vec3(0.34976019380646, 0.70321334994259, 0.93839986083806)),\n        Point(vec3(0.53893353604967, -0.68762078176561, 0.43489201483596), vec3(0.85276748991143, 0.51818929456308, 0.64387090292672)),\n        Point(vec3(-0.59572579455079, -0.099617876340869, 0.69537458775173), vec3(0.26905357493514, -0.10275689623515, 0.38402034341339)),\n        Point(vec3(-0.27762083149077, 0.0069917255551575, 0.13268686774067), vec3(0.74899731956851, 0.74470000416951, 0.26807692633356)),\n        Point(vec3(-0.018483129045372, -0.090465759969036, 0.9597763201709), vec3(0.19307141057031, 0.18896675588941, 0.4634618393036)),\n        Point(vec3(-0.91635447737296, 0.04545698666659, 0.26630661680286), vec3(0.36050413490863, 0.015893618169417, 0.15992899844277)),\n        Point(vec3(0.52763157571094, 0.63164702637059, -0.16217661764298), vec3(0.59350555452792, 0.11477528401774, 0.56733715054939)),\n        Point(vec3(-0.68707006255641, -0.25466949059216, 0.34947542063697), vec3(-0.21663230069288, 0.28814848222702, 0.32489590917772)),\n        Point(vec3(-0.18828797919464, -0.66269178238178, 0.59700319571279), vec3(0.94590342615591, 0.59822143229815, 0.3708649938505)),\n        Point(vec3(0.68336058898159, -0.4366542972357, 0.1766004936977), vec3(0.17829482752497, 0.049852045654475, 0.26494233799621)),\n        Point(vec3(-0.36957080512193, -0.039957680420482, 0.9277275470803), vec3(0.32517155511695, -0.055644200610892, 0.44787247943984)),\n        Point(vec3(-0.54032860991892, -0.44130731501059, -0.31949505577679), vec3(0.73860021106794, 0.090604756384555, 0.29563633062664)),\n        Point(vec3(-0.042104503754474, 0.097077282578772, -0.14417415775279), vec3(0.84444229322477, 0.6232217843739, 1.1021640115232)),\n        Point(vec3(0.66019087582928, -0.059597683244236, 0.67441496816924), vec3(0.51329075984833, 0.47200961539457, 0.10893617303932)),\n        Point(vec3(-0.79673969250608, 0.17889639929811, -0.52167689305842), vec3(0.33639268981234, 0.18046494653741, -0.21997357708025)),\n        Point(vec3(0.87693683639702, -0.23559772888102, -0.21236156773653), vec3(0.54334195316039, 0.096329005069747, 0.54740598477334)),\n        Point(vec3(0.46798454940963, 0.53044754124634, 0.45934072939309), vec3(-0.1202783431291, 0.16250698452411, 0.22968355959774)),\n        Point(vec3(0.42187858081211, 0.41229943007125, -0.12872772361977), vec3(-1.4218865577237, 0.5084049962649, 0.52789134056906)),\n        Point(vec3(0.59418672902315, -0.54620924672872, -0.01011000313802), vec3(0.060720167719088, 0.17473378522833, -0.071851975806708)),\n        Point(vec3(-0.27753370661254, -0.82221459888782, 0.11890307593737), vec3(0.89847987394748, 0.572992660791, 0.5727778964196)),\n        Point(vec3(-0.91849165109434, 0.017489398266555, 0.11028119655097), vec3(-0.74622385360933, 0.97458339615597, 0.75090254691868)),\n        Point(vec3(-0.17709403891634, 0.61141565810431, 0.17176362593748), vec3(-0.20813347253477, 0.17107268037307, -0.043900837585692)),\n        Point(vec3(0.11588016289867, 0.12912412403947, 0.65628280776171), vec3(0.27682578965001, 0.25612693190801, -0.083747589912556)),\n        Point(vec3(-0.1800012946084, -0.64240121389569, -0.52811189899337), vec3(0.18101107202813, 0.29238609721073, -0.17778872091026)),\n        Point(vec3(0.046311839229286, -0.059576127601519, -0.6042218046828), vec3(0.28748824757268, 0.083783706072424, 0.30304262565273)),\n        Point(vec3(-0.2645977515418, -0.21242667831488, -0.38410849971878), vec3(0.45558387566108, 0.54663062790831, 0.32619131886992)),\n        Point(vec3(0.39332075358377, 0.8079955859113, -0.23851239838696), vec3(-0.093881709550139, 0.16767153946513, 0.3549155315656)),\n        Point(vec3(-0.17619830778956, -0.15443051296807, 0.46530699172065), vec3(0.45516958241061, -0.1674021285857, 0.27824178537136)),\n        Point(vec3(-0.45828703029937, -0.12156325661146, -0.49218653566472), vec3(-1.3445628469842, 0.29880945868888, 0.48266315219836)),\n        Point(vec3(-0.71737575610565, -0.36898820409159, 0.39308737695097), vec3(0.14234531277761, 0.15949620529702, -0.062687774062848)),\n        Point(vec3(0.41994310552923, -0.73079411347116, 0.33071671375141), vec3(0.25033680497999, 0.086061537104298, -0.44696021401026)),\n        Point(vec3(0.09746523964758, 0.27710878549662, -0.53194645180446), vec3(0.14588416661591, 0.059459916605787, 0.47058635713556)),\n        Point(vec3(-0.2935634784412, -0.15251945294153, -0.6467427108128), vec3(0.47525163351657, 0.84242287513117, 0.91395603045132)),\n        Point(vec3(-0.67722452325758, 0.18837245774342, 0.47601692398526), vec3(0.73708884678981, 0.46377105641691, 0.18617568440082)),\n        Point(vec3(-0.59500028601159, -0.25373197125202, 0.0048260688565462), vec3(-0.12150514552962, 0.38004739402931, 0.33808039861939)),\n        Point(vec3(0.24238076570898, -0.8450317167031, 0.25471214017605), vec3(-0.081072996737368, 0.50526586338698, 0.29018343786057)),\n        Point(vec3(-0.2855565853411, -0.84135900571213, 0.27680917638163), vec3(1.0442668707984, 0.79179066723702, 0.60343443564808)),\n        Point(vec3(-0.83444271669088, 0.36002771362898, -0.39043000642562), vec3(0.2139966003838, 0.55817226824936, 0.64364872069446)),\n        Point(vec3(-0.44584842010736, 0.097591559779286, 0.068403971950147), vec3(-0.0076513297639158, 0.82702131415726, 0.71279867702016)),        \n        Point(vec3(-0.16254019052522, -0.51230724728261, 0.3511198761761), vec3(0.45173249743036, 0.23131740153786, -0.23705175630093)),\n        Point(vec3(-0.09072466741967, -0.78284510901248, 0.046863271697854), vec3(-1.5084674562619, 0.48770052611082, 0.89189780409258)),\n        Point(vec3(0.45710801444265, 0.43299949951969, 0.49442059557907), vec3(0.92188427934439, 0.65683852049455, 0.446496582264)),\n        Point(vec3(0.048042757414192, 0.10498239894514, -0.97815786819063), vec3(1.1611256003835, 0.62379374775914, 0.7481832961767)),\n        Point(vec3(-0.71835048645704, -0.2836592050796, 0.25857211606417), vec3(0.49408141012653, 0.037834922365928, 0.36975237082006)),\n        Point(vec3(0.007899239800051, -0.12347195390497, 0.86527974792464), vec3(0.42447797333823, 0.61218879141794, 1.0635626579192)),\n        Point(vec3(0.11783411591915, -0.51428224469093, -0.18777264946077), vec3(0.85357468041629, 0.63383966688733, 0.17570665178474)),\n        Point(vec3(0.057137701263305, -0.28954692812907, 0.81316979311207), vec3(1.2325367320365, 0.68363638057909, 0.70641457995251)),\n        Point(vec3(0.10131868864176, 0.13367001924023, 0.79234924560498), vec3(0.28634087728214, 0.16623586320647, 0.34391859609493)),\n        Point(vec3(0.10634865746467, -0.48469720793753, 0.020476303464279), vec3(0.54840974041513, 0.61005295154415, 0.44642469502501)),\n        Point(vec3(0.16742128348339, 0.4754238820094, 0.45103050631994), vec3(0.14709625877695, 0.543346355913, 0.60095968900077))\n);\n\n#define getPointCount() points.length()\n#define getPoint(i) points[i]\n\n#define TAU 6.28318530717958647693\n\n#define PI_DIV_360 0.00872664625997164788\nmat4 buildPerspectiveMatrix(float fov, float aspect, float n, float f) {\n    float scale = tan(fov * PI_DIV_360) * n;\n    float r = aspect * scale;\n    float l = -r;\n    float t = scale;\n    float b = -t;\n    \n    return mat4(\n        2.0 * n / (r - l), 0.0, 0.0, 0.0,\n        0.0, 2.0 * n / (t - b), 0.0, 0.0,\n        (r + l) / (r - l), (t + b) / (t - b), -(f + n) / (f - n), -1.0,\n        0.0, 0.0, -2.0 * f * n / (f - n), 0.0\n    );\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = (fragCoord - iResolution.xy / 2.0) / iResolution.y * vec2(2.0, -2.0);\n    \n    mat4 perspectiveMatrix = buildPerspectiveMatrix(100.0, 1.0, 1e-2, 1e2);\n    float minDist2 = 1e9;\n    vec3 minColor;\n    for(int i = 0; i < getPointCount(); i++) {\n        vec3 point = getPoint(i).pos;\n        float pointAngle = atan(point.z, point.x);\n        pointAngle += iTime * TAU / 12.0;\n        point = vec3(cos(pointAngle), point.y, sin(pointAngle));\n        point -= vec3(0.0, 0.0, 1.3);\n        \n        vec4 pos = perspectiveMatrix * vec4(point, 1.0);\n        point = pos.xyz / pos.w;\n        \n        if (point.z < 0.0) continue;\n        \n        #if 1\n        vec3 mag = point.xyz - vec3(uv, 0.0);\n        #else\n        vec2 mag = point.xy - uv;\n        #endif\n        \n        float len2 = dot(mag, mag);\n        \n        #if 0\n        if(len2 < 1.0) {\n            fragColor = vec4(getPoint(i).color, 1.0);\n            return;\n        }\n        #else\n        if (len2 < minDist2) {\n            minDist2 = len2;\n            minColor = getPoint(i).color;\n        }\n        #endif\n    }\n    \n    // Output to screen\n    fragColor = vec4(minColor, 1.0);\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}