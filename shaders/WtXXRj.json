{
    "Shader": {
        "info": {
            "date": "1563467961",
            "description": "Web GL port of Dopamine 4K Intro released at Revision 2019 demoparty\nhttp://www.pouet.net/prod.php?which=81024",
            "flags": 32,
            "hasliked": 0,
            "id": "WtXXRj",
            "likes": 22,
            "name": "Dopamine (4k Intro port)",
            "published": 3,
            "tags": [
                "sdf",
                "intro",
                "4k",
                "3draymarching",
                "revision",
                "ballon",
                "klos"
            ],
            "usePreview": 0,
            "username": "spolsh",
            "viewed": 816
        },
        "renderpass": [
            {
                "code": "#define Y iChannel0\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = vec4(0); // mac fix\n        \n    y=150.0*fract(2.0*iTime/150.0);\n\tif (iMouse.xy==vec2(0) && iFrame==0) // fix white miniature still on fade in\n   \t\ty=PREVIEW_TIME;\n    \n\tvec2 z;\n\tfloat e=1.5*P(2.,4.,y),\t\t\t\t\t\t\t\t\t\t\t\t// impulse looped, see P in Common\n\t\t  t=1.+e,\t\t\t\t\t\t\t\t\t\t\t\t\t\t// impulse scaled for flash\n\t\t  o=.1+e,\t\t\t\t\t\t\t\t\t\t\t\t\t\t// impulse scaled for aberration\n\t\t  c=1.,\n\t\t  r=1.,\n\t\t  n=1.,\n\t\t  d=.0625;\n    \n\tif(step(abs(M.y)*2.39,R.x/R.y)<.5)\t\t\t\t\t\t\t\t\t// letterbox\n\t\treturn;\n    \n\tvec3 u=s.xxx;\t\t\t\t\t\t\t\t\t\t\t\t\t\t// init color to white\n    \n\tfor(float w=0.;w<16.;w++)\t\t\t\t\t\t\t\t\t\t\t// chromatic aberration loop\n\t\tz=16.*(.2+dot(M,M))*p(100.*M+y+10.*w)/R.xy,\t\t\t\t\t\t// focus jitter\n\t\tu.x+=d*texture(Y,W(.5-.5*((M+z)*-c))).x,\t\t\t\t\t\t\n\t\tu.y+=d*texture(Y,W(.5-.5*((M+z)*-r))).y,\n\t\tu.z+=d*texture(Y,W(.5-.5*((M+z)*-n))).z,\n\t\tc*=mix(1.,.997,o),\n\t\tr*=mix(1.,.998,o),\n\t\tn/=mix(1.,.998,o);\n    \n\tu*=.4+.6*W(pow(1.5*dot(M,M),-2.));\t\t\t\t\t\t\t\t\t// vignette    \n    u=t*smoothstep(0.,1.,(u*vec3(.8,.8,1.)-vec3(-.05))/(vec3(1.35)));\t// grade\n    u=u*(2.51*u+.03)/(u*(2.43*u+.59)+.14);\t\t\t\t\t\t\t\t// ACES tonemapper\n    u*=.9+.1*p(100.*M+y).x;\t\t\t\t\t\t\t\t\t\t\t\t// grain\n\tu=mix(s.yyy,u,smoothstep(0.,1.,(y-3.)/22.));\t\t\t\t\t\t// fade in\n\tu=mix(s.yyy,u,smoothstep(0.,1.,(y-153.)/-25.));\t\t\t\t\t\t// fade out\t\n    f.xyz=pow(u,vec3(1./2.2));\t\t\t\t\t\t\t\t\t\t\t// gamma\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "// enable on powerful machines\n// #define FULL_GEO\n\n// play in range [1.0, 20.0], default was 4.0, 20.0 is cool but perf heavy\n#define REFLECTION_DIST 5.\n\n#define PREVIEW_TIME 47.0\n\n#define F gl_FragCoord\n#define R iResolution\n#define M (F.xy/R.xy*2.-1.)\n#define f fragColor\n#define W(X)clamp(X,0.,1.)\nfloat y;\nvec3 s=vec3(0.,1.,-1.);\nvec2 p(vec2 x)\n{\n\tx=vec2(dot(x,vec2(127.1,311.7)),\n\t\t   dot(x,vec2(269.5,183.3)));\n\treturn fract(sin(x)*43758.5453123);\n}\nfloat p(float v,float x)\n{\n\tfloat z=v*x;\n  \treturn z*exp(1.-z);\n}\nfloat P(float v,float e,float x)\n{\n\treturn step(44.,x)*p(v,max(0.,mod(x-1.,11.25))*e);\n}",
                "description": "",
                "inputs": [],
                "name": "Common",
                "outputs": [],
                "type": "common"
            },
            {
                "code": " vec3 I=normalize(vec3(.8,1.1,-.2));\n vec3 p(float y,vec3 x,vec3 v,vec3 m,vec3 z)\n {\n   return x+v*cos(6.28318*(m*y+z));\n }\n mat2 t(float v)\n {\n   float y=sin(v),f=cos(v);\n   return mat2(f,-y,y,f);\n }\n vec2 t(vec2 y,vec2 v)\n {\n   return y.x<v.x?y:v;\n }\n vec2 r(inout vec2 v,vec2 y)\n {\n   vec2 x=floor((v+y*.5)/y);\n   v=mod(v+y*.5,y)-y*.5;\n   return x;\n }\n float p(vec3 y,vec3 x,vec3 v,float z)\n {\n   vec3 m=y-x;\n   vec3 f=v-x;\n   float l=W(dot(m,f)/dot(f,f));\n   return length(m-f*l)-z;\n }\n\n float n(vec3 v,vec3 y)\n {\n   vec2 f=vec2(length(v.xz),v.y);\n   float m=-f.y-y.z,z=max(dot(f,y.xy),f.y);\n   return length(max(vec2(m,z),0.))+min(max(m,z),0.);\n }\n float h(vec3 v,vec3 y)\n {\n   vec3 f=abs(v)-y;\n   return min(max(f.x,max(f.y,f.z)),0.)+length(max(f,0.));\n }\n vec2 g(vec3 v)\n {\n   v-=vec3(0.,.4,.5);\n   float b=floor((v.x+2.5)/5.);\n   v.x=mod(v.x+2.5,5.)-2.5;\n   v.z-=.4-3.5*mod(b,2.);\n   v.x-=1.;\n   \n   float x=mod(y+11.25*(b-1.)+22.5,45.)-22.5;\n   vec3 f=vec3(-.5,-2.7,.7);\n   float m=x-10.;\n   \n   vec2 i=vec2(h(v,vec3(.4))-.005,2.);\n   float r=.24*max(0.,x),W=2.5*max(0.,x-1.);\n   v.x+=r;\n   vec3 c=v-.4*s.xyx;\n   c.xy-=mix(vec2(min(r,1.),0.),0.2*s.yy,step(1.,r));\n   float g=p(2.,max(0.,r-1.)*2.);\n   c.x+=g;\n   float z=p(2.,W);\n   v.x-=.5*p(2.,W);\n   v.y-=smoothstep(0.,1.,r-1.);\n   v-=2.*s.xyx;\n   float o=smoothstep(0.,1.,W(.25*m));\n   v-=mix(s.xxx,f,o);\n   c-=mix(s.xxx,f,o);\n   \n   if(o<.6)\n     {\n\t   vec3 e=v;\n\t   v.xy*=t(g+z-.5*r*(1.-step(1.,r)));\n       i=t(i,vec2(min(mix(p(v,s.xxx,.5*s.xyx,.2),length(v-.5*s.xyx)-.5,.6),length(v+vec3(-.05,.07,.05))-.04),3.));\n       i=t(i,vec2(p(c,s.xxx,c-e,.005),2.));\n     }\n   return i;\n }\n vec2 h(vec3 v)\n {\n   vec2 f=vec2(v.y,0.);\n   vec3 m=v-vec3(0.,.35,-1.);\n   vec2 y=r(m.xz,4.5*s.yy);\n#ifdef FULL_GEO\n   for(float x=0.;x<12.;x+=1.)\n#else       \n   for(float x=0.;x<6.;x+=1.)\n#endif       \n     {\n       vec2 z=p(y+x)*2.-1.;\n       vec3 i=m;\n       i.xz*=t(-.4*z.y);\n       i.zx-=.2*sign(z)+z;\n       i.xz*=t(.2*z.x);\n       f=t(f,vec2(h(i,vec3(.2+.1*z.x,2.5+z.x,.2+.1*z.y))-.005,2.));\n     }\n   vec3 i=v-vec3(-6.,1.75,-.1);\n   i.x=-i.x;\n   i.y=-i.y;\n   i=i.xzy;\n   r(i.xy,1.5*s.yy);\n   vec3 x=vec3(i.x,-i.z,i.y)-s.xyx,z=abs(i);\n   vec2 l=vec2(.05,1.8);\n   float a=max(z.z-l.y,max(z.x*.866025+.5*z.y,z.y)-l.x);\n   f=t(f,vec2(max(a,n(x,vec3(1.,.15,3.)))-.0025,0.));\n   // if(abs(v.z)<1.)\n\tf=t(f,g(v));\n   return f;\n }\n vec2 r(vec3 v,vec3 y,float m,float x)\n {\n   float f=m,i=-1.;\n   for(int z=0;z<64;z++)\n     {\n       vec2 s=h(v+y*f);\n       if(s.x<.0004*f||f>x)\n         break;\n       f+=s.x;\n       i=s.y;\n     }\n   if(f>x)\n     i=-1.;\n   return vec2(f,i);\n }\n vec3 n(vec3 v)\n {\n   vec3 f=s.xxx;\n   for(int i=0;i<4;i++)\n     {\n       vec3 y=.5773*(2.*vec3(i+3>>1&1,i>>1&1,i&1)-1.);\n       f+=y*h(v+.0005*y).x;\n     }\n   return normalize(f);\n }\n float e(vec3 y,vec3 v)\n {\n   float f=0.,i=1.;\n   for(int m=0;m<5;m++)\n     {\n       float x=.01+.12*float(m)/4.;\n       vec3 z=v*x+y;\n       float l=h(z).x;\n       f+=-(l-x)*i;\n       i*=.95;\n     }\n   return W(1.-3.*f);\n }\n float c(vec3 v,vec3 y)\n {\n   float f=1.,i=.1;\n   for(int x=0;x<16;x++)\n     {\n       float m=h(v+y*i).x;\n       f=min(f,8.*m/i);\n       i+=clamp(m,.02,.1);\n       if(f<.005||i>15.)\n         break;\n     }\n   return W(f);\n }\n vec4 c(vec3 v,vec3 f,vec3 m,float x,float z)\n {\n   vec3 a=p(.3*y-.1*v.y+.01*v.x-.35,vec3(.8,.5,.4),vec3(.2,.4,.2),vec3(2.,1.,1.),.25*s.xyy),\n    \tn=mix(s.yyy,2.0*a,P(4.,.1,y)),\n\t   \td=x>0.?vec3(.1):n*step(v.y,2.6);\n   d=x>1.?s.xxx:d;\n   d=x>2.?vec3(.7,.2,.2):d;\n   vec2 c=smoothstep(0.,1.,(abs(fract(.5*v.xz)*2.-1.)-.01)/.025);\n   d=mix(d,mix(vec3(.02),d,min(c.x,c.y)),step(v.y,.01));\n   vec3 w=reflect(m,f),\n\t\to=normalize(I-m);\n   float h=e(v,f),\n\t\t t=pow(W(1.+dot(f,m)),2.),\n\t\t u=W(dot(f,I)),\n\t\t g=W(f.y*.5+.5),\n\t\t b=pow(W(dot(f,o)),16.)*u*(.04+.96*pow(W(1.+dot(o,m)),5.));\n   vec4 k=vec4((h*.5+.5)*(g*.2+.9*d*z*(b*x*20.+u+t*2.)),(step(v.y,.01)+x*.4)*.4*(1.-t));\n   k.xyz+=.1*pow(W(1.-.1*v.y),16.)*n;\n   return k;\n }\n vec3 w(vec3 v,vec3 f)\n {\n   vec4 y=s.yyyy;\n   vec2 z=r(v,f,1.,25.);\n   if(z.y>-.5)\n     {\n       vec3 x=v+z.x*f,l=n(x);\n       l.xz+=.008*p(M);\n       l=normalize(l);       \n       vec3 d=reflect(f,l);\n       float o=c(x,I)*.7+.3;       \n       // vec2 a=r(x,d,.01,4.); \n       vec2 a=r(x,d,.01,REFLECTION_DIST);\n       vec3 w=x+a.x*d;\n       vec4 k=c(w,n(w),d,a.y,1.);\n       y=c(x,l,f,z.y,o);\n\t   // y.xyz=mix(y.xyz,k.xyz,y.w*W(1.-a.x/4.));\n       y.xyz=mix(y.xyz,k.xyz,y.w*W(1.-a.x/REFLECTION_DIST));\n       // y.xyz=z.y>2.?y.xyz:mix(y.xyz,s.yyy,1.-exp(-.0002*pow(z.x,3.)));\n     }\n   return W(y).xyz;\n }\n\n void mainImage( out vec4 fragColor, in vec2 fragCoord )\n {\n    fragColor = vec4(0); // mac fix\n     \n    y=150.0*fract(2.0*iTime/150.0);\n\tif (iMouse.xy==vec2(0) && iFrame==0) // fix white miniature still on fade in\n   \t\ty=PREVIEW_TIME;\n    \n\tvec2 z=M;    \n\tz.x*=R.x/R.y;\n\n\tfloat l=mix(17.,1.5,smoothstep(0.,1.,(y-3.)/22.)),\n\t      C=step(abs(z.y)*2.35,R.x/R.y),\n\t\t  u=y-20.;\n    \n\tif(C<.5)\n     return;\n\n\tvec3 a=vec3(2.,7.,-2.5)+(.245*y+.0015*u*u)*s.zxx,\n\t\td=vec3(a.x-mix(10.,5.,smoothstep(0.,1.,(y-153.)/-25.)),1.,.5),\n\t\to=normalize(d-a),\n\t\tr=cross(o,vec3(0.,1.,0.)),\n\t\tn=cross(r,o);\n\n   mat3 c=mat3(r,n,o);\n   vec3 k=c*normalize(vec3(z,l));\n   f.xyz=w(a,k);\n }",
                "description": "",
                "inputs": [],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            }
        ],
        "ver": "0.1"
    }
}