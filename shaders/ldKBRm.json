{
    "Shader": {
        "info": {
            "date": "1528152551",
            "description": "More fun with image fitting. See [url]https://mzucker.github.io/2018/04/27/image-fitting-tensorflow-rewrite.html[/url]",
            "flags": 0,
            "hasliked": 0,
            "id": "ldKBRm",
            "likes": 36,
            "name": "Einstein",
            "published": 3,
            "tags": [
                "genetic",
                "photo",
                "image",
                "gabor",
                "basis",
                "notreallygenetic",
                "wavelet"
            ],
            "usePreview": 1,
            "username": "mattz",
            "viewed": 1833
        },
        "renderpass": [
            {
                "code": "/* Einstein, by mattz.\n   License: Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n\n   Displaying Albert Einstein using 128 Gabor functions.\n\n   Similar to https://www.shadertoy.com/view/4ljSRR but computed in under 30 min\n   using TensorFlow.\n\n   Composition looks a little odd here because the approximation was computed\n   on a square domain.\n\n   See https://mzucker.github.io/2018/04/27/image-fitting-tensorflow-rewrite.html\n\n*/\n\n// Hash functions from Dave Hoskins https://www.shadertoy.com/view/4djSRW\n\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\n#define HASHSCALE4 vec4(.1031, .1030, .0973, .1099)\n\nfloat hash12(vec2 p) {\n\tvec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvec4 hash41(float p) {\n\tvec4 p4 = fract(vec4(p) * HASHSCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n    \n}\n\n\nconst vec4 scl = vec4(0.00391389432485, 0.0122958616579, 0.00782778864971, 0.00391389432485);\n\nfloat cnt = 0.0;\n\nfloat gabor(vec2 p, vec4 q) {\n    \n    // Here we decode the vec4 q into 8 individual parameters:\n    //\n    //   q0 = (x, a, l, s)\n    //   q1 = (y, p, t, h)\n    //\n    // with parameters given by\n    //\n    //   x: function center x coordinate\n    //   y: function center y coordinate\n    //   a: Gabor function spatial angle/orientation\n    //   p: Gabor function phase offset\n    //   l: Spatial wavelength\n    //   s: Filter width perpendicular to sinusoidal component \n    //   t: Filter width parallel to sinusoidal component\n    //   h: Amplitude\n    //\n    vec4 q0 = floor(q*0.001953125)*scl;\n    vec4 q1 = mod(q, 512.0)*scl;     \n    \n    vec4 rnd = hash41(cnt) * 2.0 - 1.0;\n    cnt += 1.0;\n    \n    float fadein = smoothstep(6.0, 0.0, iTime);\n    \n    float theta = q0.y + 3.14*fadein*rnd.z;\n    vec2 p0 = 2.*vec2(q0.x, q1.x);\n    \n    p0 += 4.0 * rnd.xy * fadein;\n            \n    float cr = cos(theta);\n    float sr = sin(theta);\n        \n    vec2 st = vec2(q0.w, q1.z);\n\n    // Rotate and translate point\n    p = mat2(cr, -sr, sr, cr) * (p - p0);    \n        \t\n    // Handle appearing at the start of filter\n    q1.w *= (1.0 - fadein);\n\n    // amplitude * gaussian * sinusoid\n    return q1.w * exp(dot(vec2(-0.5), p*p/(st*st))) * cos(p.x*6.2831853/q0.z+q1.y + 10.0*rnd.w*fadein);\n    \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n        \n\tvec2 p = (fragCoord.xy - 0.5*iResolution.xy) * 1.2 / iResolution.y;\n    p.y = -p.y;\n    p *= 1.3;\n    p += vec2(2.25, 2.125);\n    \n    float k = 0.0;\n\n    k += gabor(p, vec4(124724.,215881.,131766.,131835.));\n    k += gabor(p, vec4(157335.,242926.,133491.,50545.));\n    k += gabor(p, vec4(79180.,164856.,102511.,45240.));\n    k += gabor(p, vec4(128164.,208372.,32295.,14847.));\n    k += gabor(p, vec4(161603.,121737.,19480.,16383.));\n    k += gabor(p, vec4(112925.,108280.,37965.,10045.));\n    k += gabor(p, vec4(116484.,37759.,58372.,4095.));\n    k += gabor(p, vec4(117040.,136266.,30216.,2768.));\n    k += gabor(p, vec4(149330.,22112.,11275.,7167.));\n    k += gabor(p, vec4(97650.,95376.,30225.,3583.));\n    k += gabor(p, vec4(16554.,75246.,43600.,43777.));\n    k += gabor(p, vec4(104668.,12938.,49778.,50104.));\n    k += gabor(p, vec4(151320.,106537.,15905.,4219.));\n    k += gabor(p, vec4(145228.,199047.,10767.,7993.));\n    k += gabor(p, vec4(132862.,191440.,13414.,12818.));\n    k += gabor(p, vec4(144690.,230672.,15915.,16000.));\n    k += gabor(p, vec4(92969.,142615.,32272.,10751.));\n    k += gabor(p, vec4(172976.,132391.,59222.,54385.));\n    k += gabor(p, vec4(148733.,142297.,5643.,5673.));\n    k += gabor(p, vec4(131319.,80734.,50192.,5119.));\n    k += gabor(p, vec4(79581.,88402.,40249.,40058.));\n    k += gabor(p, vec4(142090.,252814.,26121.,5119.));\n    k += gabor(p, vec4(97433.,37328.,6685.,5695.));\n    k += gabor(p, vec4(118095.,251126.,52442.,28242.));\n    k += gabor(p, vec4(156321.,201765.,57349.,3871.));\n    k += gabor(p, vec4(93450.,137060.,25094.,3071.));\n    k += gabor(p, vec4(95024.,140723.,33291.,11238.));\n    k += gabor(p, vec4(171226.,104879.,30763.,9727.));\n    k += gabor(p, vec4(95045.,156071.,32272.,4410.));\n    k += gabor(p, vec4(157009.,79495.,11317.,11006.));\n    k += gabor(p, vec4(153981.,217841.,66573.,4353.));\n    k += gabor(p, vec4(167101.,220097.,5127.,2422.));\n    k += gabor(p, vec4(104712.,14852.,41267.,40028.));\n    k += gabor(p, vec4(133931.,236155.,19502.,9513.));\n    k += gabor(p, vec4(164634.,38530.,25765.,21756.));\n    k += gabor(p, vec4(154428.,27222.,23571.,7679.));\n    k += gabor(p, vec4(150863.,23444.,12820.,6143.));\n    k += gabor(p, vec4(197858.,128865.,129789.,45264.));\n    k += gabor(p, vec4(148779.,169165.,3586.,2229.));\n    k += gabor(p, vec4(165122.,259066.,103437.,7679.));\n    k += gabor(p, vec4(159953.,115785.,20002.,7006.));\n    k += gabor(p, vec4(117956.,144873.,63076.,53621.));\n    k += gabor(p, vec4(88239.,200150.,3077.,2143.));\n    k += gabor(p, vec4(122622.,153014.,4615.,2164.));\n    k += gabor(p, vec4(166074.,222981.,5636.,3071.));\n    k += gabor(p, vec4(153847.,72401.,25607.,7167.));\n    k += gabor(p, vec4(126771.,227567.,19498.,14687.));\n    k += gabor(p, vec4(123565.,76676.,23072.,20198.));\n    k += gabor(p, vec4(101112.,137890.,25112.,8468.));\n    k += gabor(p, vec4(149268.,57165.,240426.,38474.));\n    k += gabor(p, vec4(188151.,43938.,26805.,23788.));\n    k += gabor(p, vec4(130308.,193167.,12808.,2559.));\n    k += gabor(p, vec4(133373.,97521.,3589.,3703.));\n    k += gabor(p, vec4(153386.,240392.,4102.,2717.));\n    k += gabor(p, vec4(145218.,199502.,14867.,14148.));\n    k += gabor(p, vec4(106852.,92914.,45618.,45797.));\n    k += gabor(p, vec4(152887.,157952.,75786.,5073.));\n    k += gabor(p, vec4(114401.,246545.,75287.,5339.));\n    k += gabor(p, vec4(177371.,238705.,5657.,4095.));\n    k += gabor(p, vec4(103673.,128146.,38408.,4607.));\n    k += gabor(p, vec4(132387.,163212.,5130.,2165.));\n    k += gabor(p, vec4(154873.,80355.,8197.,3071.));\n    k += gabor(p, vec4(151350.,199037.,43041.,5469.));\n    k += gabor(p, vec4(186593.,107970.,111627.,7344.));\n    k += gabor(p, vec4(18063.,119220.,179929.,147663.));\n    k += gabor(p, vec4(159436.,116040.,26135.,6655.));\n    k += gabor(p, vec4(185097.,214574.,28208.,28520.));\n    k += gabor(p, vec4(145711.,176775.,40967.,3583.));\n    k += gabor(p, vec4(127766.,244817.,40502.,7053.));\n    k += gabor(p, vec4(162639.,183060.,96382.,48787.));\n    k += gabor(p, vec4(136485.,121975.,22018.,2464.));\n    k += gabor(p, vec4(163123.,60795.,13826.,2559.));\n    k += gabor(p, vec4(137527.,2708.,37384.,3401.));\n    k += gabor(p, vec4(129199.,79091.,13886.,14016.));\n    k += gabor(p, vec4(128172.,209464.,15415.,12586.));\n    k += gabor(p, vec4(75117.,175731.,44053.,4575.));\n    k += gabor(p, vec4(156417.,237511.,3076.,3558.));\n    k += gabor(p, vec4(127303.,227583.,20034.,12453.));\n    k += gabor(p, vec4(137476.,29717.,16403.,15540.));\n    k += gabor(p, vec4(86185.,28808.,13314.,2559.));\n    k += gabor(p, vec4(88247.,183488.,5124.,3203.));\n    k += gabor(p, vec4(95426.,55679.,16416.,16422.));\n    k += gabor(p, vec4(145773.,4825.,13870.,6286.));\n    k += gabor(p, vec4(100059.,173631.,39434.,5296.));\n    k += gabor(p, vec4(84684.,36170.,6151.,6211.));\n    k += gabor(p, vec4(139580.,40774.,25670.,23968.));\n    k += gabor(p, vec4(160576.,123043.,18460.,18854.));\n    k += gabor(p, vec4(76647.,172610.,12306.,2844.));\n    k += gabor(p, vec4(163583.,222336.,105180.,104503.));\n    k += gabor(p, vec4(131364.,12861.,15889.,14429.));\n    k += gabor(p, vec4(137620.,53838.,124392.,66184.));\n    k += gabor(p, vec4(135935.,159062.,15374.,12487.));\n    k += gabor(p, vec4(166594.,233555.,66587.,4419.));\n    k += gabor(p, vec4(177885.,108173.,5651.,4095.));\n    k += gabor(p, vec4(151814.,213188.,5128.,5286.));\n    k += gabor(p, vec4(183589.,36196.,27653.,3583.));\n    k += gabor(p, vec4(61734.,176663.,121985.,113710.));\n    k += gabor(p, vec4(154877.,207934.,5125.,5535.));\n    k += gabor(p, vec4(130818.,90536.,6658.,2559.));\n    k += gabor(p, vec4(72477.,53974.,66709.,19575.));\n    k += gabor(p, vec4(188140.,261739.,18946.,2464.));\n    k += gabor(p, vec4(154372.,153126.,3074.,2226.));\n    k += gabor(p, vec4(167692.,2885.,32287.,12631.));\n    k += gabor(p, vec4(144112.,211456.,25115.,24818.));\n    k += gabor(p, vec4(177898.,105612.,17453.,15049.));\n    k += gabor(p, vec4(178015.,211026.,4635.,3698.));\n    k += gabor(p, vec4(143182.,199250.,8201.,8404.));\n    k += gabor(p, vec4(131732.,213409.,21512.,3967.));\n    k += gabor(p, vec4(107906.,95848.,107726.,33791.));\n    k += gabor(p, vec4(132170.,163044.,95820.,14269.));\n    k += gabor(p, vec4(174336.,211771.,31320.,22987.));\n    k += gabor(p, vec4(86315.,189800.,84506.,12061.));\n    k += gabor(p, vec4(133782.,209019.,40477.,4045.));\n    k += gabor(p, vec4(93480.,247120.,10244.,4307.));\n    k += gabor(p, vec4(163096.,140626.,12806.,2218.));\n    k += gabor(p, vec4(128759.,194262.,4613.,5052.));\n    k += gabor(p, vec4(123658.,80742.,3587.,3684.));\n    k += gabor(p, vec4(158025.,145321.,9222.,2310.));\n    k += gabor(p, vec4(74991.,15406.,59752.,59639.));\n    k += gabor(p, vec4(160595.,80264.,12341.,9087.));\n    k += gabor(p, vec4(94493.,11262.,21047.,11390.));\n    k += gabor(p, vec4(183077.,157649.,10766.,4245.));\n    k += gabor(p, vec4(110357.,239099.,31283.,10751.));\n    k += gabor(p, vec4(128758.,195555.,5125.,3583.));\n    k += gabor(p, vec4(128805.,236793.,14354.,14335.));\n    k += gabor(p, vec4(159376.,106977.,95840.,95933.));\n    k += gabor(p, vec4(153352.,71723.,3075.,3258.));\n    k += gabor(p, vec4(156931.,108356.,4102.,2559.));\n\n    // Don't add speckles in preview!\n    if (iResolution.y >= 200.0) {\n        k += 0.12 * (hash12(fragCoord.xy)*2.0 - 1.0);\n    }\n    \n    fragColor.xyz = vec3(0.5*k + 0.5);                 \n\t\n}",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}