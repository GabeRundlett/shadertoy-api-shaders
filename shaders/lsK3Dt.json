{
    "Shader": {
        "info": {
            "date": "1457204209",
            "description": "Like asteroids only your engine is dead and you're surrounded by aliens. Mouse or arrow keys to aim, space to shoot and R to restart. ",
            "flags": 56,
            "hasliked": 0,
            "id": "lsK3Dt",
            "likes": 14,
            "name": "Drifter              ",
            "published": 3,
            "tags": [
                "game"
            ],
            "usePreview": 0,
            "username": "eiffie",
            "viewed": 1380
        },
        "renderpass": [
            {
                "code": "//Drifter by eiffie\n//like asteroids...https://www.shadertoy.com/view/4l2GzR & https://www.shadertoy.com/view/4llSD2\n//only your engine is dead and you're surrounded by aliens\n//mouse or arrow keys to aim, space to shoot, R to restart\n#define load(a) texture(iChannel0,(vec2(a,0.0)+0.5)/iResolution.xy)\n\n#define HALF_FIELD vec2(20.0,15.0)\n\n//https://www.shadertoy.com/view/4dsSzN funpatterns by cafe (editted by FabriceNeyret2)\nfloat rand (vec2 co){  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453); }\n#define pix(U)  step(.5, rand(floor(U)))\nfloat hm(vec2 uv, float tim){\n    uv.y+=tim;\n    if(uv.y<25.0)return 0.0;\n    uv*=0.2;\n\tvec2 nuv = 2.*fract(uv)-1.,\n\t     pos = sign(nuv)*.9;\n\tfloat d = max(max(abs(nuv.x),abs(nuv.y)),max(abs(nuv.x+nuv.y),abs(nuv.x-nuv.y))*0.707),\t\n\t      v = pix(uv);\n    if (d<1.) return v;\n\tfloat v0 = v,\n          v1 = pix(uv+vec2(pos.x,0)),\n\t      v2 = pix(uv+vec2(0,pos.y));\n\tif (v1==v2)\tv = v==pix(uv+pos) && v!=v1 ? 0. : v1;\n\treturn mix(v0, v, smoothstep(d,1.,1.001));\n}\n\nfloat Quadric(in vec2 p,in vec3 r){return (dot(p*r.xy,p)-r.z)/length(2.0*r.xy*p);}\nfloat Arc(in vec2 p, vec4 r) {float t=clamp(atan(p.y,p.x),r.z,r.w);return length(p-r.x*vec2(cos(t),sin(t)))-r.y;}\nfloat Tube(vec2 pa, vec2 ba, float r){return length(pa-ba*clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0))-r;}\nvec2 rotate(vec2 v, float angle) {return cos(angle)*v+sin(angle)*vec2(v.y,-v.x);}\nvec2 cossin(float a){return vec2(cos(a),sin(a));}\n\nfloat DES(vec2 p){\n\tfloat d=abs(Quadric(p,vec3(0.5,1.0,0.25)))-0.01;\n\td=min(d,Arc(p-vec2(0.0,0.75),vec4(1.0,0.01,-2.14,-1.05)));\n\tvec2 ap=abs(p);\n\td=min(d,Tube(ap-vec2(0.22,0.47),vec2(0.11,0.25),0.01));\n\tp.x=abs(p.x);\n\tp-=vec2(0.22,0.47)+vec2(0.11,0.25)*1.33;\n\td=min(d,abs(length(p)-0.08)-0.01);\n\tp.y+=1.54;\n\td=min(d,max(abs(p.x)-0.1,abs(p.y)-0.01));\n\treturn d;\n}\nfloat DEP(vec2 p){\n\tp.y=abs(p.y);p.x-=0.5;\n\tfloat d=Tube(p,vec2(-1.,0.5),0.01);\n\treturn d;\n}\n\n// Letter code (https://dl.dropboxusercontent.com/u/14645664/files/glsl-text.txt)\nconst float lineWidth = 0.02,border = 0.05,scale = 0.15;\nfloat line(vec2 p, vec2 s, vec2 e) {s*=scale;e*=scale;float l=length(s-e);vec2 d=vec2(e-s)/l;p-=vec2(s.x,-s.y);p=vec2(p.x*d.x+p.y*-d.y,p.x*d.y+p.y*d.x);return length(max(abs(p-vec2(l/2.0,0))-vec2(l/2.0,lineWidth/2.0),0.0))-border;}\nfloat E(vec2 p){float d=line(p,vec2(5,1.5),vec2(1,1.5));d=min(d,line(p,vec2(1,1.5),vec2(1,5)));d=min(d,line(p,vec2(1,5),vec2(3,5)));d=min(d,line(p,vec2(3,5),vec2(1,5)));d=min(d,line(p,vec2(1,5),vec2(1,8)));d=min(d,line(p,vec2(1,8),vec2(5,8)));return d;}\nfloat L(vec2 p){float d=line(p,vec2(1,1.5),vec2(1,8));d=min(d,line(p,vec2(1,8),vec2(5,8)));return d;}\nfloat O(vec2 p){float d=line(p,vec2(5,1.5),vec2(1,1.5));d=min(d,line(p,vec2(1,1.5),vec2(1,8)));d=min(d,line(p,vec2(1,8),vec2(5,8)));d=min(d,line(p,vec2(5,8),vec2(5,1.5)));return d;}\nfloat R(vec2 p){float d=line(p,vec2(1,8),vec2(1,1.5));d=min(d,line(p,vec2(1,1.5),vec2(5,1.5)));d=min(d,line(p,vec2(5,1.5),vec2(5,5)));d=min(d,line(p,vec2(5,5),vec2(1,5)));d=min(d,line(p,vec2(1,5),vec2(3.5,5)));d=min(d,line(p,vec2(3.5,5),vec2(5,8)));return d;}\nfloat S(vec2 p){float d=line(p,vec2(5,1.5),vec2(1,1.5));d=min(d,line(p,vec2(1,1.5),vec2(1,5)));d=min(d,line(p,vec2(1,5),vec2(5,5)));d=min(d,line(p,vec2(5,5),vec2(5,8)));d=min(d,line(p,vec2(5,8),vec2(1,8)));return d;}\nfloat V(vec2 p){float d=line(p,vec2(1,1.5),vec2(3,8));d=min(d,line(p,vec2(3,8),vec2(5,1.5)));return d;}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n\tvec2 p=fragCoord/iResolution.xy;\n\tvec4 st0=load(32);\n\tvec4 st1=load(33);\n    vec4 st2=load(34);\n\tfloat r=rand(p);\n\tvec3 col=vec3(sin(fragCoord),0.75)*pow(r*0.99,40.0);\n\tp-=0.5;p*=1.9*HALF_FIELD;\n    float d=hm(p,st2.x);\n    col=mix(col,vec3(0.5),d);\n\td=DEP(rotate(p-st0.xy,st1.z));\n\tfor(int i=0;i<16;i++){\n\t\tvec2 s=load(i).xy;\n\t\td=min(d,DES(p-s));\n\t\ts=load(i+16).xy;\n\t\td=min(d,length(p-s)-0.02);\n\t}\n\tif(abs(st0.x)>999.0){\n\t\tp+=vec2(2.5,-0.5);\n\t\td=min(d,L(p));p.x-=1.0;\n\t\td=min(d,st0.x<0.0?O(p):E(p));p.x-=1.0;\n\t\td=min(d,st0.x<0.0?S(p):V(p));p.x-=1.0;\n\t\td=min(d,E(p));p.x-=1.0;\n\t\td=min(d,st0.x<0.0?R(p):L(p));p.x-=1.0;\n        if(st0.x>0.0){p.x=-(p.x-2.0);d=min(d,st0.x<1500.0?S(p):E(p));}\n\t}\n\td=smoothstep(0.0,0.1,d);\n\tcol=mix(vec3(1.0),col,d);\n\tfragColor=vec4(col,1.0);\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "nearest",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "#define HALF_FIELD vec2(20.0,15.0)\n#define RADIUS 1.0\n#define KEY_LEFT 37\n#define KEY_RIGHT 39\n#define KEY_SPACE 32\n#define KEY_R 82\n#define BULLET_SPEED 8.0\n#define TURN_SPEED 5.0\n#define BUG_SPEED 4.0\n#define PLAYER_SPEED 4.0\n#define RECOIL 0.5\n#define PI 3.14159\n\nbool KeyDown(in int key){\n\treturn (texture(iChannel1,vec2((float(key)+0.5)/256.0, 0.25)).x>0.0);\n}\n\n//https://www.shadertoy.com/view/4dsSzN funpatterns by cafe (editted by FabriceNeyret2)\nfloat rand (vec2 co){  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453); }\n#define pix(U)  step(.5, rand(floor(U)))\nfloat hm(vec2 uv, float tim){\n    uv.y+=tim;\n    if(uv.y<25.0)return 0.0;\n    uv*=0.2;\n\tvec2 nuv = 2.*fract(uv)-1.,\n\t     pos = sign(nuv)*.9;\n\tfloat d = max(max(abs(nuv.x),abs(nuv.y)),max(abs(nuv.x+nuv.y),abs(nuv.x-nuv.y))*0.707),\t\n\t      v = pix(uv);\n    if (d<1.) return v;\n\tfloat v0 = v,\n          v1 = pix(uv+vec2(pos.x,0)),\n\t      v2 = pix(uv+vec2(0,pos.y));\n\tif (v1==v2)\tv = v==pix(uv+pos) && v!=v1 ? 0. : v1;\n\treturn mix(v0, v, smoothstep(d,1.,1.001));\n}\nvec2 sgn(vec2 p){return vec2(p.x<0.?-1.:1.,p.y<0.?-1.:1.);}\nfloat sgn(float p){return (p<0.?-1.:1.);}\nfloat dot2(vec2 p){return dot(p,p);}\nvec2 cossin(float a){return vec2(cos(a),sin(a));}\nvec4 RandomSpacebug(vec2 p){\n\tfloat r=fract(sin(iDate.w+dot(p,vec2(13.13,117.17)))*4321.123);\n\tp=vec2(2.0*(r-0.5),sin(2.0+(r+r*r)*4321.123));\n\tvec2 v=(abs(p.x)>abs(p.y)?vec2(sgn(p.x),p.y):vec2(p.x,sgn(p.y)));\n\treturn vec4(v*HALF_FIELD,normalize(p.yx+p.yy)*(p.x+p.y));\n}\nvoid mainImage(out vec4 O, in vec2 U){\n\tif(U.y>1.0 || U.x>35.0)discard;\n\tO=texture(iChannel0,U/iResolution.xy);\n\t//game state0=player xy,vel\n\t//state1=next bullet,next respawn,player angle,shot timer\n\tvec4 st0=texture(iChannel0,vec2(32.5,0.5)/iResolution.xy);\n\tvec4 st1=texture(iChannel0,vec2(33.5,0.5)/iResolution.xy);\n    vec4 st2=texture(iChannel0,vec2(34.5,0.5)/iResolution.xy);\n\t\n\tbool bSetup=(iFrame<5 || KeyDown(KEY_R));\n\tif(U.x<16.0){//spacemen\n\t\tif(bSetup){\n\t\t\tO=RandomSpacebug(U);\n\t\t}else{\n\t\t\tif(O.x>-1000.0){//if alive\n                if(st0.x>-999.0)O.zw+=(st0.xy-O.xy)*iTimeDelta*st2.x*0.005/(1.0+dot2(st0.xy-O.xy));\n\t\t\t\tO.xy+=O.zw*iTimeDelta*BUG_SPEED;\n\t\t\t\tO.xy=mod(O.xy+HALF_FIELD,HALF_FIELD*2.0)-HALF_FIELD;\n\t\t\t\tfor(int i=0;i<16;i++){\n\t\t\t\t\tvec2 p=texture(iChannel0,vec2(float(i)+16.5,0.5)/iResolution.xy).xy;\n\t\t\t\t\tif(distance(p,O.xy)<RADIUS)O.x=-1000.0;//collision bullet/spacemen\n\t\t\t\t}\n\t\t\t}else{//respawn??\n\t\t\t\tif(floor(st1.y)==floor(U.x))O=RandomSpacebug(U);\n\t\t\t}\n\t\t}\n\t}else if(U.x<32.0){//bullets\n\t\tif(bSetup){\n\t\t\tO=vec4(-1000.0);//not shot\n\t\t}else{\n\t\t\tif(O.x>-1000.0){\n\t\t\t\tO.xy+=O.zw*iTimeDelta*BULLET_SPEED;\n\t\t\t\tvec2 p=abs(O.xy)-HALF_FIELD;\n\t\t\t\tif(max(p.x,p.y)>0.0)O.x=-1000.0;//bullet dies offscreen\n\t\t\t}else{//new shot\n\t\t\t\tif(floor(st1.x)==floor(U.x-16.0) && st1.w>0.0){vec2 dr=cossin(st1.z);O=vec4(st0.xy+dr*0.5,dr);}\n\t\t\t}\n\t\t}\n\t}else{//game state\n\t\tif(bSetup){\n\t\t\tst0=vec4(0.0);//position,velocity\n\t\t\tst1=vec4(0.0);//next bullet,next respawn, angle, shot timer\n            st2=vec4(0.0);//game ticks\n\t\t}else{\n\t\t\tif(abs(st0.x)<999.0){\n\t\t\t\tst0.xy+=st0.zw*iTimeDelta*PLAYER_SPEED;\n\t\t\t\tst0.xy=mod(st0.xy+HALF_FIELD,HALF_FIELD*2.0)-HALF_FIELD;\n                if(st2.x>180.0)st0.x=2000.0;\n\t\t\t}\n\t\t\tif(KeyDown(KEY_RIGHT))st1.z-=iTimeDelta*TURN_SPEED;\n\t\t\tif(KeyDown(KEY_LEFT))st1.z+=iTimeDelta*TURN_SPEED;\n\t\t\tif(KeyDown(KEY_SPACE) && st1.w<=0.0){\n\t\t\t\tst0.zw-=cossin(st1.z)*RECOIL;\n\t\t\t\tst1.x=mod(st1.x+1.0,16.0);//bullet to shoot\n\t\t\t\tst1.w=0.1;//shot timer\n\t\t\t}\n\t\t\tif(iMouse.z>0.0){\n                vec2 p=iMouse.xy/iResolution.xy-0.5;\n                p*=1.9*HALF_FIELD;\n\t\t\t\tst1.z=atan(p.y-st0.y,p.x-st0.x);\n\t\t\t}\n\t\t\tst1.y=mod(st1.y+iTimeDelta,16.0);//respawn\t\n\t\t\tst1.w-=iTimeDelta;//shot timer\n            if(hm(st0.xy,st2.x)==1.)st0.x=-1000.0;\n            int j=0;\n\t\t\tfor(int i=0;i<16;i++){\n\t\t\t\tvec2 p=texture(iChannel0,vec2(float(i),0.5)/iResolution.xy).xy;\n\t\t\t\tif(distance(p,st0.xy)<RADIUS)st0.x=-1000.0;//collision drifter/spacemen\n                else if(p.x<-999.)j++;\n\t\t\t}\n            if(j>13)st0.x=1000.0;\n            st2.x+=iTimeDelta;\n\t\t}\n\t\tO=(U.x<33.0?st0:U.x<34.0?st1:st2);\n\t}\t\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 1,
                        "ctype": "keyboard",
                        "id": 33,
                        "published": 1,
                        "sampler": {
                            "filter": "nearest",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/presets/tex00.jpg"
                    },
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "nearest",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Buf A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "#define bps 6.0\nfloat nofs(float n){//the song's \"random\" ring\n    n=mod(n,8.0);\n    if(n<1.0)return 5.0;\n    if(n<2.0)return 4.0;\n    if(n<3.0)return 2.0;\n    if(n<4.0)return 0.0;\n    if(n<5.0)return 4.0;\n    if(n<6.0)return 3.0;\n    if(n<7.0)return 2.0;\n    return 1.0;\n}\n\nfloat scale(float note){//throws out dissonant tones\n\tfloat n2=mod(note,12.0);\n\tif((n2==1.0)||(n2==3.0)||(n2==6.0)||(n2==8.0)||(n2==10.0))note=-100.0;//major\n\t//if((n2==1.0)||(n2==4.0)||(n2==6.0)||(n2==9.0)||(n2==11.0))note=-100.0;//minor\n\t//if((n2==1.0)||(n2==4.0)||(n2==5.0)||(n2==9.0)||(n2==10.0))note=-100.0;//hungarian minor\n\t//if(note>96)note=96.0+n2;\n\treturn note;\n}\n\n#define TAU 6.283185\n#define wav cosine\n// note number to frequency  from https://www.shadertoy.com/view/ldfSW2\nfloat ntof(float n){return (n>0.0)?440.0 * pow(2.0, (n - 67.0) / 12.0):0.0;}\n//float spow(float x, float y){return sign(x)*pow(abs(x),y);}\nvec2 cosine(vec2 t){return cos(TAU*t);}\nvec2 sine(vec2 t){return sin(TAU*t);}\nvec2 saw(vec2 t){return 2.0*(fract(t)-0.5);}\nvec2 ssaw(vec2 t){return 4.0*(abs(fract(t)-0.5)-0.25);}\nvec2 squar(vec2 t){return sign(fract(t)-0.5);}\nfloat rand(float t){return fract(sin(mod(t,4321.123)*4321.123)*4321.123);}\nfloat noise(float t){float f=fract(t);t=floor(t);return mix(rand(t),rand(t+1.0),f);}\nfloat snoise(float t){float f=fract(t);t=floor(t);return mix(rand(t),rand(t+1.0),f*f*(3.0-2.0*f));}\n\nfloat I(float tf, float c, float s){// taken from jnorberg https://www.shadertoy.com/view/lt2GRy\n\tfloat wf=c*24.0;//the number of harmonics to simulate\n\tvec2 w=vec2(0.125,1.125)+vec2(floor(wf));w*=2.0;\n\tfloat p=fract(tf),sw=1.0-2.0*p,ip=1.0-p;\n\tvec2 sinc=-wav(w*p)/(1.0+s*p)+wav(w*ip)/(1.0+s*ip);\n\treturn (sw+mix(sinc.x,sinc.y,fract(wf)))*0.5;\n}\nvec2 inst(float n,float t,float bt,float pan,int i){\n\tfloat f=ntof(scale(n)),c=1.0,s=0.9,fo=3.0,att=1000.0;\n\tif(f<12.0)return vec2(0.0);\n\tif(i==0)c=bt*0.2;\n\telse if(i==1){c=0.3-bt*0.5;fo=0.5;}\n\telse if(i==2){c=bt*0.1;s=0.3;fo=1.0;att=10.0;}\n\telse if(i==3){c=bt*0.2;fo=4.0;}\n\telse if(i==4){c=0.01;s=0.01;fo=0.125;}\n\telse {c=1.0-bt;fo=6.0;}\n\tfloat a=I(f*t,c,s);\n\ta*=(1.0-exp(-bt*att))*exp(-bt*fo)*60.0/n;\n\treturn vec2(a*(1.0-pan),a*pan);\n}\n\nvec2 mainSound( in int samp,float time)\n{\n\tfloat tim=time*bps;\n\tfloat b=floor(tim);tim+=0.25*snoise(time*2.0);\n\tfloat t0=fract(tim),t1=mod(tim,2.0)*0.5,t2=mod(tim,4.0)*0.25;\n\tfloat n2=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tfloat n1=n2+nofs(b*0.5),n0=n1+nofs(b);\n\t\n\tvec2 a0=inst(n0+72.0,time,t0,0.5,0);\n\tvec2 a1=(mod(tim,256.0)<192.0?inst(n1+60.0,time,t1,0.8,1)*(0.6+0.2*snoise(time)):vec2(0.0));\n\tvec2 a2=inst(n2+36.0,time,t2,0.2,2);\n\tvec2 a1h=inst(n1+21.0,time,t1,0.6,3);\n\tvec2 a2h=inst(n2+43.0,time,t2,0.4,4);\n\tvec2 a1hb=inst(n1+4.0,time,t1,0.1,5)*rand(time);\n\tvec2 v=0.33*(a0+a1+a2+a1h+a2h+0.2*a1hb);\n\treturn clamp(v,-1.0,1.0);\n}\n",
                "description": "",
                "inputs": [],
                "name": "Sound",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 38
                    }
                ],
                "type": "sound"
            }
        ],
        "ver": "0.1"
    }
}