{
    "Shader": {
        "info": {
            "date": "1381635042",
            "description": "A few spheres with raytraced ambient occlusion.",
            "flags": 0,
            "hasliked": 0,
            "id": "ldX3Ws",
            "likes": 48,
            "name": "Balls and occlusion",
            "published": 3,
            "tags": [
                "3d",
                "raytracing",
                "occlusion"
            ],
            "usePreview": 0,
            "username": "iq",
            "viewed": 11254
        },
        "renderpass": [
            {
                "code": "// Copyright Inigo Quilez, 2013 - https://iquilezles.org/\n// I am the sole copyright owner of this Work.\n// You cannot host, display, distribute or share this Work in any form,\n// including physical and digital. You cannot use this Work in any\n// commercial or non-commercial product, website or project. You cannot\n// sell this Work and you cannot mint an NFTs of it.\n// I share this Work for educational purposes, and you can link to it,\n// through an URL, proper attribution and unmodified screenshot, as part\n// of your educational material. If these conditions are too restrictive\n// please contact me and we'll definitely work it out.\n\n#define NUMSPHEREES 12\n\n#define eps 0.001\n\nvec2 hash2( float n )\n{\n    return fract(sin(vec2(n,n+1.0))*vec2(43758.5453123,22578.1459123));\n}\n\nvec3 hash3( float n )\n{\n    return fract(sin(vec3(n,n+1.0,n+2.0))*vec3(43758.5453123,22578.1459123,19642.3490423));\n}\n\nvec3 nSphere( in vec3 pos, in vec4 sph )\n{\n    return (pos-sph.xyz)/sph.w;\n}\n\nfloat iSphere( in vec3 ro, in vec3 rd, in vec4 sph )\n{\n\tvec3 oc = ro - sph.xyz;\n\tfloat b = dot( oc, rd );\n\tfloat c = dot( oc, oc ) - sph.w*sph.w;\n\tfloat h = b*b - c;\n\tif( h<0.0 ) return -1.0;\n\treturn -b - sqrt( h );\n}\n\nfloat sSphere( in vec3 ro, in vec3 rd, in vec4 sph )\n{\n    vec3 oc = ro - sph.xyz;\n    float b = dot( oc, rd );\n    float c = dot( oc, oc ) - sph.w*sph.w;\n\t\n    return step( min( -b, min( c, b*b - c ) ), 0.0 );\n}\n\nvec4 sphere[NUMSPHEREES];\n\nfloat intersect( in vec3 ro, in vec3 rd, out vec3 nor, out float id )\n{\n\tfloat res = 1e20;\n\tfloat fou = -1.0;\n\t\n\tnor = vec3(0.0);\n\n\tfor( int i=0; i<NUMSPHEREES; i++ )\n\t{\n\t\tvec4 sph = sphere[i];\n\t    float t = iSphere( ro, rd, sph ); \n\t\tif( t>eps && t<res ) \n\t\t{\n\t\t\tres = t;\n\t\t\tnor = nSphere( ro + t*rd, sph );\n\t\t\tfou = 1.0;\n\t\t\tid = float(i);\n\t\t}\n\t}\n\t\t\t\t\t\t  \n    return fou * res;\t\t\t\t\t  \n}\n\nfloat shadow( in vec3 ro, in vec3 rd )\n{\n\tfloat res = 1.0;\n\tfor( int i=0; i<NUMSPHEREES; i++ )\n\t{\n\t\tfloat id = float(i);\n\t    float t = sSphere( ro, rd, sphere[i] ); \n\t\tres = min( t, res );\n\t}\n    return res;\t\t\t\t\t  \n}\n\nfloat getRad( float id )\n{\n\tfloat rad = 0.0;\n\tif( id<12.5 ) rad = 1.0;\n\tif( id<9.5 )  rad = 0.5;\n\tif( id<6.5 )  rad = 0.0;\n\treturn rad;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 q = fragCoord.xy / iResolution.xy;\n    vec2 p = -1.0 + 2.0 * q;\n    p.x *= iResolution.x/iResolution.y;\n    vec2 m = vec2(0.5);\n\tif( iMouse.z>0.0 ) m = iMouse.xy/iResolution.xy;\n\t\n    //-----------------------------------------------------\n    // animate\n    //-----------------------------------------------------\n\tfloat time = iTime - 11.6;\n\t\n\tfloat an = 0.3*time - 7.0*m.x;\n\n\tfor( int i=0; i<NUMSPHEREES; i++ )\n\t{\n\t\tfloat id  = float(i);\n\t\tfloat rad = getRad( id );\n\t    vec3  pos = 1.0*cos( 6.2831*hash3(id*37.17) + 0.5*(1.0-0.7*rad)*hash3(id*31.3+4.7)*time );\n\t\tsphere[i] = vec4( pos, (0.3+0.7 *rad) );\n    }\n\t\t\t\n    //-----------------------------------------------------\n    // camera\n    //-----------------------------------------------------\n\tvec3 ro = vec3(2.5*sin(an),1.5*cos(0.5*an),2.5*cos(an));\n    vec3 ta = vec3(0.0,0.0,0.0);\n    vec3 ww = normalize( ta - ro );\n    vec3 uu = normalize( cross(ww,vec3(0.0,1.0,0.0) ) );\n    vec3 vv = normalize( cross(uu,ww));\n\tvec3 rd = normalize( p.x*uu + p.y*vv + 2.0*ww );\n\n    //-----------------------------------------------------\n\t// render\n    //-----------------------------------------------------\n\tvec3 col = vec3(1.0) * (0.98+0.1*rd.y);\n\n\t// raymarch\n\tvec3 nor;\n\tfloat id;\n\tfloat t = intersect(ro,rd,nor, id);\n\tif( t>0.0 )\n\t{\n\t\tvec3 pos = ro + t*rd;\n\t\t\n\t\tfloat occ = 0.0;\n\n        {\n        float ks = sign(nor.z);\n        float ka = - 1.0 / (1.0 + ks*nor.z);\n        float kb = ks * nor.x * nor.y * ka;\n        uu = vec3(1.0 + nor.x * nor.x * ka, ks*kb, -ks*nor.x);\n        vv = vec3(kb, ks + ks*nor.y * nor.y*ka, -nor.y);\n        }\n        \n        float off = texture( iChannel0, fragCoord.xy/iChannelResolution[0].xy, -100.0 ).x;\n\t\tfor( int j=0; j<48; j++ )\n\t\t{\n\t\t\tvec2  aa = hash2( off + float(j)*203.1 );\n\t\t\tfloat ra = sqrt(aa.y);\n\t\t\tfloat rx = ra*cos(6.2831*aa.x); \n\t\t\tfloat ry = ra*sin(6.2831*aa.x);\n\t\t\tfloat rz = sqrt( 1.0-aa.y );\n\t\t\tvec3  rr = vec3( rx*uu + ry*vv + rz*nor );\n\t\t\tocc += shadow( pos, rr );\n\t\t}\n\t\tocc /= 48.0;\n\t\t\t\t\n\t\tvec3 mate = vec3(1.0);\n\t\tmate = vec3( 1.0, 1.0, 0.6 );\n\t\tmate = mix( mate, vec3(1.0,0.4,0.1), (1.0-smoothstep(0.7,0.71,getRad( id ))) );\n\t\tmate = mix( mate, vec3(1.0,0.7,0.1), (1.0-smoothstep(0.4,0.41,getRad( id ))) );\n        mate += 0.10*sin( 5.0 + vec3(0.0,1.0,2.0) + id*20.0 );\n\t\tmate *= 0.25 + 0.75*mix( 1.0, smoothstep( -0.95,-0.8,sin(pos.y*40.0) ), 1.0-pow(abs(nor.y),8.0) );\n\t\tmate *= 1.00 + 0.10*nor*nor*nor;\n\t\t\n\t\tcol = mate * (occ*0.25+0.75*sqrt(occ));\n\t\t\n\t\tcol += 0.25*pow( 1.0+dot(rd,nor), 5.0 )*occ*occ;\n\t    col *= 0.90 + 0.10*nor.y;\n\t}\n\t\n\t// vigneting\n    col *= 1.0 - 0.3*dot((q-0.5)*(q-0.5),(q-0.5)*(q-0.5));\n\n\tfragColor = vec4( col, 1.0 );\n}\n",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "texture",
                        "id": 30,
                        "published": 1,
                        "sampler": {
                            "filter": "mipmap",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "false",
                            "wrap": "repeat"
                        },
                        "src": "/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}