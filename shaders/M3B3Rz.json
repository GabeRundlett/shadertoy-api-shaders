{
    "Shader": {
        "info": {
            "date": "1708107928",
            "description": "aye ",
            "flags": 0,
            "hasliked": 0,
            "id": "M3B3Rz",
            "likes": 19,
            "name": "Rose glasses",
            "published": 3,
            "tags": [
                "2d"
            ],
            "usePreview": 0,
            "username": "orblivius",
            "viewed": 391
        },
        "renderpass": [
            {
                "code": "\n#define PI2 3.141592\n#define TAU PI*2.\n#define SIN(x) (.5+.5*sin(x))\n\n//Bloom\n#define BLOOM_SIZE (1.15)\n#define BLOOM_THRESHOLD (0.01)\n#define BLOOM_RANGE (0.5)\n#define BLOOM_FRAME_BLEND (0.2)\n\n#define PI 3.1415927\n#define lofi(x,d) (floor((x)/(d))*(d))\n#define time iTime\n#define BEAT (time*170.0/90.0)\n\nfloat tt=0.0;\n\nvec3 pal( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d )\n{\n    return a + b*cos( TAU*(c*t+d) );\n}\n\nvec3 getPal(int id, float t) {\n\n    vec3                col = pal( t, vec3(.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,1.0),vec3(0.0,-0.33,0.33) );\n    if( id == 1 ) col = pal( t, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,1.0),vec3(0.0,0.10,0.20) );\n    if( id == 2 ) col = pal( t, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,1.0),vec3(0.3,0.20,0.20) );\n    if( id == 3 ) col = pal( t, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,0.5),vec3(0.8,0.90,0.30) );\n    if( id == 4 ) col = pal( t, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,0.7,0.4),vec3(0.0,0.15,0.20) );\n    if( id == 5 ) col = pal( t, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(2.0,1.0,0.0),vec3(0.5,0.20,0.25) );\n    if( id == 6 ) col = pal( t, vec3(0.8,0.5,0.4),vec3(0.2,0.4,0.2),vec3(2.0,1.0,1.0),vec3(0.0,0.25,0.25) );\n    \n    return col;\n}\n\n\nvec3 colorStripeTexture(vec3 p) {\n    return vec3(1);\n}\n\n\nfloat box(vec3 p, vec3 r) {\n\tvec3 q = abs(p) - r;\n    return max(max(q.x, q.y),q.z);\n}\n\nmat2 rot(float a) { return mat2(cos(a), sin(a), -sin(a), cos(a));}\n\nfloat repeat(inout float x, float n) {\n    float id = floor(n*x)/n;\n    x = fract(n*x);\n    return id;\n}\n\nvec2 repeat(inout vec2 p, vec2 size) {\n\tvec2 c = floor((p + size*0.5)/size);\n\tp = mod(p + size*0.5,size) - size*0.5;\n\treturn c;\n}\n\nfloat pMod1(inout float p, float size) {\n\tfloat halfsize = size*0.5;\n\tfloat c = floor((p + halfsize)/size);\n\tp = mod(p + halfsize, size) - halfsize;\n\treturn c;\n}\n\nvec2 moda(vec2 p, float repetitions) {\n\tfloat angle = 2.*PI/repetitions;\n\tfloat a = atan(p.y, p.x) + angle/2.;\n\ta = mod(a,angle) - angle/2.;\n\treturn vec2(cos(a), sin(a))*length(p);\n}\n\n\n/*float pring(vec3 p, float s, float r) {\n    \n    float dp = prism(p, vec2(s, .2));\n    \n    dp = max(dp, -prism(p, vec2(s-r, .3)));\n    return dp;\n}*/\n\nfloat pModSingle1(inout float p, float size) {\n\tfloat halfsize = size*0.5;\n\tfloat c = floor((p + halfsize)/size);\n\tif (p >= 0.)\n\t\tp = mod(p + halfsize, size) - halfsize;\n\treturn c;\n}\n\nvec3 kalei(vec3 p) {\n  float w = 1.;\n      p = abs(p) -.2;\n  for(float i=0.; i < 3.; i++) {\n        float t1 = 2.+sin(i+tt) + sin(.7*tt)*.4;\n        p.xy *= rot(.3*t1);\n        p -= 0.1 + .1*i;\n       // p.y -= 0.3;\n        p = abs(p);\n \n    }\n    p /= w;\n    return p;\n}\nvec2 foldSym(vec2 p, float N) {\n    float t = atan(p.x,-p.y);\n    t = mod(t+PI/N,2.0*PI/N)-PI/N;\n    p = length(p.xy)*vec2(cos(t),sin(t));\n    p = abs(p)-0.25;\n    p = abs(p)-0.25;\n    return p;\n}\n\n\nvec2 beamId;\nfloat map(vec3 p) {\n\n    vec3 bp = p;\n    float repz = 8.;\n    float idz = pModSingle1(p.z,repz);\n    \n   p.xy *= rot(tt*TAU/16.*sign(mod(idz, 2.)-.5));\n    p.xy = foldSym(p.xy, 6.);\n   \n\n    p.y += 0.4*sin(p.z*TAU/4.+tt*TAU/2.);\n    \n    p.xy *= rot(.25*PI*mod(idz, 2.));\n\n   \n    //p = kalei(p);\n    float blen = 3.9;\n\n    float outer = 1.3;\n    float inner = 1.1;\n    float maskout = box(p, vec3(vec2(outer), blen));\n    float maskin = box(p, vec3(vec2(inner), blen + .3));\n    beamId = repeat(p.xy, vec2(.2));\n    float beam = box(p, vec3(vec2(.07), blen));\n    \n    float frame = max(maskout, -maskin);\n    float d = max(beam, maskout);\n    d = max(d, frame);\n    return d;\n   \n}\n\nfloat calcAO(vec3 p, vec3 n)\n{\n\tfloat sca = 2.0, occ = 0.0;\n    for( int i=0; i<5; i++ ){\n    \n        float hr = 0.01 + float(i)*0.5/4.0;        \n        float dd = map(n * hr + p);\n        occ += (hr - dd)*sca;\n        sca *= 0.7;\n    }\n    return clamp( 1.0 - occ, 0.0, 1.0 );    \n}\n\nvoid cam(inout vec3 p) {\n    p.z += 4.*tt;;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord-.5*iResolution.xy)/iResolution.x;\n    \n    //uv *= rot(.5*PI);\n    tt = iTime+.1;\n    \n    tt = mod(tt, 8.);\n    vec3 ro = vec3(0, 0., 0.),\n         rd = normalize(vec3(uv, .25)),\n         lp = vec3(0., 0., 2.);\n    \n    cam(ro);\n    cam(lp);\n    vec3 col=vec3(0);\n    float i, t, d = 0.1;\n\n    vec3 p = ro;\n    \n    vec2 beamIdTemp;\n    for(i=0.; i<200.; i++) {\n    \n          \n        d = map(p);\n        beamIdTemp = beamId; // save id\n        \n        if(d < 0.001 || t > 100.) break;\n        \t\n        p += rd*d;\n        t += d;\n    }\n    \n    vec2 e = vec2(0.0035, -0.0035);\n    \n    if(d < 0.01) {\n        vec3 al = vec3(0.000,1.000,0.616);\n        al = getPal(5, beamIdTemp.y/10. + sin(tt*TAU/16.));\n        vec3 n = normalize( e.xyy*map(p+e.xyy) + e.yyx*map(p+e.yyx) +\n                            e.yxy*map(p+e.yxy) + e.xxx*map(p+e.xxx));\n        \n        vec3 l = normalize(lp-p);\n        float dif = max(dot(n, l), .0);\n        float spe = pow(max(dot(reflect(-rd, n), -l), .0), 40.);\n        float sss = smoothstep(0., 1., map(p+l*.4))/.4; \n        float ao = calcAO(p, n);\n        \n        col =  al*mix(1., spe+.9*(dif+1.5*sss), .4);\n        col = mix(col, col*ao, .9);\n        \n        float fog = 1.-exp(-t*0.04);\n        \n      // col = mix(col, vec3(.1), fog);\n    }\n\n\n    // Output to screen\n    fragColor = vec4(col, 1.);\n}\n",
                "description": "",
                "inputs": [
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}