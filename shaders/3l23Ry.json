{
    "Shader": {
        "info": {
            "date": "1560255223",
            "description": "Applying reaction diffusion to a moving plane, to grow 3D shapes.\nIt goes wrong once the plane passes the camera but it looks cool so I left it like that!",
            "flags": 32,
            "hasliked": 0,
            "id": "3l23Ry",
            "likes": 12,
            "name": "Coral Growth",
            "published": 3,
            "tags": [
                "reactiondiffusion"
            ],
            "usePreview": 0,
            "username": "TekF",
            "viewed": 770
        },
        "renderpass": [
            {
                "code": "void mainImage( out vec4 fragColour, in vec2 fragCoord )\n{\n    fragColour = texelFetch(iChannel1,ivec2(fragCoord),0);\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "void mainImage( out vec4 fragColour, in vec2 fragCoord )\n{\n    ivec2 coord = ivec2(fragCoord);\n    ivec2 res = ivec2(iResolution.xy);\n    \n    #define Wrap(c) ((c+res)%res)\n    \n    fragColour = texelFetch(iChannel0,coord,0);\n    \n\t// reaction diffusion\n    // all of these params can vary with position/time/whatever to get nice effects\n    float laplaceSelf = -1.;\n    float laplaceAdjacent = .2;\n    float laplaceDiagonal = .05;\n    float deltaT = 1.; // could use frame duration but I'm pretty sure the maths isn't really linear\n    vec2 diffusionRate = vec2(1,.5);\n    \n    vec2 uv = fragCoord/iResolution.xy;\n//    vec2 feedKill = mix( vec2(0,.04), vec2(.1,.07), uv ); // map\n//    vec2 feedKill = vec2(.055,.062) + (uv-.5)*vec2(.05,.01); // recommended - but very slow\n//    vec2 feedKill = vec2(.025,.055); // angle sprouts\n//    vec2 feedKill = vec2(.023,.053) + uv.yx*vec2(0,.01); // spots! (variations by adjusting kill)\n//    vec2 feedKill = vec2(.033,.063);// dividing bacteria (needs sharp shapes)\n    vec2 feedKill = vec2(.031,.058); // fungal\n//    vec2 feedKill = mix( vec2(.02,.04), vec2(.0,.05), uv ); // weirdsmoke\n//    vec2 feedKill = mix( vec2(.03,.03), vec2(.0,.06), uv.yx ); // weirdsmoke\n//    vec2 feedKill = vec2(uv.x*uv.y,uv.y)*vec2(.02,.06); // smoke waves\n//    vec2 feedKill = vec2(.4*.6,.6)*vec2(.02,.06); // smooth arcs\n//    vec2 feedKill = vec2(.8*.6,.6)*vec2(.02,.06); // more spirally\n//    vec2 feedKill = vec2(.6,.65)*vec2(.02,.06); // cycling spirals\n//    vec2 feedKill = vec2(.75,.8)*vec2(.02,.06); // spiral puffs\n//    vec2 feedKill = vec2(.02,.055); // plankton\n//    vec2 feedKill = mix( vec2(0,.04), vec2(.1,.07), vec2(.21,.37) );// constant growth, different features\n//    vec2 feedKill = mix( vec2(0,.04), vec2(.1,.07), vec2(.2,.33) ); // very active\n//    vec2 feedKill = mix( vec2(0,.04), vec2(.1,.07), vec2(.23,.5) ); // terminating worms\n    \n    vec2 AB = fragColour.xy;\n\n    // sample neighbouring pixels and apply weights to them\n    ivec3 d = ivec3(-1,0,1);\n    vec2 laplace = laplaceSelf * AB;\n    laplace += \n        (\n            texelFetch(iChannel0,Wrap(coord+d.xy),0).xy +\n            texelFetch(iChannel0,Wrap(coord+d.zy),0).xy +\n            texelFetch(iChannel0,Wrap(coord+d.yx),0).xy +\n            texelFetch(iChannel0,Wrap(coord+d.yz),0).xy\n        )*laplaceAdjacent;\n    laplace += \n        (\n            texelFetch(iChannel0,Wrap(coord+d.xx),0).xy +\n            texelFetch(iChannel0,Wrap(coord+d.xz),0).xy +\n            texelFetch(iChannel0,Wrap(coord+d.zx),0).xy +\n            texelFetch(iChannel0,Wrap(coord+d.zz),0).xy\n        )*laplaceDiagonal;\n    \n    vec2 deltaAB = diffusionRate*laplace;\n    deltaAB += vec2(-1,1)*AB.x*AB.y*AB.y;\n    deltaAB.x += feedKill.x*(1.-AB.x);\n    deltaAB.y -= (feedKill.y+feedKill.x)*AB.y;\n    \n    AB += deltaT * deltaAB;\n    \n    AB = clamp(AB,0.,1.);\n    \n    fragColour.xy = AB;\n    \n    if ( iFrame == 0 )\n    {\n    \tfragColour = vec4(1,0,0,1);\n//        fragColour.xy = mix( fragColour.xy, vec2(0,1), smoothstep(8.1,8.,length(fragCoord-iResolution.xy*.5)+4.*sin(fragCoord.y+1.)+4.*sin(fragCoord.x+2.)) );\n        fragColour.y = smoothstep(4.,3.,min(min(length(fragCoord-iResolution.xy*.5),length(fragCoord-iResolution.xy*vec2(.6,.3))),length(fragCoord-iResolution.xy*.45) ));\n        fragColour.x = 1.-fragColour.y;\n    }\n    \n    // let mouse add more\n    if ( iMouse.z > 0. )\n    {\n        fragColour.xy = mix( fragColour.xy, vec2(0,1), smoothstep(4.,3.,length(iMouse.xy-fragCoord.xy)) );\n    }\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    }
                ],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "float Evaluate( vec4 reactionData )\n{\n    return clamp((reactionData.x-reactionData.y)*.8+.2,.0,1.);\n}\n\nvoid mainImage( out vec4 fragColour, in vec2 fragCoord )\n{\n    fragColour = texelFetch(iChannel1,ivec2(fragCoord),0);\n    \n    if ( iFrame == 0 ) fragColour = vec4(.03,.1,.3,1e10);\n    \n\n    vec3 ray = vec3((fragCoord-iResolution.xy*.5)/iResolution.y,2.);\n    \n    vec3 camPos = vec3(-15,6,-5)*2.;\n    vec3 camTarget = vec3(0);\n    vec3 camK = normalize(camTarget-camPos);\n    vec3 camI = normalize(cross(vec3(0,1,0),camK));\n    vec3 camJ = cross(camK,camI);\n    \n    ray = ray.x*camI + ray.y*camJ + ray.z*camK;\n    \n    // offset surface with each slice\n    float f = float(iFrame)/400.;\n    \n    float t = (f-5.-camPos.y)/ray.y;\n    \n    if ( t > fragColour.a ) return;\n    vec3 pos = camPos + ray*t; // position on surface, displaced by iFrame\n        \n\tvec2 uv = pos.xz/vec2(16,9)+.5; // texture lookup for this point on surface\n        \n//\tif ( min(uv.x,uv.y) < 0. || max(uv.x,uv.y) > 1. ) return;\n    \n    float val = Evaluate( texture(iChannel0,fract(uv)) );\n    \n    if ( val > .3 ) return;\n\n    // get the gradient at this point\n    float valX = Evaluate( texture(iChannel0,fract(uv+vec2(1,0)/iResolution.xy)) );\n    float valY = Evaluate( texture(iChannel0,fract(uv+vec2(0,1)/iResolution.xy)) );\n    \n    vec2 normal = normalize(vec2( valX-val, valY-val ));\n    \n    fragColour.rgb = smoothstep(-.7,.7,cos(f*vec3(.618,1.,1.618)));\n    \n    // lighting\n    fragColour.rgb *= mix( vec3(.02,.05,.1), vec3(1.2,1.07,1.), .5+.5*dot(normal,normalize(vec2(1,3))) );\n    \n    fragColour.rgb = mix( pow(vec3(.03,.1,.3),vec3(2.2)), fragColour.rgb, exp2(-t/10.) );\n    fragColour.rgb = pow( fragColour.rgb, vec3(1./2.2) );\n    fragColour.a = t;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Buffer B",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 258
                    }
                ],
                "type": "buffer"
            }
        ],
        "ver": "0.1"
    }
}