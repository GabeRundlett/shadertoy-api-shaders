{
    "Shader": {
        "info": {
            "date": "1593050013",
            "description": "..",
            "flags": 32,
            "hasliked": 0,
            "id": "3lfcD2",
            "likes": 14,
            "name": "Michael's Cool Algorithm 3D",
            "published": 3,
            "tags": [
                "fluid"
            ],
            "usePreview": 0,
            "username": "wyatt",
            "viewed": 469
        },
        "renderpass": [
            {
                "code": "// Fork of \"Michael's Cool Algorithm\" by wyatt. https://shadertoy.com/view/ttsyzs\n// 2020-06-25 01:31:08\n\nSampler\nMain\n{\n    R = iResolution.xy;\n    vec3 mi = 0.5*vec3(R/N,N*N);\n    vec3 p = vec3(0,0,-R.x/N);\n    vec3 d = normalize(vec3((U-0.5*R)/R.y,1));\n    if (iMouse.z>0.) {\n \t\tp.zx *= e(6.2*iMouse.x/R.x);\n\t\td.zx *= e(6.2*iMouse.x/R.x);\n        p.yz *= e(6.2*iMouse.y/R.y);\n\t\td.yz *= e(6.2*iMouse.y/R.y);\n    } else {\n\t\tp.xz *= e(.1*iTime);\n\t\td.xz *= e(.1*iTime);\n\t}\n    Q = vec4(0);\n    for (int i = 0; i < 100; i++) {\n        vec3 o = abs(p)-mi;\n        float m = length(max(o,0.));\n        if (m<.1)\n        { \t\n            vec4 a = T(p+mi).wwww;\n            float aa = length(a);\n            Q += 2e-2*(1.-exp(-aa))*(a)*(0.5+0.5*sin(a+vec4(1,2,3,4)));\n            p += d*(.01+exp(-.1*aa*aa));\n           //p = mod(p+mi,R3D)-mi;\n        } else p += d*m;\n        \n \t}\n    Q = .8*atan(log(1.+Q));\n}\n",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "Main {\n\tR = iResolution.xy;\n    M = iMouse;\n    I = iFrame;\n   \tvec4 a, b;\n    \n   \tprog (d3(U),a,b,iChannel0,iChannel1);\n    \n    Q = a;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 259,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer02.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 260,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer03.png"
                    }
                ],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "Main {\n\tR = iResolution.xy;\n    M = iMouse;\n    I = iFrame;\n   \tvec4 a, b;\n    \n   \tprog (d3(U),a,b,iChannel0,iChannel1);\n    \n    Q = b;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 259,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer02.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 260,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer03.png"
                    }
                ],
                "name": "Buffer B",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 258
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "Main {\n\tR = iResolution.xy;\n    M = iMouse;\n    I = iFrame;\n   \tvec4 a, b;\n    \n   \tprog2 (d3(U),a,b,iChannel0,iChannel1);\n    \n    Q = a;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Buffer C",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 259
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "Main {\n\tR = iResolution.xy;\n    M = iMouse;\n    I = iFrame;\n   \tvec4 a, b;\n    \n   \tprog2 (d3(U),a,b,iChannel0,iChannel1);\n    \n    Q = b;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Buffer D",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 260
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "vec2 R;\nvec4 M;\nint I;\n#define N 9.\n#define R3D vec3(R/N,N*N)\n#define e(a) mat2(cos(a),-sin(a),sin(a),cos(a))\n#define d2(U) ((U).xy+vec2(mod(floor((U).z),N),floor(floor((U).z)/N))*R/N)\n#define d3(u) vec3(mod(u,R/N),floor(u/R*N).x+floor(u/R*N).y*N)\n#define _3D  vec3 U = d3(u)\n#define Sampler vec4 T(vec3 U) {return mix(texture(iChannel0,d2(vec3(U.xy,floor(U.z)))/R),texture(iChannel0,d2(vec3(U.xy, ceil(U.z)))/R),fract(U.z));}\n#define A(U) texture(cha,d2(mod(U,R3D))/R)\n#define B(U) texture(chb,d2(mod(U,R3D))/R)\n#define Main void mainImage (out vec4 Q, in vec2 U)\nfloat signe (float x) {return atan(100.*x);}\nvoid prog (vec3 U, out vec4 a, out vec4 b, sampler2D cha, sampler2D chb) {\n\t\n    a = vec4(0); b = vec4(0);\n    for (int x = -1; x <= 1; x++)\n    for (int y = -1; y <= 1; y++)\n    for (int z = -1; z <= 1; z++)\n    {\n        vec3 u = vec3(x,y,z);\n    \tvec4 aa = A(U+u), bb = B(U+u);\n        aa.xyz += bb.xyz;\n        #define q 1.1\n\t\tvec3 w1 = clamp(aa.xyz-0.5*q,U - 0.5,U + 0.5),\n             w2 = clamp(aa.xyz+0.5*q,U - 0.5,U + 0.5);\n        float m = (w2.x-w1.x)*(w2.y-w1.y)*(w2.z-w1.z)/(q*q*q);\n        aa.xyz = 0.5*(w1+w2);\n        a.xyz += aa.xyz*aa.w*m;\n        b.xyz += bb.xyz*aa.w*m;\n        a.w += aa.w*m;\n    }\n    if (a.w>0.) {\n        a.xyz/=a.w;\n        b.xyz/=a.w;\n    }\n}\nvoid prog2 (vec3 U, out vec4 a, out vec4 b, sampler2D cha, sampler2D chb) {\n\t\n    a = A(U); b = B(U);\n    vec3 f = vec3(0); float m = 0.;\n    for (int x = -1; x <= 1; x++)\n    for (int y = -1; y <= 1; y++)\n    for (int z = -1; z <= 1; z++)\n    {\n        vec3 u = vec3(x,y,z);\n        float l = length(u);\n        if (l>0.) {\n    \t\tvec4 aa = A(U+u), bb = B(U+u);\n            f += 1e-2*(aa.w*(1.-.2*aa.w))*u/l;\n            m += aa.w;\n        }\n    }\n    if (m>0.) b.xyz += f/m;\n    \n    \n    // Boundaries:\n   \tb.xyz -= 1e-3*signe(a.w)*(a.xyz-0.5*R3D)*sin(1e-5*float(I));\n\n    \n    if (I<1||U.x<1.||R3D.x-U.x<1.||R3D.y-U.y<1.||R3D.x-U.x<1.||U.z<1.||R3D.z-U.z<1.) {\n    \ta = vec4(U,0);\n        b = vec4(0);\n        if (length(U-0.5*R3D) < 0.2*R3D.y) a.w = 20.;\n    }\n}",
                "description": "",
                "inputs": [],
                "name": "Common",
                "outputs": [],
                "type": "common"
            }
        ],
        "ver": "0.1"
    }
}