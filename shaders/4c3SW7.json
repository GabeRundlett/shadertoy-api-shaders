{
    "Shader": {
        "info": {
            "date": "1713974804",
            "description": "Traversing columnular structures (flat-topped wats?)",
            "flags": 0,
            "hasliked": 0,
            "id": "4c3SW7",
            "likes": 19,
            "name": "Columnular",
            "published": 3,
            "tags": [
                "architecture"
            ],
            "usePreview": 0,
            "username": "dr2",
            "viewed": 216
        },
        "renderpass": [
            {
                "code": "#define Jc min(Pz,0)\n#define Qy(Of)if(Ez<ON){ON=Ez;PQ=Of;Zw=XL;}\nvec3 BP,Zw,NK,VW,Ko,SE;vec2 Df,Im;float MP,VF,KJ,RW,My,Wn,Zs,LI,Nt,Av;int Pz,PQ;const float Nx=3.1415927,CB=1.7320508;float Up(vec3 EU,vec3 QC){vec3 Ez;Ez=abs(EU)-QC;return min(max(Ez.x,max(Ez.y,Ez.z)),0.)+length(max(Ez,0.));}float Wa(vec3 EU,float CS,float Cg){return max(length(EU.xy)-CS,abs(EU.z)-Cg);}vec2 Pi(vec2 EU){vec3 LZ,JK,TU;LZ.xz=vec2((1./CB)*EU.x-(1./3.)*EU.y,(2./3.)*EU.y);LZ.y=-LZ.x-LZ.z;JK=floor(LZ+0.5);TU=abs(JK-LZ);JK-=step(TU.yzx,TU)*step(TU.zxy,TU)*dot(JK,vec3(1.));return JK.xz;}vec2 IY(vec2 Cg){return vec2(CB*(Cg.x+0.5*Cg.y),(3./2.)*Cg.y);}float Hn(vec2 EU){EU=abs(EU);return(CB/2.)-EU.x+0.5*min(EU.x-CB*EU.y,0.);}float HI(float Le){return(Le!=0.)?sign(Le):1.;}float GW(vec2 EU){return min(EU.x,EU.y);}float DA(vec2 EU){return max(EU.x,EU.y);}float IH(vec3 EU){return min(EU.x,min(EU.y,EU.z));}float Fl(vec3 EU){return max(EU.x,max(EU.y,EU.z));}float AQ(float Yt,float Mu,float Tq,float Yx){return(1.-smoothstep(Mu-Tq,Mu+Tq,Yx))*smoothstep(Yt-Tq,Yt+Tq,Yx);}mat3 Jt(float FT,float ID){vec2 Dj,Pv,Sn;Dj=vec2(FT,ID);Pv=cos(Dj);Sn=sin(Dj);return mat3(Pv.y,0.,-Sn.y,0.,1.,0.,Sn.y,0.,Pv.y)*mat3(1.,0.,0.,0.,Pv.x,-Sn.x,0.,Sn.x,Pv.x);}vec2 OR(vec2 XL,float BL){vec2 Ul;Ul=sin(BL+vec2(0.5*Nx,0.));return vec2(dot(XL,vec2(Ul.x,-Ul.y)),dot(XL.yx,Ul));}vec2 Ng(vec2 XL,vec2 Ul){return vec2(dot(XL,vec2(Ul.x,-Ul.y)),dot(XL.yx,Ul));}const float XY=43758.54;float DR(vec2 EU){return fract(sin(mod(dot(EU,vec2(37.,39.)),2.*Nx))*XY);}vec2 FC(vec2 EU){vec2 ZJ=vec2(37.,39.);return fract(sin(mod(dot(EU,ZJ)+vec2(0.,ZJ.x),2.*Nx))*XY);}float Rk(vec2 EU){vec2 Le,Tm,Qh;Tm=floor(EU);Qh=fract(EU);Qh=Qh*Qh*(3.-2.*Qh);Le=mix(FC(Tm),FC(Tm+vec2(0.,1.)),Qh.y);return mix(Le.x,Le.y,Qh.x);}float ML(vec2 EU){float La,BL;La=0.;BL=1.;for(int UX=0;UX<5;UX++){La+=BL*Rk(EU);BL*=0.5;EU*=2.;}return La*(1./1.9375);}float Ow(vec3 EU,vec3 Md){vec3 QC;float BL;QC=vec3(0.);BL=1.;for(int UX=0;UX<5;UX++){QC+=BL*vec3(Rk(EU.yz),Rk(EU.zx),Rk(EU.xy));BL*=0.5;EU*=2.;}return dot(QC,abs(Md));}vec3 Hr(vec3 EU,vec3 Md,float La){vec4 FG;vec3 Cg;vec2 Ei=vec2(0.1,0.);for(int UX=Jc;UX<4;UX++)FG[UX]=Ow(EU+((UX<2)?((UX==0)?Ei.xyy:Ei.yxy):((UX==2)?Ei.yyx:Ei.yyy)),Md);Cg=FG.xyz-FG.w;return normalize(Md+La*(Cg-Md*dot(Md,Cg)));}float Lr(vec2 EU){return dot(EU,EU);}vec3 Vs(vec2 EU){vec2 Iq,Kb,LM,Sj;float Ez,Gk,HV,Bd,CS,Fh,QC,FX;bool XH;XH=(Zs==2.||Zs==4.);if(XH){Kb=-vec2(0.,Wn);LM=vec2(CB/2.*HI(EU.x),0.5*Wn);Gk=Lr(EU-Kb);HV=Lr(EU-LM);Ez=min(Gk,HV);Iq=(Ez==Gk)?Kb:LM;CS=0.5;Ez=abs(sqrt(Ez)-CS);}else{if(Wn!=0.)EU=0.5*vec2(EU.x-Wn*CB*EU.y,Wn*CB*EU.x+EU.y);Kb=vec2(CB/2.*HI(EU.x),0.);LM=vec2(CB*HI(EU.x),0.);Gk=sqrt(Lr(EU-Kb));HV=abs(sqrt(Lr(EU-LM))-1.5);Ez=min(Gk,HV);Iq=(Ez==Gk)?Kb:LM;CS=(Ez==Gk)?0.:1.5;}Sj=EU-Iq;Bd=Df.x-Df.y;QC=(XH&&Bd<0.||!XH&&abs(Bd-2.)==1.)?-1.:1.;Fh=(0.5-atan(Sj.y,-Sj.x)/(2.*Nx))*QC;if(!XH&&abs(Bd-2.)<=1.)Fh+=1./6.;FX=HI(length(Sj)-CS);return vec3(Ez*FX,CS*FX*QC,Fh);}bool By(vec2 w){vec2 WM,Vb;float Bd;bool CO,Yc;Bd=Df.x-Df.y;CO=(mod(Df.y,2.)==1.);Vb=Ng(w,sin(-Nx/3.+vec2(0.5*Nx,0.)))-vec2(0.,0.3);WM=Ng(w,sin(Nx/3.+vec2(0.5*Nx,0.)));Yc=(Bd==-2.&&Vb.y>0.||!CO&&(Bd==-3.&&w.y>-0.3||Bd==-2.||Bd==-1.&&Vb.y>0.||Bd==1.&&Vb.y<0.||(Bd==2.||Bd==3.)&&w.x<0.||Bd==4.||Bd==5.)||CO&&(Bd==-3.||Bd==0.&&WM.x>0.||(Bd==1.||Bd==2.)&&w.x>0.||Bd==3.||Bd==4.&&Vb.x<0.||Bd==5.&&Vb.y<0.));return!Yc;}vec4 GF(int WI){vec4 Az;float Xd,Ql;Xd=1.;Ql=1.5;if(WI<8){if(WI<4){if(WI<2)Az=(WI==0)?vec4(0.,0.,-1./6.,Ql):vec4(1.,0.,1./3.,-Xd);else Az=(WI==2)?vec4(0.,1.,5./6.,Ql):vec4(-1.,1.,-1./3.,Xd);}else{if(WI<6)Az=(WI==4)?vec4(-1.,2.,1.,Xd):vec4(0.,1.,-1./6.,Ql);else Az=(WI==6)?vec4(1.,1.,1./6.,Ql):vec4(1.,2.,1.,Xd);}}else if(WI<16){if(WI<12){if(WI<10)Az=(WI==8)?vec4(2.,1.,1./2.,-Ql):vec4(2.,0.,-1./2.,Ql);else Az=(WI==10)?vec4(3.,-1.,-1./6.,Ql):vec4(4.,-1.,1./3.,-Xd);}else{if(WI<14)Az=(WI==12)?vec4(3.,0.,-1./2.,-Ql):vec4(3.,1.,1./2.,Ql);else Az=(WI==14)?vec4(2.,2.,5./6.,Ql):vec4(1.,2.,-1./3.,Xd);;}}else Az=vec4(1.,3.,1.,Xd);return Az;}vec2 Jp(float Le){const int QT=17;vec4 SA;vec2 TH,KN;float OA[QT+1],YO,CS,BL,JG;OA[0]=0.;for(int WI=Jc;WI<QT;WI++)OA[WI+1]=OA[WI]+abs(GF(WI).w);RW=OA[QT];Le/=3.;TH=floor(Le/RW)*vec2(2.);Le=mod(Le,RW);for(int WI=Jc;WI<QT;WI++){if(Le>=OA[WI]&&Le<OA[WI+1]){SA=GF(WI);YO=2.*(Le-OA[WI])/(OA[WI+1]-OA[WI])-1.;break;}}TH+=SA.xy;if(abs(SA.w)==1.5){CS=1.5;JG=CB;BL=Nx/6.;YO*=HI(SA.w);}else{CS=0.5;JG=1.;BL=-HI(SA.w)*Nx/3.;}KN=vec2(-1.,1.)*sin(Nx*SA.z+vec2(0.,0.5*Nx));return(IY(TH)+JG*KN-CS*Ng(KN,sin(YO*BL+vec2(0.5*Nx,0.))))*KJ;}void VJ(){float Cg,Bd;Im=IY(Df*KJ);Cg=DR(Df);if(DR(17.11*Df)>0.4){Wn=floor(3.*Cg)-1.;Zs=3.;}else{Wn=2.*floor(2.*Cg)-1.;Zs=4.;}Bd=Df.x-Df.y;if(Bd==0.)Zs=1.;else if(abs(Bd)==1.)Zs=mod(Df.x,2.)+1.;else if(Bd==-2.||Bd==-3.||Bd==5.)Zs=2.;else if(Bd==2.||Bd==3.||Bd==4.)Zs=1.;if(Zs<=2.){if(Zs==1.&&(Bd==1.||Bd==2.||Bd==3.))Wn=0.;else if(Zs==1.&&Bd==4.)Wn=-1.;else if(Zs==2.&&Bd==5.)Wn=1.;else Wn=2.*mod(Df.x,2.)-1.;}}\nvoid SR(){float Bu;Bu=min(floor(0.5+6.*DR(NK.xz+99.9)),4.);if(Bu==0.)LI=0.;else LI=(NK.y>=0.&&NK.y<=Bu)?2.:0.;if(LI!=0.){if(NK.y==0.)LI=1.;else if(NK.y==Bu)LI=-1.;}}void UC(vec2 JK){vec3 GB;vec2 QC;float Cx;VJ();GB=Vs((JK-Im)/KJ);Cx=KJ*abs(GB.x);QC=(JK-Im)/KJ;Nt=(Zs>2.||GB.y==0.||!By(QC)||Cx>1.2)?1.:0.;}float Vo(vec3 EU){vec3 XL;float ON,Ez;ON=VF;if(LI*Nt!=0.){EU-=VW*(NK+0.5);XL=EU;Ez=Up(XL,Ko);Qy(1);XL.xz=abs(XL.xz)-0.5*Ko.xz;Ez=length(XL.xz)-0.07;Ez=min(Ez,Wa(XL.xzy,0.09,0.14));if(abs(LI)==1.)Ez=max(Ez,-LI*XL.y);Qy(2);}return ON;}float YK(vec3 Lv,vec3 ED){vec3 EU,Go;vec2 JK,EQ;float Nc,Ez,QC,TY,HE;bool JX;if(ED.x==0.)ED.x=1e-4;if(ED.y==0.)ED.y=1e-4;if(ED.z==0.)ED.z=1e-4;Go=1./ED;HE=1e-3;JX=true;Nc=HE;for(int UX=Jc;UX<220;UX++){EU=Lv+Nc*ED;if(JX){NK=floor(EU/VW);SR();TY=IH((VW*(NK+step(0.,ED))-Lv)*Go);}JK=floor(NK.xz*VW.xz+0.5);EQ=Pi(JK/KJ);if(JX||Df!=EQ){Df=EQ;UC(JK);}JX=false;Ez=Vo(EU);QC=max(Nc,TY);if(Nc+Ez<QC){Nc+=Ez;}else{Nc=QC+HE;JX=true;}if(Ez<HE||Nc>VF)break;}if(Ez>=HE)Nc=VF;return Nc;}vec3 WZ(vec3 EU){vec4 FG;vec2 Ei;Ei=1e-3*vec2(1.,-1.);for(int UX=Jc;UX<4;UX++){FG[UX]=Vo(EU+((UX<2)?((UX==0)?Ei.xxx:Ei.xyy):((UX==2)?Ei.yxy:Ei.yyx)));}FG.x=-FG.x;return normalize(2.*FG.yzw-dot(FG,vec4(1.)));}float SV(vec3 EU){vec3 XL;float ON,Ez;ON=VF;XL=EU-vec3(SE.xz,Av+5.).xzy;Ez=Wa(XL.xzy,0.5,5.);Qy(3);return ON;}float Wr(vec3 Lv,vec3 ED){float Nc,Ez;Nc=0.;for(int UX=Jc;UX<120;UX++){Ez=SV(Lv+Nc*ED);if(Ez<0.0005||Nc>VF)break;Nc+=Ez;}return Nc;}vec3 UG(vec3 EU){vec4 FG;vec2 Ei;Ei=1e-3*vec2(1.,-1.);for(int UX=Jc;UX<4;UX++){FG[UX]=SV(EU+((UX<2)?((UX==0)?Ei.xxx:Ei.xyy):((UX==2)?Ei.yxy:Ei.yyx)));}FG.x=-FG.x;return normalize(2.*FG.yzw-dot(FG,vec4(1.)));}vec3 Zf(vec3 ED){ED.y=abs(ED.y);return mix(vec3(0.3,0.35,0.7),vec3(0.8,0.8,0.8),clamp(2.*(ML(4.*ED.xz/ED.y+0.1*MP)-0.1)*ED.y,0.,1.));}vec3 Xu(vec3 Lv,vec3 ED){vec4 QP;vec3 Pe,PU,GB,Bh,Az;vec2 QC,Oj;float AM,Zb,Xq,HZ,Cx,BL;int RB;HZ=1.;Oj=vec2(0.);for(int WI=0;WI<2;WI++){Xq=(ED.y<0.)?(-(Lv.y-Av)/ED.y):VF;AM=YK(Lv+vec3(0.5*VW.xz,0.).xzy,ED);RB=PQ;Bh=Zw;Zb=Wr(Lv,ED);if(WI==0&&Zb<min(min(AM,Xq),VF)&&abs(Zw.y)<4.9){Lv+=Zb*ED;PU=UG(Lv);ED=reflect(ED,PU);Lv+=0.01*ED;HZ=0.9;}else break;}if(min(Xq,min(Zb,AM))<VF){if(Xq<min(Zb,AM)){Zb=Xq;Lv+=Zb*ED;PU=vec3(0.,1.,0.);Df=Pi(Lv.xz/KJ);VJ();QP=vec4(0.1,0.5,0.1,0.);Oj=vec2(8.,2.);QC=(Lv.xz-Im)/KJ;GB=Vs(QC);if(Zs<=2.&&GB.y!=0.&&By(QC)){Cx=KJ*abs(GB.x)-0.5;if(Cx<0.02){QP=mix(vec4(0.4,0.3,0.2,0.),QP,smoothstep(-0.02,0.02,Cx));Oj=vec2(32.,0.5);}}}else if(AM<Zb){Zb=AM;PQ=RB;Zw=Bh;Lv+=Zb*ED+vec3(0.5*VW.xz,0.).xzy;PU=WZ(Lv);if(PQ==1){QP=vec4(0.6,0.6,0.6,0.1);if((LI==2.||abs(LI)==1.&&LI*Zw.y>0.)&&length(abs(Zw.xz)-0.5*Ko.xz)<0.11)QP*=0.8;Az=abs(Zw)-Ko;if(IH(vec3(length(Az.xz),length(Az.xy),length(Az.yz)))<0.02)QP*=0.8;Oj=vec2(4.,1.);}else if(PQ==2){QP=vec4(0.6,0.4,0.3,0.1);if(abs(Zw.y)>0.2)QP*=0.7+0.3*step(0.03,abs(fract(8.*Zw.y+0.5)-0.5));if(abs(PU.y)<0.1){BL=fract(16.*(atan(Zw.z,-Zw.x)/(2.*Nx)+0.5));PU.xz=OR(PU.xz,-0.15*Nx*sin(Nx*BL*BL));}Oj=vec2(8.,0.5);}}else{Lv+=Zb*ED;PU=UG(Lv);if(PQ==3)QP=vec4(0.7,0.6,0.4,0.1);}if(Oj.y>0.)PU=Hr(Oj.x*Lv,PU,Oj.y);Pe=QP.rgb*(0.2+0.8*max(dot(PU,BP),0.))+QP.a*pow(max(dot(BP,reflect(ED,PU)),0.),32.);Pe=mix(vec3(0.3,0.35,0.7),Pe,min(1.,exp2(2.-8.*Zb/VF)));}else{Pe=Zf(ED);}Pe*=HZ;return clamp(Pe,0.,1.);}void mainImage(out vec4 RS,in vec2 TD){mat3 RF;vec4 Ks;vec3 Lv,ED,Pe,KN;vec2 Rg,Ck,DV;float FT,ID,Ai,GS,Em;\nPz=iFrame;Rg=iResolution.xy;Ck=2.*TD.xy/Rg-1.;Ck.x*=Rg.x/Rg.y;MP=iTime;Ks=iMouse;Ks.xy=Ks.xy/Rg-0.5;\nGS=Rg.x/Rg.y;VW=vec3(1.,2.,1.);Ko=vec3(0.5*VW.xz-0.005,0.1).xzy;Av=0.5*VW.y-0.1;KJ=8.;My=2.;Lv.xz=Jp(0.5*MP*My+0.1);Lv.y=0.5*VW.y+1.+8.*AQ(0.25,0.75,0.2,fract(0.02*MP));SE.xz=Jp(0.5*MP*My+3.);SE.y=2.+0.6*Lv.y;KN=normalize(SE-Lv);ID=atan(KN.z,-KN.x)-0.5*Nx;FT=asin(KN.y);if(Ks.z>0.){ID+=2.*Nx*Ks.x;FT+=Nx*Ks.y;}RF=Jt(FT,ID);Ai=2.;VF=120.;BP=RF*normalize(vec3(1.,1.,-1.));const float NO=3.;Pe=vec3(0.);Em=2.*mod(dot(mod(floor(0.5*(Ck+1.)*Rg),2.),vec2(1.)),2.)-1.;for(float BL=float(Jc);BL<NO;BL++){DV=(Ck+step(1.5,NO)*OR(vec2(0.5/Rg.y,0.),Em*(0.667*BL+0.5)*Nx))/Ai;ED=RF*normalize(vec3(2.*tan(0.5*atan(DV.x/GS))*GS,DV.y,1.));Pe+=(1./NO)*Xu(Lv,ED);}RS=vec4(Pe,1.);}\n",
                "description": "",
                "inputs": [],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            }
        ],
        "ver": "0.1"
    }
}