{
    "Shader": {
        "info": {
            "date": "1596650505",
            "description": "If you say his name three times a portal will appear",
            "flags": 32,
            "hasliked": 0,
            "id": "wllfR4",
            "likes": 22,
            "name": "Summoning Circle",
            "published": 3,
            "tags": [
                "noise",
                "ancient",
                "fonts",
                "symbols"
            ],
            "usePreview": 0,
            "username": "BackwardsCap",
            "viewed": 614
        },
        "renderpass": [
            {
                "code": "//Summoning Circle\n//by Sam Gates (BackwardsCap)\n\n\nvoid mainImage( out vec4 c, in vec2 f )\n{\n    c.rgb = vec3(0);\n\tc.rgb = S0(f).rgb/3.0+S1(f).rgb*.8;    \n    vec2 p = (2.0*f-R)/R.y;\n    float t = clamp((iTime/2.0)-6.0,0.,1.);\n    float t2 =clamp((iTime/2.0)-5.4,0.,.6)-clamp((iTime/2.0)-6.6,0.,.6);\n    \n    c.rgb+=clamp(1.0-(length(p)+.1),0.,1.)*S2(f).rgb*t;\n    \n    float a = (length(p)-1.)/2.;\n    vec3 ba = vec3(0);\n    for(int y=-4;y<=4;y++)\n    for(int x=-4;x<=4;x++)\n    {\n        vec2 o = vec2(x,y);\n        if(length(o)<66.)\n        ba+= S1(f+o).rgb;\n    }\n    \n    ba/=15.0;\n    \n    c.rgb+=ba*a+(ba*t2*.4);\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 2,
                        "ctype": "video",
                        "id": 36,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/a/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 260,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer03.png"
                    }
                ],
                "name": "Image",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 37
                    }
                ],
                "type": "image"
            },
            {
                "code": "#define R iResolution.xy\n#define PI 3.1415927\n#define m vec2(5.+2.*4.,10.)\n#define SS(U) smoothstep(PX, 0., U)\n\n#define MORPH\n\n//Any advice on fixing the inconsistency on the connecting edges or the aliasing would be very welcome\n#define PX 40./R.y\n\n\nfloat rand (vec2 p)\n{\n    float d = iDate.w;\n    #ifdef MORPH\n    vec2 pp =p/20.0;\n    d=floor(d*pp.x*pp.y)/30.;\n    #endif\n    return fract(sin(dot(p.xy,vec2(12389.1283,8941.1283)))*(12893.128933)+cos(floor(d)));\n}\n\nmat2 rot(float a){return mat2(cos(a),-sin(a),sin(a),cos(a));}\n\n//https://www.shadertoy.com/view/4llXD7\nfloat B(vec2 p, vec2 b, vec4 r)\n{\n    r.xy = p.x>0.0?r.xy : r.zw;\n    r.x = p.y>0.0 ? r.x : r.y;\n    vec2 q = abs(p)-b+r.x;\n    return SS(min(max(q.x,q.y),0.0)+length(max(q,0.0))-r.x);\n}\n\nbool removed(float h, vec2 p)\n{\n    vec2 lp = mod(p,m);\n    float h2 = rand(vec2(20.+h*(floor(p.y))+10.84));\n    if(lp.x>=4.&&lp.x<11.||lp.y>=6.)return true;\n    return h*dot(h,h2)*5.<=.5;\n}\n\n\nfloat C(vec2 p){return SS(length(p-.5)-.4);}\n\nfloat CL(vec2 p, float a)\n{\n    vec2 bp = (p-.5);\n    bp*=rot(PI/4.*a);\n    bp.x+=.5;\n    return B(bp, vec2(.6,.345), vec4(.3));\n}\n\nfloat CE(vec2 p, vec2 o)\n{\n    return B((p+o)*rot(PI/4.), vec2(.5), vec4(0));\n}\n\nfloat EL(vec2 p, float t)\n{\n    vec2 b = vec2(.5,.4-PX);\n    p-=vec2(.5,.5);\n    p*=rot(PI/2.*t);\n    p.x+=PX;\n    vec4 r = vec4(b.x-b.x/2.,b.x-b.x/2.,0,0);\n    return B(p, b, r);\n}\n\nfloat D(vec2 p, float r)\n{\n    p-=.5;\n    p*=rot(PI/2.*r);\n    p+=.13;\n    float b1 = B(p,vec2(.5),vec4(.5,0,0,0));\n    p+=.77;\n    float b2 = B(p,vec2(.5),vec4(0,0,0,.025));\n    return b1-b2;\n}\n\n\nfloat T(vec2 p, float r)\n{\n    p-=.5;\n    p*=rot(PI/2.*r);\n    return B(p,vec2(.4-PX,.6), vec4(0));\n}\n\nfloat render(vec2 p, float h)\n{\n    bool neighbors[9];\n    int ul=6,u=7,ur=8,l=3,me=4,r=5,dl=0,d=1,dr=2;\n    int n=0;\n\n    float o = 0.;\n\n    for(float y=-1.;y<=1.;y++)\n    {\n        for(float x=-1.;x<=1.;x++){\n\n            int i = int((x+1.)+(y+1.)*3.);\n\n            vec2 pos = floor(p+vec2(x,y));\n\n            neighbors[i]= !removed(rand(pos),pos);\n\n            if(i!=me&&neighbors[i])\n            {\n                n++;\n            }\n        }\n    }\n    \n    p=fract(p);\n\n    if(neighbors[me])\n    {\n        if(n==0) return C(fract(p));\n\t\t\n        if(neighbors[u]&&neighbors[d]){\n\n            float o = T(p,0.);\n            if(neighbors[l])o+=EL(p+vec2(.175,0),0.);\n            if(neighbors[r])o+=EL(p-vec2(.175,0),2.);\n            return o;\n        }\n        if(neighbors[l]&&neighbors[r])\n        {\n            float o = T(p,1.);\n            if(neighbors[u])o+=EL(p-vec2(0,.25),1.);\n            if(neighbors[d])o+=EL(p+vec2(0,.25),3.);\n            return o;\n        }\n\n\n        if(neighbors[u]&&!neighbors[d]&&!neighbors[l]&&!neighbors[r])\n        {\n            float o = EL(p-vec2(0,.3),1.);\n\n            if(neighbors[dl]) o+=CL(p-vec2(.175),7.);\n            if(neighbors[dr]) o+=CL(p-vec2(-.175,.175),5.);\n\n            return o;\n        }\n\n        if(neighbors[d]&&!neighbors[u]&&!neighbors[l]&&!neighbors[r])\n        {\n            float o = EL(p+vec2(0,.3),3.);\n\n            if(neighbors[ul]) o+=CL(p+vec2(-.175,.175),1.);\n            if(neighbors[ur]) o+=CL(p+vec2(.175),3.);\n\n            return o;\n        }\n\n        if(neighbors[l]&&!neighbors[r]&&!neighbors[d]&&!neighbors[u])\n        {\n            float o = EL(p+vec2(.3,0),0.);\n\n            if(neighbors[ur]) o+=CL(p+vec2(.175,.175),3.);\n            if(neighbors[dr]) o+=CL(p-vec2(-.175,.175),5.);\n\n            return o;\n        }\n\n        if(neighbors[r]&&!neighbors[l]&&!neighbors[d]&&!neighbors[u])\n        {\n            float o = EL(p-vec2(.3,0),2.);\n\n            if(neighbors[ul]) o+=CL(p+vec2(-.175,.175),1.);\n            if(neighbors[dl]) o+=CL(p-vec2(.175),7.);\n\n            return o;\n        }\n        float j = 0.0;\n        if(!neighbors[u]&&neighbors[r]&&!neighbors[l]&&neighbors[d])j+= D(p,3.);\n        if(neighbors[u]&&neighbors[r]&&!neighbors[l]&&!neighbors[d])j+= D(p,2.);\n        if(!neighbors[u]&&!neighbors[r]&&neighbors[l]&&neighbors[d])j+= D(p,0.);\n        if(neighbors[u]&&!neighbors[r]&&neighbors[l]&&!neighbors[d])j+= D(p,1.);\n        if(neighbors[ul]&&!neighbors[l]&&!neighbors[u]) j+=CL(p+vec2(-.175,.175),1.);\n        if(neighbors[dl]&&!neighbors[l]&&!neighbors[d]) j+=CL(p-vec2(.175),7.);\n        if(neighbors[ur]&&!neighbors[r]&&!neighbors[u]) j+=CL(p+vec2(.175,.175),3.);\n        if(neighbors[dr]&&!neighbors[r]&&!neighbors[d]) j+=CL(p-vec2(-.175,.175),5.);\n        \n\n        return  j;\n    }else{\n        float o = 0.0;\n        if(!neighbors[ul]&&neighbors[u]&&neighbors[l])o+= CE(p,vec2(.07,-1.15));\n        if(!neighbors[ur]&&neighbors[u]&&neighbors[r])o+= CE(p, vec2(-1.11));\n        if(!neighbors[dl]&&neighbors[d]&&neighbors[l])o+= CE(p,vec2(.11));\n        if(!neighbors[dr]&&neighbors[d]&&neighbors[r])o+= CE(p,vec2(-1.11,.11));\n        return o;\n    }\n}\n\nvoid mainImage( out vec4 c, in vec2 f )\n{\n    c.rgb = vec3(0);\n    vec2 p = ((2.0*f-R)/R.y), u=p, r;\n    \n    p = vec2(log(length(p.xy)), atan(p.y,p.x));\n    p*= (6.0/PI)* 10.85;//(20.*clamp((1.0+sin(-2.1+iTime/5.))/1.5,0.1,1.25));\n    p+=vec2(5.,3.); \n    p.y+=iTime*2.0;\n    p.y = mod(p.y,10.015*13.0)-.2;\n    r=p;\n    vec2 lp = (p);\n    p=floor(p);\n    float hash = rand(p);\n    \n    \n    if(p.x>=-5.&&p.x<=4.)\n\t    c.rgb=vec3(clamp(render(lp,hash),0.,1.))*min(length(u)*4.,1.);\n    \n    //if(r.y>(1.0+sin(iTime))/2.0*130.)c.rgb*=0.;\n    \n}",
                "description": "",
                "inputs": [],
                "name": "Buffer A",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 257
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "#define R iResolution.xy\n#define S0(U) texture(iChannel0, (U)/R)\n#define S1(U) texture(iChannel1, (U)/R)\n#define S2(U) texture(iChannel2, (U)/R)\n#define V(U) S0(mod(U,R))\n\n#define decay .9981\n\n//wrap the space (useful when sampling)\n#define A(U) T0(mod(U,R))",
                "description": "",
                "inputs": [],
                "name": "Common",
                "outputs": [],
                "type": "common"
            },
            {
                "code": "void F(vec2 p, vec2 offset, vec4 s, inout vec2 v, inout float pr, inout float d, inout float n)\n{\n    vec4 target = S0(p+offset-V(p+offset).xy);\n    offset=normalize(offset);\n    v+=offset*(target.w-s.w);\n    pr+=target.w;\n    d+=dot(offset,target.xy);\n    n++;\n}\n\nvoid mainImage(out vec4 s, vec2 p)\n{\n    s.rgb = vec3(0);\n    s = S0(p-V(p).xy);\n    vec2 v = vec2(0), u = (2.0*p-R)/R.y;\n    float d = 0., pr=0.,n=0.;\n    \n    F(p, vec2(0,1), s, v, pr, d, n);\n    F(p, vec2(0,-1), s, v, pr, d, n);\n    F(p, vec2(1,0), s, v, pr, d, n);\n    F(p, vec2(-1,0), s, v, pr, d, n);\n    \n    d/=n;\n    pr/=n;\n    v/=n;\n    \n    s.w = pr-d;\n\ts.xy -= v;   \n    s.z = d;\n    \n    s.xy*=decay;\n    \n    if(S1(p).r>0.)\n    {\n        s.xy = -u*.3;\n    }\n    \n    \n    if (p.x<1.||p.y<1.||R.x-p.x<1.||R.y-p.y<1.) s.xy *= 0.;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 259,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer02.png"
                    }
                ],
                "name": "Buffer B",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 258
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "void F(vec2 p, vec2 offset, vec4 s, inout vec2 v, inout float pr, inout float d, inout float n)\n{\n    vec4 target = S0(p+offset-V(p+offset).xy);\n    offset=normalize(offset);\n    v+=offset*(target.w-s.w);\n    pr+=target.w;\n    d+=dot(offset,target.xy);\n    n++;\n}\n\nvoid mainImage(out vec4 s, vec2 p)\n{\ns.rgb = vec3(0);\n    s = S0(p-V(p).xy);\n    vec2 v = vec2(0);\n    float d = 0., pr=0.,n=0.;\n    \n    F(p, vec2(0,1), s, v, pr, d, n);\n    F(p, vec2(0,-1), s, v, pr, d, n);\n    F(p, vec2(1,0), s, v, pr, d, n);\n    F(p, vec2(-1,0), s, v, pr, d, n);\n    \n    d/=n;\n    pr/=n;\n    v/=n;\n    \n    s.w = pr-d;\n\ts.xy -= v;   \n    s.z = d;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 258,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer01.png"
                    }
                ],
                "name": "Buffer C",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 259
                    }
                ],
                "type": "buffer"
            },
            {
                "code": "void mainImage(out vec4 state, vec2 f)\n{\n    for(int i=0;i<2;i++)\n    f -= S1(f).xy;\n \n    state = S0(f);\n    \n    state*=decay;\n    float t = iTime/5.0;\n    \n    if(S2(f).r>0.1)\n        state.rgb += vec3((cos(iTime/3.0)+1.0)/2., (1.1+sin(iTime/5.0))/2.0, cos(sin(iTime)))*.05;\n}",
                "description": "",
                "inputs": [
                    {
                        "channel": 2,
                        "ctype": "buffer",
                        "id": 257,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer00.png"
                    },
                    {
                        "channel": 1,
                        "ctype": "buffer",
                        "id": 259,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer02.png"
                    },
                    {
                        "channel": 0,
                        "ctype": "buffer",
                        "id": 260,
                        "published": 1,
                        "sampler": {
                            "filter": "linear",
                            "internal": "byte",
                            "srgb": "false",
                            "vflip": "true",
                            "wrap": "clamp"
                        },
                        "src": "/media/previz/buffer03.png"
                    }
                ],
                "name": "Buffer D",
                "outputs": [
                    {
                        "channel": 0,
                        "id": 260
                    }
                ],
                "type": "buffer"
            }
        ],
        "ver": "0.1"
    }
}